<!DOCTYPE html><!--2DrqUONp3UGGEsii_P_1z--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/797e433ab948586e-s.p.dbea232f.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/caa3a2e1cccd8315-s.p.853070df.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/chunks/f56971fdd088d69d.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/cbd55ab9639e1e66.js"/><script src="/_next/static/chunks/87a939617be2fa8c.js" async=""></script><script src="/_next/static/chunks/8368f298651cbd89.js" async=""></script><script src="/_next/static/chunks/6740f161f60c6ab5.js" async=""></script><script src="/_next/static/chunks/turbopack-929fc2ce3ca903db.js" async=""></script><script src="/_next/static/chunks/ff1a16fafef87110.js" async=""></script><script src="/_next/static/chunks/247eb132b7f7b574.js" async=""></script><script src="/_next/static/chunks/796e69ae18b2784c.js" async=""></script><script src="/_next/static/chunks/5f549f56d9b805d8.js" async=""></script><meta name="next-size-adjust" content=""/><title>Create Next App</title><meta name="description" content="Generated by create next app"/><link rel="icon" href="/favicon.ico?favicon.0b3bf435.ico" sizes="256x256" type="image/x-icon"/><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="geist_a71539c9-module__T19VSG__variable geist_mono_8d43a2aa-module__8Li5zG__variable antialiased"><div hidden=""><!--$--><!--/$--></div><div class="flex min-h-screen bg-background"><div class="w-64 border-r bg-background h-screen sticky top-0 hidden md:block"><div class="p-6 font-bold text-xl border-b flex items-center gap-2"><span class="text-red-600">Laravel</span> Docs CN</div><div dir="ltr" data-slot="scroll-area" class="relative h-[calc(100vh-65px)]" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><div class="p-4 space-y-6"><div><h4 class="mb-2 px-4 text-sm font-semibold text-muted-foreground">前言</h4><div class="space-y-1"><a class="block" href="/docs/releases"><button data-slot="button" class="inline-flex items-center whitespace-nowrap text-sm transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal">發行說明</button></a></div></div><div><h4 class="mb-2 px-4 text-sm font-semibold text-muted-foreground">入門</h4><div class="space-y-1"><a class="block" href="/docs/installation"><button data-slot="button" class="inline-flex items-center whitespace-nowrap text-sm transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal">安裝</button></a><a class="block" href="/docs/configuration"><button data-slot="button" class="inline-flex items-center whitespace-nowrap text-sm transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal">配置</button></a></div></div></div></div></div></div></div><main class="flex-1 relative"><div class="container mx-auto py-10"><div class="mx-auto max-w-3xl"><div class="mb-8"><h1 class="scroll-m-20 text-4xl font-extrabold tracking-tight lg:text-5xl">CSRF Protection</h1><p class="text-xl text-muted-foreground mt-2">CSRF Protection</p></div><article class="prose prose-slate dark:prose-invert max-w-none"><h1 id="csrf-保護-csrf-protection"><a href="#csrf-保護-csrf-protection">CSRF 保護 (CSRF Protection)</a></h1>
<ul>
<li><a href="#csrf-introduction">簡介</a></li>
<li><a href="#preventing-csrf-requests">防止 CSRF 請求</a>
<ul>
<li><a href="#csrf-excluding-uris">排除特定 URI</a></li>
</ul>
</li>
<li><a href="#csrf-x-csrf-token">X-CSRF-Token</a></li>
<li><a href="#csrf-x-xsrf-token">X-XSRF-Token</a></li>
</ul>
<a name="csrf-introduction"></a>
<h2 id="簡介"><a href="#簡介">簡介</a></h2>
<p>跨站請求偽造 (Cross-site request forgery) 是一種惡意攻擊，會在使用者已通過驗證的情況下代為執行未經授權的操作。所幸，Laravel 讓你可以輕鬆防止 <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">CSRF 攻擊</a>。</p>
<a name="csrf-explanation"></a>
<h4 id="漏洞說明"><a href="#漏洞說明">漏洞說明</a></h4>
<p>若你對跨站請求偽造不熟悉，我們來看一個可能被濫用的例子。假設應用程式有個 <code>/user/email</code> 路由，可接受 <code>POST</code> 請求來修改已驗證使用者的 Email。通常該路由會期待 <code>email</code> 輸入欄位包含使用者想改用的 Email。</p>
<p>沒有 CSRF 保護時，惡意網站可以建立一個 HTML 表單，指向你應用程式的 <code>/user/email</code> 路由，並送出惡意使用者自己的 Email：</p>
<pre><code class="language-blade">&lt;form action=&quot;https://your-application.com/user/email&quot; method=&quot;POST&quot;&gt;
    &lt;input type=&quot;email&quot; value=&quot;malicious-email@example.com&quot;&gt;
&lt;/form&gt;

&lt;script&gt;
    document.forms[0].submit();
&lt;/script&gt;
</code></pre>
<p>若該惡意網站在載入頁面時自動送出表單，攻擊者只要誘使你應用程式的使用者造訪該網站，就能將帳號 Email 變成惡意使用者的 Email。</p>
<p>為了避免這種漏洞，我們需要在每個進來的 <code>POST</code>、<code>PUT</code>、<code>PATCH</code> 或 <code>DELETE</code> 請求上檢查一組惡意應用程式無法得知的秘密 Session 值。</p>
<a name="preventing-csrf-requests"></a>
<h2 id="防止-csrf-請求"><a href="#防止-csrf-請求">防止 CSRF 請求</a></h2>
<p>Laravel 會為每個由應用程式管理的作用中 <a href="/docs/%7B&#x27;12.x&#x27;%7D/session">使用者 Session</a> 自動產生一組 CSRF「Token」。這組 Token 用來確認實際發出請求的人就是該已驗證使用者。由於 Token 儲存在使用者的 Session 中，且每次重新產生 Session 時都會更新，惡意應用程式無法取得它。</p>
<p>當前 Session 的 CSRF Token 可以透過 Request 的 Session 或 <code>csrf_token</code> 輔助函式存取：</p>
<pre><code class="language-php">use Illuminate\Http\Request;

Route::get(&#x27;/token&#x27;, function (Request $request) {
    $token = $request-&gt;session()-&gt;token();

    $token = csrf_token();

    // ...
});
</code></pre>
<p>只要你在應用程式中建立「POST」、「PUT」、「PATCH」或「DELETE」的 HTML 表單，就應該在表單內加入隱藏的 CSRF <code>_token</code> 欄位，讓 CSRF 保護 Middleware 能驗證請求。為了方便，你可以使用 <code>@csrf</code> Blade 指示詞來產生隱藏的 Token 輸入欄位：</p>
<pre><code class="language-blade">&lt;form method=&quot;POST&quot; action=&quot;/profile&quot;&gt;
    @csrf

    &lt;!-- Equivalent to... --&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;_token&quot; value=&quot;{{ csrf_token() }}&quot; /&gt;
&lt;/form&gt;
</code></pre>
<p>預設包含在 <code>web</code> Middleware 群組內的 <code>Illuminate\Foundation\Http\Middleware\ValidateCsrfToken</code> <a href="/docs/%7B&#x27;12.x&#x27;%7D/middleware">Middleware</a> 會自動驗證請求輸入中的 Token 是否與 Session 儲存的 Token 相符。當兩者一致時，我們便能確認是已驗證使用者正在發起請求。</p>
<a name="csrf-tokens-and-spas"></a>
<h3 id="csrf-token-與-spa"><a href="#csrf-token-與-spa">CSRF Token 與 SPA</a></h3>
<p>若你正在建立以 Laravel 作為 API 後端的 SPA，請參考 <a href="/docs/%7B&#x27;12.x&#x27;%7D/sanctum">Laravel Sanctum 文件</a>，瞭解如何與 API 進行驗證並防止 CSRF 漏洞。</p>
<a name="csrf-excluding-uris"></a>
<h3 id="從-csrf-保護中排除-uri"><a href="#從-csrf-保護中排除-uri">從 CSRF 保護中排除 URI</a></h3>
<p>有時你可能想將某些 URI 排除在 CSRF 保護之外。例如，若你使用 <a href="https://stripe.com">Stripe</a> 處理付款並採用他們的 Webhook 系統，就必須將 Stripe Webhook 處理路由排除，因為 Stripe 無法得知要傳給你路由的 CSRF Token。</p>
<p>一般來說，應該把這類路由放在 Laravel 自動套用於 <code>routes/web.php</code> 的 <code>web</code> Middleware 群組之外。不過，你也可以在應用程式的 <code>bootstrap/app.php</code> 中，透過 <code>validateCsrfTokens</code> 方法提供 URI 來排除特定路由：</p>
<pre><code class="language-php">-&gt;withMiddleware(function (Middleware $middleware): void {
    $middleware-&gt;validateCsrfTokens(except: [
        &#x27;stripe/*&#x27;,
        &#x27;http://example.com/foo/bar&#x27;,
        &#x27;http://example.com/foo/*&#x27;,
    ]);
})
</code></pre>
<blockquote>
<p>[!NOTE]
為了方便，<a href="/docs/%7B&#x27;12.x&#x27;%7D/testing">執行測試</a>時會自動停用所有路由的 CSRF Middleware。</p>
</blockquote>
<a name="csrf-x-csrf-token"></a>
<h2 id="x-csrf-token"><a href="#x-csrf-token">X-CSRF-TOKEN</a></h2>
<p>除了檢查作為 POST 參數的 CSRF Token 外，預設包含在 <code>web</code> Middleware 群組內的 <code>Illuminate\Foundation\Http\Middleware\ValidateCsrfToken</code> Middleware 也會檢查 <code>X-CSRF-TOKEN</code> 請求標頭。你可以將 Token 存在 HTML <code>meta</code> 標籤中：</p>
<pre><code class="language-blade">&lt;meta name=&quot;csrf-token&quot; content=&quot;{{ csrf_token() }}&quot;&gt;
</code></pre>
<p>接著，你可以指示像 jQuery 這樣的函式庫，自動將 Token 加到所有請求標頭。這能為使用傳統 JavaScript 技術的 AJAX 應用程式提供簡單且便利的 CSRF 保護：</p>
<pre><code class="language-js">$.ajaxSetup({
  headers: {
    &quot;X-CSRF-TOKEN&quot;: $(&#x27;meta[name=&quot;csrf-token&quot;]&#x27;).attr(&quot;content&quot;),
  },
});
</code></pre>
<a name="csrf-x-xsrf-token"></a>
<h2 id="x-xsrf-token"><a href="#x-xsrf-token">X-XSRF-TOKEN</a></h2>
<p>Laravel 會將目前的 CSRF Token 儲存在加密的 <code>XSRF-TOKEN</code> Cookie 中，且每個由框架產生的回應都會包含此 Cookie。你可以使用 Cookie 的值來設定 <code>X-XSRF-TOKEN</code> 請求標頭。</p>
<p>此 Cookie 主要是為了方便開發者，因為某些 JavaScript 框架與函式庫（例如 Angular 與 Axios）會在同來源請求上自動將它的值放進 <code>X-XSRF-TOKEN</code> 標頭。</p>
<blockquote>
<p>[!NOTE]
預設情況下，<code>resources/js/bootstrap.js</code> 會載入 Axios HTTP 函式庫，它會自動幫你送出 <code>X-XSRF-TOKEN</code> 標頭。</p>
</blockquote></article></div></div><!--$--><!--/$--></main></div><script src="/_next/static/chunks/cbd55ab9639e1e66.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[39756,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"default\"]\n3:I[37457,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"default\"]\n4:I[71435,[\"/_next/static/chunks/796e69ae18b2784c.js\",\"/_next/static/chunks/5f549f56d9b805d8.js\"],\"ScrollArea\"]\n5:I[22016,[\"/_next/static/chunks/796e69ae18b2784c.js\",\"/_next/static/chunks/5f549f56d9b805d8.js\"],\"\"]\nb:I[68027,[],\"default\"]\n:HL[\"/_next/static/chunks/f56971fdd088d69d.css\",\"style\"]\n:HL[\"/_next/static/media/797e433ab948586e-s.p.dbea232f.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/caa3a2e1cccd8315-s.p.853070df.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"2DrqUONp3UGGEsii_P-1z\",\"c\":[\"\",\"docs\",\"csrf\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[[\"slug\",\"csrf\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/f56971fdd088d69d.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"geist_a71539c9-module__T19VSG__variable geist_mono_8d43a2aa-module__8Li5zG__variable antialiased\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/796e69ae18b2784c.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/_next/static/chunks/5f549f56d9b805d8.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"div\",null,{\"className\":\"flex min-h-screen bg-background\",\"children\":[[\"$\",\"div\",null,{\"className\":\"w-64 border-r bg-background h-screen sticky top-0 hidden md:block\",\"children\":[[\"$\",\"div\",null,{\"className\":\"p-6 font-bold text-xl border-b flex items-center gap-2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"text-red-600\",\"children\":\"Laravel\"}],\" Docs CN\"]}],[\"$\",\"$L4\",null,{\"className\":\"h-[calc(100vh-65px)]\",\"children\":[\"$\",\"div\",null,{\"className\":\"p-4 space-y-6\",\"children\":[[\"$\",\"div\",\"前言\",{\"children\":[[\"$\",\"h4\",null,{\"className\":\"mb-2 px-4 text-sm font-semibold text-muted-foreground\",\"children\":\"前言\"}],[\"$\",\"div\",null,{\"className\":\"space-y-1\",\"children\":[[\"$\",\"$L5\",\"/docs/releases\",{\"href\":\"/docs/releases\",\"className\":\"block\",\"children\":[\"$\",\"button\",null,{\"data-slot\":\"button\",\"className\":\"inline-flex items-center whitespace-nowrap text-sm transition-all disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg:not([class*='size-'])]:size-4 shrink-0 [\u0026_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[\u003esvg]:px-2.5 w-full justify-start font-normal\",\"children\":\"發行說明\"}]}]]}]]}],[\"$\",\"div\",\"入門\",{\"children\":[[\"$\",\"h4\",null,{\"className\":\"mb-2 px-4 text-sm font-semibold text-muted-foreground\",\"children\":\"入門\"}],[\"$\",\"div\",null,{\"className\":\"space-y-1\",\"children\":[[\"$\",\"$L5\",\"/docs/installation\",{\"href\":\"/docs/installation\",\"className\":\"block\",\"children\":[\"$\",\"button\",null,{\"data-slot\":\"button\",\"className\":\"inline-flex items-center whitespace-nowrap text-sm transition-all disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg:not([class*='size-'])]:size-4 shrink-0 [\u0026_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[\u003esvg]:px-2.5 w-full justify-start font-normal\",\"children\":\"安裝\"}]}],\"$L6\"]}]]}]]}]}]]}],\"$L7\"]}]]}],{\"children\":[\"$L8\",{\"children\":[\"$L9\",{},null,false,false]},null,false,false]},null,false,false]},null,false,false],\"$La\",false]],\"m\":\"$undefined\",\"G\":[\"$b\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"d:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"OutletBoundary\"]\ne:\"$Sreact.suspense\"\n10:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"ViewportBoundary\"]\n12:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"MetadataBoundary\"]\n6:[\"$\",\"$L5\",\"/docs/configuration\",{\"href\":\"/docs/configuration\",\"className\":\"block\",\"children\":[\"$\",\"button\",null,{\"data-slot\":\"button\",\"className\":\"inline-flex items-center whitespace-nowrap text-sm transition-all disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg:not([class*='size-'])]:size-4 shrink-0 [\u0026_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[\u003esvg]:px-2.5 w-full justify-start font-normal\",\"children\":\"配置\"}]}]\n7:[\"$\",\"main\",null,{\"className\":\"flex-1 relative\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]\n8:[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]\n9:[\"$\",\"$1\",\"c\",{\"children\":[\"$Lc\",null,[\"$\",\"$Ld\",null,{\"children\":[\"$\",\"$e\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@f\"}]}]]}]\na:[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L10\",null,{\"children\":\"$@11\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$L12\",null,{\"children\":[\"$\",\"$e\",null,{\"name\":\"Next.Metadata\",\"children\":\"$@13\"}]}]}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}]\n"])</script><script>self.__next_f.push([1,"c:[\"$\",\"div\",null,{\"className\":\"container mx-auto py-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-3xl\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"scroll-m-20 text-4xl font-extrabold tracking-tight lg:text-5xl\",\"children\":\"CSRF Protection\"}],[\"$\",\"p\",null,{\"className\":\"text-xl text-muted-foreground mt-2\",\"children\":\"CSRF Protection\"}]]}],[\"$\",\"article\",null,{\"className\":\"prose prose-slate dark:prose-invert max-w-none\",\"children\":[[\"$\",\"h1\",null,{\"id\":\"csrf-保護-csrf-protection\",\"children\":[\"$\",\"a\",null,{\"href\":\"#csrf-保護-csrf-protection\",\"children\":\"CSRF 保護 (CSRF Protection)\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#csrf-introduction\",\"children\":\"簡介\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"#preventing-csrf-requests\",\"children\":\"防止 CSRF 請求\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#csrf-excluding-uris\",\"children\":\"排除特定 URI\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#csrf-x-csrf-token\",\"children\":\"X-CSRF-Token\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#csrf-x-xsrf-token\",\"children\":\"X-XSRF-Token\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"a\",null,{\"name\":\"csrf-introduction\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"簡介\",\"children\":[\"$\",\"a\",null,{\"href\":\"#簡介\",\"children\":\"簡介\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"跨站請求偽造 (Cross-site request forgery) 是一種惡意攻擊，會在使用者已通過驗證的情況下代為執行未經授權的操作。所幸，Laravel 讓你可以輕鬆防止 \",[\"$\",\"a\",null,{\"href\":\"https://en.wikipedia.org/wiki/Cross-site_request_forgery\",\"children\":\"CSRF 攻擊\"}],\"。\"]}],\"\\n\",[\"$\",\"a\",null,{\"name\":\"csrf-explanation\"}],\"\\n\",[\"$\",\"h4\",null,{\"id\":\"漏洞說明\",\"children\":[\"$\",\"a\",null,{\"href\":\"#漏洞說明\",\"children\":\"漏洞說明\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"若你對跨站請求偽造不熟悉，我們來看一個可能被濫用的例子。假設應用程式有個 \",[\"$\",\"code\",null,{\"children\":\"/user/email\"}],\" 路由，可接受 \",[\"$\",\"code\",null,{\"children\":\"POST\"}],\" 請求來修改已驗證使用者的 Email。通常該路由會期待 \",[\"$\",\"code\",null,{\"children\":\"email\"}],\" 輸入欄位包含使用者想改用的 Email。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"沒有 CSRF 保護時，惡意網站可以建立一個 HTML 表單，指向你應用程式的 \",[\"$\",\"code\",null,{\"children\":\"/user/email\"}],\" 路由，並送出惡意使用者自己的 Email：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-blade\",\"children\":\"\u003cform action=\\\"https://your-application.com/user/email\\\" method=\\\"POST\\\"\u003e\\n    \u003cinput type=\\\"email\\\" value=\\\"malicious-email@example.com\\\"\u003e\\n\u003c/form\u003e\\n\\n\u003cscript\u003e\\n    document.forms[0].submit();\\n\u003c/script\u003e\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"若該惡意網站在載入頁面時自動送出表單，攻擊者只要誘使你應用程式的使用者造訪該網站，就能將帳號 Email 變成惡意使用者的 Email。\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"為了避免這種漏洞，我們需要在每個進來的 \",[\"$\",\"code\",null,{\"children\":\"POST\"}],\"、\",[\"$\",\"code\",null,{\"children\":\"PUT\"}],\"、\",[\"$\",\"code\",null,{\"children\":\"PATCH\"}],\" 或 \",[\"$\",\"code\",null,{\"children\":\"DELETE\"}],\" 請求上檢查一組惡意應用程式無法得知的秘密 Session 值。\"]}],\"\\n\",[\"$\",\"a\",null,{\"name\":\"preventing-csrf-requests\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"防止-csrf-請求\",\"children\":[\"$\",\"a\",null,{\"href\":\"#防止-csrf-請求\",\"children\":\"防止 CSRF 請求\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Laravel 會為每個由應用程式管理的作用中 \",[\"$\",\"a\",null,{\"href\":\"/docs/%7B'12.x'%7D/session\",\"children\":\"使用者 Session\"}],\" 自動產生一組 CSRF「Token」。這組 Token 用來確認實際發出請求的人就是該已驗證使用者。由於 Token 儲存在使用者的 Session 中，且每次重新產生 Session 時都會更新，惡意應用程式無法取得它。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"當前 Session 的 CSRF Token 可以透過 Request 的 Session 或 \",[\"$\",\"code\",null,{\"children\":\"csrf_token\"}],\" 輔助函式存取：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Illuminate\\\\Http\\\\Request;\\n\\nRoute::get('/token', function (Request $request) {\\n    $token = $request-\u003esession()-\u003etoken();\\n\\n    $token = csrf_token();\\n\\n    // ...\\n});\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"只要你在應用程式中建立「POST」、「PUT」、「PATCH」或「DELETE」的 HTML 表單，就應該在表單內加入隱藏的 CSRF \",[\"$\",\"code\",null,{\"children\":\"_token\"}],\" 欄位，讓 CSRF 保護 Middleware 能驗證請求。為了方便，你可以使用 \",[\"$\",\"code\",null,{\"children\":\"@csrf\"}],\" Blade 指示詞來產生隱藏的 Token 輸入欄位：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-blade\",\"children\":\"\u003cform method=\\\"POST\\\" action=\\\"/profile\\\"\u003e\\n    @csrf\\n\\n    \u003c!-- Equivalent to... --\u003e\\n    \u003cinput type=\\\"hidden\\\" name=\\\"_token\\\" value=\\\"{{ csrf_token() }}\\\" /\u003e\\n\u003c/form\u003e\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"預設包含在 \",[\"$\",\"code\",null,{\"children\":\"web\"}],\" Middleware 群組內的 \",[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Foundation\\\\Http\\\\Middleware\\\\ValidateCsrfToken\"}],\" \",[\"$\",\"a\",null,{\"href\":\"/docs/%7B'12.x'%7D/middleware\",\"children\":\"Middleware\"}],\" 會自動驗證請求輸入中的 Token 是否與 Session 儲存的 Token 相符。當兩者一致時，我們便能確認是已驗證使用者正在發起請求。\"]}],\"\\n\",\"$L14\",\"\\n\",\"$L15\",\"\\n\",\"$L16\",\"\\n\",\"$L17\",\"\\n\",\"$L18\",\"\\n\",\"$L19\",\"\\n\",\"$L1a\",\"\\n\",\"$L1b\",\"\\n\",\"$L1c\",\"\\n\",\"$L1d\",\"\\n\",\"$L1e\",\"\\n\",\"$L1f\",\"\\n\",\"$L20\",\"\\n\",\"$L21\",\"\\n\",\"$L22\",\"\\n\",\"$L23\",\"\\n\",\"$L24\",\"\\n\",\"$L25\",\"\\n\",\"$L26\",\"\\n\",\"$L27\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"14:[\"$\",\"a\",null,{\"name\":\"csrf-tokens-and-spas\"}]\n15:[\"$\",\"h3\",null,{\"id\":\"csrf-token-與-spa\",\"children\":[\"$\",\"a\",null,{\"href\":\"#csrf-token-與-spa\",\"children\":\"CSRF Token 與 SPA\"}]}]\n16:[\"$\",\"p\",null,{\"children\":[\"若你正在建立以 Laravel 作為 API 後端的 SPA，請參考 \",[\"$\",\"a\",null,{\"href\":\"/docs/%7B'12.x'%7D/sanctum\",\"children\":\"Laravel Sanctum 文件\"}],\"，瞭解如何與 API 進行驗證並防止 CSRF 漏洞。\"]}]\n17:[\"$\",\"a\",null,{\"name\":\"csrf-excluding-uris\"}]\n18:[\"$\",\"h3\",null,{\"id\":\"從-csrf-保護中排除-uri\",\"children\":[\"$\",\"a\",null,{\"href\":\"#從-csrf-保護中排除-uri\",\"children\":\"從 CSRF 保護中排除 URI\"}]}]\n19:[\"$\",\"p\",null,{\"children\":[\"有時你可能想將某些 URI 排除在 CSRF 保護之外。例如，若你使用 \",[\"$\",\"a\",null,{\"href\":\"https://stripe.com\",\"children\":\"Stripe\"}],\" 處理付款並採用他們的 Webhook 系統，就必須將 Stripe Webhook 處理路由排除，因為 Stripe 無法得知要傳給你路由的 CSRF Token。\"]}]\n1a:[\"$\",\"p\",null,{\"children\":[\"一般來說，應該把這類路由放在 Laravel 自動套用於 \",[\"$\",\"code\",null,{\"children\":\"routes/web.php\"}],\" 的 \",[\"$\",\"code\",null,{\"children\":\"web\"}],\" Middleware 群組之外。不過，你也可以在應用程式的 \",[\"$\",\"code\",null,{\"children\":\"bootstrap/app.php\"}],\" 中，透過 \",[\"$\",\"code\",null,{\"children\":\"validateCsrfTokens\"}],\" 方法提供 URI 來排除特定路由：\"]}]\n1b:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"-\u003ewithMiddleware(function (Middleware $middleware): void {\\n    $middleware-\u003evalidateCsrfTokens(except: [\\n        'stripe/*',\\n        'http://example.com/foo/bar',\\n        'http://example.com/foo/*',\\n    ]);\\n})\\n\"}]}]\n1c:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!NOTE]\\n為了方便，\",[\"$\",\"a\",null,{\"href\":\"/docs/%7B'12.x'%7D/testing\",\"children\":\"執行測試\"}],\"時會自動停用所有路由的 CSRF Middleware。\"]}],\"\\n\"]}]\n1d:[\"$\",\"a\",null,{\"name\":\"csrf-x-csrf-token\"}]\n1e:[\"$\",\"h2\",null,{\"id\":\"x-csrf-token\",\"children\":[\"$\",\"a\",null,{\"href\":\"#x-csrf-token\",\"children\":\"X-CSRF-TOKEN\"}]}]\n1f:[\"$\",\"p\",null,{\"children\":[\"除了檢查作為 POST 參數的 CSRF Token 外，預設包含在 \",[\"$\",\"code\",null,{\"children\":\"web\"}],\" Middleware 群組內的 \",[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Foundation\\\\Http\\\\Middleware\\\\ValidateCsrfToken\"}],\" Middleware 也會檢查 \",[\"$\",\"code\",null,{\"children\":\"X-CSRF-TOKEN\"}],\" 請求標頭。你可以將 Token 存在 HTML \",[\"$\",\"code\",null,{\"children\":\"meta\"}],\" 標籤中：\"]}]\n20:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-blade\",\"children\":\"\u003cmeta name=\\\"csrf-token\\\" content=\\\"{{ csrf_token() }}\\\"\u003e\\n\"}]}]\n21:[\"$\",\"p\",null,{\"children\":\"接著，你可以指示像 jQuery 這樣的函式庫，自動將 Token 加到所有請求標頭。這能為使用傳統 JavaScript 技術的 AJAX 應用程式提供簡單且便利的 CSRF 保護：\"}]\n22:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-js\",\"children\":\"$$.ajaxSetup({\\n  headers: {\\n    \\\"X-CSRF-TOKEN\\\": $('meta[name=\\\"csrf-token\\\"]').attr(\\\"content\\\"),\\n  },\\n});\\n\"}]}]\n23:[\"$\",\"a\",null,{\"name\":\"csrf-x-xsrf-token\"}]\n24:[\"$\",\"h2\",null,{\"id\":\"x-xsrf-token\",\"children\":[\"$\",\"a\",null,{\"href\":\"#x-xsrf-token\",\"children\":\"X-XSRF-TOKEN\"}]}]\n25:[\"$\",\"p\",null,{\"children\":[\"Laravel 會將目前的 CSRF Token 儲存在加密的 \",[\"$\",\"code\",null,{\"children\":\"XSRF-TOKEN\"}],\" Cookie 中，且每個由框架產生的回應都會包含此 Cookie。你可以使用 Cookie 的值來設定 \",[\"$\",\"code\",null,{\"children\":\"X-XSRF-TOKEN\"}],\" 請求標頭。\"]}]\n26:[\"$\",\"p\",null,{\"children\":[\"此 Cookie 主要是為了方便開發者，因為某些 JavaScript 框架與函式庫（例如 Angular 與 Axios）會在同來源請求上自動將它的值放進 \",[\"$\",\"code\",null,{\"children\":\"X-XSRF-TOKEN\"}],\" 標頭。\"]}]\n27:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!NOTE]\\n預設情況下，\",[\"$\",\"code\",null,{\"children\":\"resources/js/bootstrap.js\"}],\" 會載入 A"])</script><script>self.__next_f.push([1,"xios HTTP 函式庫，它會自動幫你送出 \",[\"$\",\"code\",null,{\"children\":\"X-XSRF-TOKEN\"}],\" 標頭。\"]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"11:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"28:I[27201,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"IconMark\"]\n13:[[\"$\",\"title\",\"0\",{\"children\":\"Create Next App\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Generated by create next app\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/favicon.ico?favicon.0b3bf435.ico\",\"sizes\":\"256x256\",\"type\":\"image/x-icon\"}],[\"$\",\"$L28\",\"3\",{}]]\nf:null\n"])</script></body></html>