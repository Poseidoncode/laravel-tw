<!DOCTYPE html><!--c2cpI4EdIeAozP6eEqxqR--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/797e433ab948586e-s.p.dbea232f.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/caa3a2e1cccd8315-s.p.853070df.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/chunks/8d8bfdb8c7183f74.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/cbd55ab9639e1e66.js"/><script src="/_next/static/chunks/87a939617be2fa8c.js" async=""></script><script src="/_next/static/chunks/8368f298651cbd89.js" async=""></script><script src="/_next/static/chunks/6740f161f60c6ab5.js" async=""></script><script src="/_next/static/chunks/turbopack-929fc2ce3ca903db.js" async=""></script><script src="/_next/static/chunks/ff1a16fafef87110.js" async=""></script><script src="/_next/static/chunks/247eb132b7f7b574.js" async=""></script><script src="/_next/static/chunks/796e69ae18b2784c.js" async=""></script><script src="/_next/static/chunks/97c0560122aa0f49.js" async=""></script><meta name="next-size-adjust" content=""/><title>Create Next App</title><meta name="description" content="Generated by create next app"/><link rel="icon" href="/favicon.ico?favicon.0b3bf435.ico" sizes="256x256" type="image/x-icon"/><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="geist_a71539c9-module__T19VSG__variable geist_mono_8d43a2aa-module__8Li5zG__variable antialiased"><div hidden=""><!--$--><!--/$--></div><div class="flex min-h-screen bg-background"><div class="w-64 border-r bg-background h-screen sticky top-0 hidden md:block"><div class="p-6 font-bold text-xl border-b flex items-center gap-2"><span class="text-red-600">Laravel</span> Docs（中文）</div><div dir="ltr" data-slot="scroll-area" class="relative h-[calc(100vh-65px)]" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><div class="p-4 space-y-2"><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>前言</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down h-4 w-4" aria-hidden="true"><path d="m6 9 6 6 6-6"></path></svg></button><div class="ml-4 mt-1 space-y-1"><a class="block" href="/docs/releases"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">發行說明</button></a></div></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>入門</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down h-4 w-4" aria-hidden="true"><path d="m6 9 6 6 6-6"></path></svg></button><div class="ml-4 mt-1 space-y-1"><a class="block" href="/docs/installation"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">安裝</button></a><a class="block" href="/docs/configuration"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">配置</button></a><a class="block" href="/docs/structure"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">目錄結構</button></a><a class="block" href="/docs/lifecycle"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">生命週期</button></a><a class="block" href="/docs/frontend"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">前端</button></a><a class="block" href="/docs/starter-kits"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">啟動套件</button></a><a class="block" href="/docs/deployment"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">部署</button></a></div></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>架構</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>基礎功能</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>深入探討</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>安全性</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>資料庫</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>Eloquent ORM</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>測試</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>其他</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>官方套件</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div class="border-t pt-4 space-y-2"><a class="block" href="/docs/api"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">API 文件</button></a><a class="block" href="/docs/releases"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">更新日誌</button></a></div></div></div></div></div></div><main class="flex-1 relative"><div class="container mx-auto py-10"><div class="mx-auto max-w-3xl"><div class="mb-8"><h1 class="scroll-m-20 text-4xl font-extrabold tracking-tight lg:text-5xl">Middleware</h1><p class="text-xl text-muted-foreground mt-2">Middleware</p></div><article class="prose prose-slate dark:prose-invert max-w-none"><h1 id="中介軟體-middleware"><a href="#中介軟體-middleware">中介軟體 (Middleware)</a></h1>
<ul>
<li><a href="#introduction">簡介</a></li>
<li><a href="#defining-middleware">定義 Middleware</a></li>
<li><a href="#registering-middleware">註冊 Middleware</a>
<ul>
<li><a href="#global-middleware">全域 Middleware</a></li>
<li><a href="#assigning-middleware-to-routes">將 Middleware 分配給路由</a></li>
<li><a href="#middleware-groups">Middleware 群組</a></li>
<li><a href="#middleware-aliases">Middleware 別名</a></li>
<li><a href="#sorting-middleware">排序 Middleware</a></li>
</ul>
</li>
<li><a href="#middleware-parameters">Middleware 參數</a></li>
<li><a href="#terminable-middleware">可終止的 Middleware</a></li>
</ul>
<a name="introduction"></a>
<h2 id="簡介"><a href="#簡介">簡介</a></h2>
<p>Middleware 提供了一個方便的機制來檢查和過濾進入應用程式的 HTTP 請求。例如，Laravel 包含一個 Middleware，用於驗證應用程式的使用者是否已驗證。如果使用者未驗證，Middleware 將把使用者重新導向到應用程式的登入畫面。但是，如果使用者已驗證，Middleware 將允許請求進一步進入應用程式。</p>
<p>除了驗證之外，還可以編寫其他 Middleware 來執行各種任務。例如，日誌記錄 Middleware 可能會記錄所有傳入應用程式的請求。Laravel 包含多種 Middleware，包括用於驗證和 CSRF 保護的 Middleware；但是，所有使用者定義的 Middleware 通常位於應用程式的 <code>app/Http/Middleware</code> 目錄中。</p>
<a name="defining-middleware"></a>
<h2 id="定義-middleware"><a href="#定義-middleware">定義 Middleware</a></h2>
<p>要建立新的 Middleware，請使用 <code>make:middleware</code> Artisan 指令：</p>
<pre><code class="language-shell">php artisan make:middleware EnsureTokenIsValid
</code></pre>
<p>此指令將在您的 <code>app/Http/Middleware</code> 目錄中放置一個新的 <code>EnsureTokenIsValid</code> 類別。在此 Middleware 中，我們只會在提供的 <code>token</code> 輸入與指定值匹配時允許存取路由。否則，我們會將使用者重新導向回 <code>/home</code> URI：</p>
<pre><code class="language-php">&lt;?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class EnsureTokenIsValid
{
    /**
     * Handle an incoming request.
     *
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */
    public function handle(Request $request, Closure $next): Response
    {
        if ($request-&gt;input(&#x27;token&#x27;) !== &#x27;my-secret-token&#x27;) {
            return redirect(&#x27;/home&#x27;);
        }

        return $next($request);
    }
}
</code></pre>
<p>如您所見，如果給定的 <code>token</code> 與我們的秘密 Token 不匹配，Middleware 將向客戶端返回 HTTP 重新導向；否則，請求將進一步傳遞到應用程式中。要將請求更深入地傳遞到應用程式中（允許 Middleware「通過」），您應該使用 <code>$request</code> 呼叫 <code>$next</code> Callback。</p>
<p>最好將 Middleware 想像為一系列「層」，HTTP 請求必須通過這些層才能到達您的應用程式。每一層都可以檢查請求，甚至完全拒絕它。</p>
<blockquote>
<p>[!NOTE]
所有 Middleware 都透過 <a href="/docs/%7B&#x27;12.x&#x27;%7D/container">Service Container</a> 解析，因此您可以在 Middleware 的建構子中對所需的任何依賴項進行型別提示。</p>
</blockquote>
<a name="middleware-and-responses"></a>
<h4 id="middleware-與回應"><a href="#middleware-與回應">Middleware 與回應</a></h4>
<p>當然，Middleware 可以在將請求更深入地傳遞到應用程式之前或之後執行任務。例如，以下 Middleware 將在應用程式處理請求<strong>之前</strong>執行某些任務：</p>
<pre><code class="language-php">&lt;?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class BeforeMiddleware
{
    public function handle(Request $request, Closure $next): Response
    {
        // Perform action

        return $next($request);
    }
}
</code></pre>
<p>但是，此 Middleware 將在應用程式處理請求<strong>之後</strong>執行其任務：</p>
<pre><code class="language-php">&lt;?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class AfterMiddleware
{
    public function handle(Request $request, Closure $next): Response
    {
        $response = $next($request);

        // Perform action

        return $response;
    }
}
</code></pre>
<a name="registering-middleware"></a>
<h2 id="註冊-middleware"><a href="#註冊-middleware">註冊 Middleware</a></h2>
<a name="global-middleware"></a>
<h3 id="全域-middleware"><a href="#全域-middleware">全域 Middleware</a></h3>
<p>如果您希望 Middleware 在應用程式的每個 HTTP 請求期間執行，您可以在應用程式的 <code>bootstrap/app.php</code> 檔案中將其附加到全域 Middleware 堆疊：</p>
<pre><code class="language-php">use App\Http\Middleware\EnsureTokenIsValid;

-&gt;withMiddleware(function (Middleware $middleware): void {
     $middleware-&gt;append(EnsureTokenIsValid::class);
})
</code></pre>
<p>提供給 <code>withMiddleware</code> Closure 的 <code>$middleware</code> 物件是 <code>Illuminate\Foundation\Configuration\Middleware</code> 的實例，負責管理分配給應用程式路由的 Middleware。<code>append</code> 方法將 Middleware 新增到全域 Middleware 清單的末尾。如果您想將 Middleware 新增到清單的開頭，應使用 <code>prepend</code> 方法。</p>
<a name="manually-managing-laravels-default-global-middleware"></a>
<h4 id="手動管理-laravel-的預設全域-middleware"><a href="#手動管理-laravel-的預設全域-middleware">手動管理 Laravel 的預設全域 Middleware</a></h4>
<p>如果您想手動管理 Laravel 的全域 Middleware 堆疊，您可以將 Laravel 的預設全域 Middleware 堆疊提供給 <code>use</code> 方法。然後，您可以根據需要調整預設的 Middleware 堆疊：</p>
<pre><code class="language-php">-&gt;withMiddleware(function (Middleware $middleware): void {
    $middleware-&gt;use([
        \Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks::class,
        // \Illuminate\Http\Middleware\TrustHosts::class,
        \Illuminate\Http\Middleware\TrustProxies::class,
        \Illuminate\Http\Middleware\HandleCors::class,
        \Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance::class,
        \Illuminate\Http\Middleware\ValidatePostSize::class,
        \Illuminate\Foundation\Http\Middleware\TrimStrings::class,
        \Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull::class,
    ]);
})
</code></pre>
<a name="assigning-middleware-to-routes"></a>
<h3 id="將-middleware-分配給路由"><a href="#將-middleware-分配給路由">將 Middleware 分配給路由</a></h3>
<p>如果您想將 Middleware 分配給特定路由，您可以在定義路由時呼叫 <code>middleware</code> 方法：</p>
<pre><code class="language-php">use App\Http\Middleware\EnsureTokenIsValid;

Route::get(&#x27;/profile&#x27;, function () {
    // ...
})-&gt;middleware(EnsureTokenIsValid::class);
</code></pre>
<p>您可以透過將 Middleware 名稱陣列傳遞給 <code>middleware</code> 方法來將多個 Middleware 分配給路由：</p>
<pre><code class="language-php">Route::get(&#x27;/&#x27;, function () {
    // ...
})-&gt;middleware([First::class, Second::class]);
</code></pre>
<a name="excluding-middleware"></a>
<h4 id="排除-middleware"><a href="#排除-middleware">排除 Middleware</a></h4>
<p>將 Middleware 分配給一組路由時，您可能偶爾需要防止 Middleware 應用於群組內的單個路由。您可以使用 <code>withoutMiddleware</code> 方法來實現：</p>
<pre><code class="language-php">use App\Http\Middleware\EnsureTokenIsValid;

Route::middleware([EnsureTokenIsValid::class])-&gt;group(function () {
    Route::get(&#x27;/&#x27;, function () {
        // ...
    });

    Route::get(&#x27;/profile&#x27;, function () {
        // ...
    })-&gt;withoutMiddleware([EnsureTokenIsValid::class]);
});
</code></pre>
<p>您還可以從整個路由定義 <a href="/docs/%7B&#x27;12.x&#x27;%7D/routing#route-groups">群組</a> 中排除給定的 Middleware 集：</p>
<pre><code class="language-php">use App\Http\Middleware\EnsureTokenIsValid;

Route::withoutMiddleware([EnsureTokenIsValid::class])-&gt;group(function () {
    Route::get(&#x27;/profile&#x27;, function () {
        // ...
    });
});
</code></pre>
<p><code>withoutMiddleware</code> 方法只能移除路由 Middleware，不適用於 <a href="#global-middleware">全域 Middleware</a>。</p>
<a name="middleware-groups"></a>
<h3 id="middleware-群組"><a href="#middleware-群組">Middleware 群組</a></h3>
<p>有時您可能希望將多個 Middleware 分組在單個鍵下，以便更容易將它們分配給路由。您可以在應用程式的 <code>bootstrap/app.php</code> 檔案中使用 <code>appendToGroup</code> 方法來實現：</p>
<pre><code class="language-php">use App\Http\Middleware\First;
use App\Http\Middleware\Second;

-&gt;withMiddleware(function (Middleware $middleware): void {
    $middleware-&gt;appendToGroup(&#x27;group-name&#x27;, [
        First::class,
        Second::class,
    ]);

    $middleware-&gt;prependToGroup(&#x27;group-name&#x27;, [
        First::class,
        Second::class,
    ]);
})
</code></pre>
<p>Middleware 群組可以使用與單個 Middleware 相同的語法分配給路由和 Controller Action：</p>
<pre><code class="language-php">Route::get(&#x27;/&#x27;, function () {
    // ...
})-&gt;middleware(&#x27;group-name&#x27;);

Route::middleware([&#x27;group-name&#x27;])-&gt;group(function () {
    // ...
});
</code></pre>
<a name="laravels-default-middleware-groups"></a>
<h4 id="laravel-的預設-middleware-群組"><a href="#laravel-的預設-middleware-群組">Laravel 的預設 Middleware 群組</a></h4>
<p>Laravel 包含預定義的 <code>web</code> 和 <code>api</code> Middleware 群組，其中包含您可能想要應用於 Web 和 API 路由的常見 Middleware。請記住，Laravel 會自動將這些 Middleware 群組應用於相應的 <code>routes/web.php</code> 和 <code>routes/api.php</code> 檔案：</p>
<div class="overflow-auto"><table><thead><tr><th><code>web</code> Middleware 群組</th></tr></thead><tbody><tr><td><code>Illuminate\Cookie\Middleware\EncryptCookies</code></td></tr><tr><td><code>Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse</code></td></tr><tr><td><code>Illuminate\Session\Middleware\StartSession</code></td></tr><tr><td><code>Illuminate\View\Middleware\ShareErrorsFromSession</code></td></tr><tr><td><code>Illuminate\Foundation\Http\Middleware\ValidateCsrfToken</code></td></tr><tr><td><code>Illuminate\Routing\Middleware\SubstituteBindings</code></td></tr></tbody></table></div>
<div class="overflow-auto"><table><thead><tr><th><code>api</code> Middleware 群組</th></tr></thead><tbody><tr><td><code>Illuminate\Routing\Middleware\SubstituteBindings</code></td></tr></tbody></table></div>
<p>如果您想將 Middleware 附加或前置到這些群組，您可以在應用程式的 <code>bootstrap/app.php</code> 檔案中使用 <code>web</code> 和 <code>api</code> 方法。<code>web</code> 和 <code>api</code> 方法是 <code>appendToGroup</code> 方法的便捷替代方案：</p>
<pre><code class="language-php">use App\Http\Middleware\EnsureTokenIsValid;
use App\Http\Middleware\EnsureUserIsSubscribed;

-&gt;withMiddleware(function (Middleware $middleware): void {
    $middleware-&gt;web(append: [
        EnsureUserIsSubscribed::class,
    ]);

    $middleware-&gt;api(prepend: [
        EnsureTokenIsValid::class,
    ]);
})
</code></pre>
<p>您甚至可以用您自己的自訂 Middleware 替換 Laravel 的預設 Middleware 群組項目之一：</p>
<pre><code class="language-php">use App\Http\Middleware\StartCustomSession;
use Illuminate\Session\Middleware\StartSession;

$middleware-&gt;web(replace: [
    StartSession::class =&gt; StartCustomSession::class,
]);
</code></pre>
<p>或者，您可以完全移除 Middleware：</p>
<pre><code class="language-php">$middleware-&gt;web(remove: [
    StartSession::class,
]);
</code></pre>
<a name="manually-managing-laravels-default-middleware-groups"></a>
<h4 id="手動管理-laravel-的預設-middleware-群組"><a href="#手動管理-laravel-的預設-middleware-群組">手動管理 Laravel 的預設 Middleware 群組</a></h4>
<p>如果您想手動管理 Laravel 預設 <code>web</code> 和 <code>api</code> Middleware 群組中的所有 Middleware，您可以完全重新定義這些群組。以下範例將使用其預設 Middleware 定義 <code>web</code> 和 <code>api</code> Middleware 群組，允許您根據需要自訂它們：</p>
<pre><code class="language-php">-&gt;withMiddleware(function (Middleware $middleware): void {
    $middleware-&gt;group(&#x27;web&#x27;, [
        \Illuminate\Cookie\Middleware\EncryptCookies::class,
        \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,
        \Illuminate\Session\Middleware\StartSession::class,
        \Illuminate\View\Middleware\ShareErrorsFromSession::class,
        \Illuminate\Foundation\Http\Middleware\ValidateCsrfToken::class,
        \Illuminate\Routing\Middleware\SubstituteBindings::class,
        // \Illuminate\Session\Middleware\AuthenticateSession::class,
    ]);

    $middleware-&gt;group(&#x27;api&#x27;, [
        // \Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful::class,
        // &#x27;throttle:api&#x27;,
        \Illuminate\Routing\Middleware\SubstituteBindings::class,
    ]);
})
</code></pre>
<blockquote>
<p>[!NOTE]
預設情況下，<code>web</code> 和 <code>api</code> Middleware 群組會由 <code>bootstrap/app.php</code> 檔案自動應用於應用程式對應的 <code>routes/web.php</code> 和 <code>routes/api.php</code> 檔案。</p>
</blockquote>
<a name="middleware-aliases"></a>
<h3 id="middleware-別名"><a href="#middleware-別名">Middleware 別名</a></h3>
<p>您可以在應用程式的 <code>bootstrap/app.php</code> 檔案中為 Middleware 分配別名。Middleware 別名允許您為給定的 Middleware 類別定義簡短的別名，這對於具有長類別名稱的 Middleware 特別有用：</p>
<pre><code class="language-php">use App\Http\Middleware\EnsureUserIsSubscribed;

-&gt;withMiddleware(function (Middleware $middleware): void {
    $middleware-&gt;alias([
        &#x27;subscribed&#x27; =&gt; EnsureUserIsSubscribed::class
    ]);
})
</code></pre>
<p>一旦在應用程式的 <code>bootstrap/app.php</code> 檔案中定義了 Middleware 別名，您就可以在將 Middleware 分配給路由時使用該別名：</p>
<pre><code class="language-php">Route::get(&#x27;/profile&#x27;, function () {
    // ...
})-&gt;middleware(&#x27;subscribed&#x27;);
</code></pre>
<p>為了方便起見，Laravel 的一些內建 Middleware 預設已設定別名。例如，<code>auth</code> Middleware 是 <code>Illuminate\Auth\Middleware\Authenticate</code> Middleware 的別名。以下是預設 Middleware 別名的清單：</p>
<div class="overflow-auto"><table><thead><tr><th>別名</th><th>Middleware</th></tr></thead><tbody><tr><td><code>auth</code></td><td><code>Illuminate\Auth\Middleware\Authenticate</code></td></tr><tr><td><code>auth.basic</code></td><td><code>Illuminate\Auth\Middleware\AuthenticateWithBasicAuth</code></td></tr><tr><td><code>auth.session</code></td><td><code>Illuminate\Session\Middleware\AuthenticateSession</code></td></tr><tr><td><code>cache.headers</code></td><td><code>Illuminate\Http\Middleware\SetCacheHeaders</code></td></tr><tr><td><code>can</code></td><td><code>Illuminate\Auth\Middleware\Authorize</code></td></tr><tr><td><code>guest</code></td><td><code>Illuminate\Auth\Middleware\RedirectIfAuthenticated</code></td></tr><tr><td><code>password.confirm</code></td><td><code>Illuminate\Auth\Middleware\RequirePassword</code></td></tr><tr><td><code>precognitive</code></td><td><code>Illuminate\Foundation\Http\Middleware\HandlePrecognitiveRequests</code></td></tr><tr><td><code>signed</code></td><td><code>Illuminate\Routing\Middleware\ValidateSignature</code></td></tr><tr><td><code>subscribed</code></td><td><code>\Spark\Http\Middleware\VerifyBillableIsSubscribed</code></td></tr><tr><td><code>throttle</code></td><td><code>Illuminate\Routing\Middleware\ThrottleRequests</code> or <code>Illuminate\Routing\Middleware\ThrottleRequestsWithRedis</code></td></tr><tr><td><code>verified</code></td><td><code>Illuminate\Auth\Middleware\EnsureEmailIsVerified</code></td></tr></tbody></table></div>
<a name="sorting-middleware"></a>
<h3 id="排序-middleware"><a href="#排序-middleware">排序 Middleware</a></h3>
<p>在極少數情況下，您可能需要 Middleware 以特定順序執行，但在將它們分配給路由時無法控制它們的順序。在這些情況下，您可以在應用程式的 <code>bootstrap/app.php</code> 檔案中使用 <code>priority</code> 方法指定 Middleware 優先順序：</p>
<pre><code class="language-php">-&gt;withMiddleware(function (Middleware $middleware): void {
    $middleware-&gt;priority([
        \Illuminate\Foundation\Http\Middleware\HandlePrecognitiveRequests::class,
        \Illuminate\Cookie\Middleware\EncryptCookies::class,
        \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,
        \Illuminate\Session\Middleware\StartSession::class,
        \Illuminate\View\Middleware\ShareErrorsFromSession::class,
        \Illuminate\Foundation\Http\Middleware\ValidateCsrfToken::class,
        \Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful::class,
        \Illuminate\Routing\Middleware\ThrottleRequests::class,
        \Illuminate\Routing\Middleware\ThrottleRequestsWithRedis::class,
        \Illuminate\Routing\Middleware\SubstituteBindings::class,
        \Illuminate\Contracts\Auth\Middleware\AuthenticatesRequests::class,
        \Illuminate\Auth\Middleware\Authorize::class,
    ]);
})
</code></pre>
<a name="middleware-parameters"></a>
<h2 id="middleware-參數"><a href="#middleware-參數">Middleware 參數</a></h2>
<p>Middleware 也可以接收額外的參數。例如，如果您的應用程式需要在執行給定動作之前驗證經過驗證的使用者是否具有給定的「角色」，您可以建立一個 <code>EnsureUserHasRole</code> Middleware，該 Middleware 接收角色名稱作為額外參數。</p>
<p>額外的 Middleware 參數將在 <code>$next</code> 參數之後傳遞給 Middleware：</p>
<pre><code class="language-php">&lt;?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class EnsureUserHasRole
{
    /**
     * Handle an incoming request.
     *
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */
    public function handle(Request $request, Closure $next, string $role): Response
    {
        if (! $request-&gt;user()-&gt;hasRole($role)) {
            // Redirect...
        }

        return $next($request);
    }
}
</code></pre>
<p>在定義路由時，可以透過使用 <code>:</code> 分隔 Middleware 名稱和參數來指定 Middleware 參數：</p>
<pre><code class="language-php">use App\Http\Middleware\EnsureUserHasRole;

Route::put(&#x27;/post/{&#x27;{id}&#x27;}&#x27;, function (string $id) {
    // ...
})-&gt;middleware(EnsureUserHasRole::class.&#x27;:editor&#x27;);
</code></pre>
<p>多個參數可以用逗號分隔：</p>
<pre><code class="language-php">Route::put(&#x27;/post/{&#x27;{id}&#x27;}&#x27;, function (string $id) {
    // ...
})-&gt;middleware(EnsureUserHasRole::class.&#x27;:editor,publisher&#x27;);
</code></pre>
<a name="terminable-middleware"></a>
<h2 id="可終止的-middleware"><a href="#可終止的-middleware">可終止的 Middleware</a></h2>
<p>有時 Middleware 可能需要在 HTTP 回應已發送到瀏覽器之後執行某些工作。如果您在 Middleware 上定義了 <code>terminate</code> 方法，並且您的 Web 伺服器正在使用 <a href="https://www.php.net/manual/en/install.fpm.php">FastCGI</a>，則在回應發送到瀏覽器後，<code>terminate</code> 方法將自動被呼叫：</p>
<pre><code class="language-php">&lt;?php

namespace Illuminate\Session\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class TerminatingMiddleware
{
    /**
     * Handle an incoming request.
     *
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */
    public function handle(Request $request, Closure $next): Response
    {
        return $next($request);
    }

    /**
     * Handle tasks after the response has been sent to the browser.
     */
    public function terminate(Request $request, Response $response): void
    {
        // ...
    }
}
</code></pre>
<p><code>terminate</code> 方法應同時接收請求和回應。一旦您定義了可終止的 Middleware，您應該將其新增到應用程式 <code>bootstrap/app.php</code> 檔案中的路由或全域 Middleware 清單中。</p>
<p>在 Middleware 上呼叫 <code>terminate</code> 方法時，Laravel 將從 <a href="/docs/%7B&#x27;12.x&#x27;%7D/container">Service Container</a> 解析 Middleware 的新實例。如果您希望在呼叫 <code>handle</code> 和 <code>terminate</code> 方法時使用相同的 Middleware 實例，請使用 Container 的 <code>singleton</code> 方法向 Container 註冊 Middleware。通常這應該在您的 <code>AppServiceProvider</code> 的 <code>register</code> 方法中完成：</p>
<pre><code class="language-php">use App\Http\Middleware\TerminatingMiddleware;

/**
 * Register any application services.
 */
public function register(): void
{
    $this-&gt;app-&gt;singleton(TerminatingMiddleware::class);
}
</code></pre></article></div></div><!--$--><!--/$--></main></div><script src="/_next/static/chunks/cbd55ab9639e1e66.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[39756,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"default\"]\n3:I[37457,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"default\"]\n4:I[93649,[\"/_next/static/chunks/796e69ae18b2784c.js\",\"/_next/static/chunks/97c0560122aa0f49.js\"],\"DocsSidebar\"]\n6:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"OutletBoundary\"]\n7:\"$Sreact.suspense\"\n9:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"ViewportBoundary\"]\nb:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"MetadataBoundary\"]\nd:I[68027,[],\"default\"]\n:HL[\"/_next/static/chunks/8d8bfdb8c7183f74.css\",\"style\"]\n:HL[\"/_next/static/media/797e433ab948586e-s.p.dbea232f.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/caa3a2e1cccd8315-s.p.853070df.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"c2cpI4EdIeAozP6eEqxqR\",\"c\":[\"\",\"docs\",\"middleware\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[[\"slug\",\"middleware\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/8d8bfdb8c7183f74.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"geist_a71539c9-module__T19VSG__variable geist_mono_8d43a2aa-module__8Li5zG__variable antialiased\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/796e69ae18b2784c.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/_next/static/chunks/97c0560122aa0f49.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"div\",null,{\"className\":\"flex min-h-screen bg-background\",\"children\":[[\"$\",\"$L4\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-1 relative\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@8\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L9\",null,{\"children\":\"$@a\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$Lb\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.Metadata\",\"children\":\"$@c\"}]}]}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"className\":\"container mx-auto py-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-3xl\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"scroll-m-20 text-4xl font-extrabold tracking-tight lg:text-5xl\",\"children\":\"Middleware\"}],[\"$\",\"p\",null,{\"className\":\"text-xl text-muted-foreground mt-2\",\"children\":\"Middleware\"}]]}],[\"$\",\"article\",null,{\"className\":\"prose prose-slate dark:prose-invert max-w-none\",\"children\":[[\"$\",\"h1\",null,{\"id\":\"中介軟體-middleware\",\"children\":[\"$\",\"a\",null,{\"href\":\"#中介軟體-middleware\",\"children\":\"中介軟體 (Middleware)\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#introduction\",\"children\":\"簡介\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#defining-middleware\",\"children\":\"定義 Middleware\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"#registering-middleware\",\"children\":\"註冊 Middleware\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#global-middleware\",\"children\":\"全域 Middleware\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#assigning-middleware-to-routes\",\"children\":\"將 Middleware 分配給路由\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#middleware-groups\",\"children\":\"Middleware 群組\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#middleware-aliases\",\"children\":\"Middleware 別名\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#sorting-middleware\",\"children\":\"排序 Middleware\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#middleware-parameters\",\"children\":\"Middleware 參數\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#terminable-middleware\",\"children\":\"可終止的 Middleware\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"a\",null,{\"name\":\"introduction\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"簡介\",\"children\":[\"$\",\"a\",null,{\"href\":\"#簡介\",\"children\":\"簡介\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Middleware 提供了一個方便的機制來檢查和過濾進入應用程式的 HTTP 請求。例如，Laravel 包含一個 Middleware，用於驗證應用程式的使用者是否已驗證。如果使用者未驗證，Middleware 將把使用者重新導向到應用程式的登入畫面。但是，如果使用者已驗證，Middleware 將允許請求進一步進入應用程式。\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"除了驗證之外，還可以編寫其他 Middleware 來執行各種任務。例如，日誌記錄 Middleware 可能會記錄所有傳入應用程式的請求。Laravel 包含多種 Middleware，包括用於驗證和 CSRF 保護的 Middleware；但是，所有使用者定義的 Middleware 通常位於應用程式的 \",[\"$\",\"code\",null,{\"children\":\"app/Http/Middleware\"}],\" 目錄中。\"]}],\"\\n\",[\"$\",\"a\",null,{\"name\":\"defining-middleware\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"定義-middleware\",\"children\":[\"$\",\"a\",null,{\"href\":\"#定義-middleware\",\"children\":\"定義 Middleware\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"要建立新的 Middleware，請使用 \",[\"$\",\"code\",null,{\"children\":\"make:middleware\"}],\" Artisan 指令：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"php artisan make:middleware EnsureTokenIsValid\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"此指令將在您的 \",[\"$\",\"code\",null,{\"children\":\"app/Http/Middleware\"}],\" 目錄中放置一個新的 \",[\"$\",\"code\",null,{\"children\":\"EnsureTokenIsValid\"}],\" 類別。在此 Middleware 中，我們只會在提供的 \",[\"$\",\"code\",null,{\"children\":\"token\"}],\" 輸入與指定值匹配時允許存取路由。否則，我們會將使用者重新導向回 \",[\"$\",\"code\",null,{\"children\":\"/home\"}],\" URI：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"\u003c?php\\n\\nnamespace App\\\\Http\\\\Middleware;\\n\\nuse Closure;\\nuse Illuminate\\\\Http\\\\Request;\\nuse Symfony\\\\Component\\\\HttpFoundation\\\\Response;\\n\\nclass EnsureTokenIsValid\\n{\\n    /**\\n     * Handle an incoming request.\\n     *\\n     * @param  \\\\Closure(\\\\Illuminate\\\\Http\\\\Request): (\\\\Symfony\\\\Component\\\\HttpFoundation\\\\Response)  $next\\n     */\\n    public function handle(Request $request, Closure $next): Response\\n    {\\n        if ($request-\u003einput('token') !== 'my-secret-token') {\\n            return redirect('/home');\\n        }\\n\\n        return $next($request);\\n    }\\n}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"如您所見，如果給定的 \",[\"$\",\"code\",null,{\"children\":\"token\"}],\" 與我們的秘密 Token 不匹配，Middleware 將向客戶端返回 HTTP 重新導向；否則，請求將進一步傳遞到應用程式中。要將請求更深入地傳遞到應用程式中（允許 Middleware「通過」），您應該使用 \",[\"$\",\"code\",null,{\"children\":\"$$request\"}],\" 呼叫 \",[\"$\",\"code\",null,{\"children\":\"$$next\"}],\" Callback。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"最好將 Middleware 想像為一系列「層」，HTTP 請求必須通過這些層才能到達您的應用程式。每一層都可以檢查請求，甚至完全拒絕它。\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!NOTE]\\n所有 Middleware 都透過 \",[\"$\",\"a\",null,{\"href\":\"/docs/%7B'12.x'%7D/container\",\"children\":\"Service Container\"}],\" 解析，因此您可以在 Middleware 的建構子中對所需的任何依賴項進行型別提示。\"]}],\"\\n\"]}],\"\\n\",\"$Le\",\"\\n\",\"$Lf\",\"\\n\",\"$L10\",\"\\n\",\"$L11\",\"\\n\",\"$L12\",\"\\n\",\"$L13\",\"\\n\",\"$L14\",\"\\n\",\"$L15\",\"\\n\",\"$L16\",\"\\n\",\"$L17\",\"\\n\",\"$L18\",\"\\n\",\"$L19\",\"\\n\",\"$L1a\",\"\\n\",\"$L1b\",\"\\n\",\"$L1c\",\"\\n\",\"$L1d\",\"\\n\",\"$L1e\",\"\\n\",\"$L1f\",\"\\n\",\"$L20\",\"\\n\",\"$L21\",\"\\n\",\"$L22\",\"\\n\",\"$L23\",\"\\n\",\"$L24\",\"\\n\",\"$L25\",\"\\n\",\"$L26\",\"\\n\",\"$L27\",\"\\n\",\"$L28\",\"\\n\",\"$L29\",\"\\n\",\"$L2a\",\"\\n\",\"$L2b\",\"\\n\",\"$L2c\",\"\\n\",\"$L2d\",\"\\n\",\"$L2e\",\"\\n\",\"$L2f\",\"\\n\",\"$L30\",\"\\n\",\"$L31\",\"\\n\",\"$L32\",\"\\n\",\"$L33\",\"\\n\",\"$L34\",\"\\n\",\"$L35\",\"\\n\",\"$L36\",\"\\n\",\"$L37\",\"\\n\",\"$L38\",\"\\n\",\"$L39\",\"\\n\",\"$L3a\",\"\\n\",\"$L3b\",\"\\n\",\"$L3c\",\"\\n\",\"$L3d\",\"\\n\",\"$L3e\",\"\\n\",\"$L3f\",\"\\n\",\"$L40\",\"\\n\",\"$L41\",\"\\n\",\"$L42\",\"\\n\",\"$L43\",\"\\n\",\"$L44\",\"\\n\",\"$L45\",\"\\n\",\"$L46\",\"\\n\",\"$L47\",\"\\n\",\"$L48\",\"\\n\",\"$L49\",\"\\n\",\"$L4a\",\"\\n\",\"$L4b\",\"\\n\",\"$L4c\",\"\\n\",\"$L4d\",\"\\n\",\"$L4e\",\"\\n\",\"$L4f\",\"\\n\",\"$L50\",\"\\n\",\"$L51\",\"\\n\",\"$L52\",\"\\n\",\"$L53\",\"\\n\",\"$L54\",\"\\n\",\"$L55\",\"\\n\",\"$L56\",\"\\n\",\"$L57\",\"\\n\",\"$L58\",\"\\n\",\"$L59\",\"\\n\",\"$L5a\",\"\\n\",\"$L5b\",\"\\n\",\"$L5c\",\"\\n\",\"$L5d\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"e:[\"$\",\"a\",null,{\"name\":\"middleware-and-responses\"}]\nf:[\"$\",\"h4\",null,{\"id\":\"middleware-與回應\",\"children\":[\"$\",\"a\",null,{\"href\":\"#middleware-與回應\",\"children\":\"Middleware 與回應\"}]}]\n10:[\"$\",\"p\",null,{\"children\":[\"當然，Middleware 可以在將請求更深入地傳遞到應用程式之前或之後執行任務。例如，以下 Middleware 將在應用程式處理請求\",[\"$\",\"strong\",null,{\"children\":\"之前\"}],\"執行某些任務：\"]}]\n11:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"\u003c?php\\n\\nnamespace App\\\\Http\\\\Middleware;\\n\\nuse Closure;\\nuse Illuminate\\\\Http\\\\Request;\\nuse Symfony\\\\Component\\\\HttpFoundation\\\\Response;\\n\\nclass BeforeMiddleware\\n{\\n    public function handle(Request $request, Closure $next): Response\\n    {\\n        // Perform action\\n\\n        return $next($request);\\n    }\\n}\\n\"}]}]\n12:[\"$\",\"p\",null,{\"children\":[\"但是，此 Middleware 將在應用程式處理請求\",[\"$\",\"strong\",null,{\"children\":\"之後\"}],\"執行其任務：\"]}]\n13:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"\u003c?php\\n\\nnamespace App\\\\Http\\\\Middleware;\\n\\nuse Closure;\\nuse Illuminate\\\\Http\\\\Request;\\nuse Symfony\\\\Component\\\\HttpFoundation\\\\Response;\\n\\nclass AfterMiddleware\\n{\\n    public function handle(Request $request, Closure $next): Response\\n    {\\n        $response = $next($request);\\n\\n        // Perform action\\n\\n        return $response;\\n    }\\n}\\n\"}]}]\n14:[\"$\",\"a\",null,{\"name\":\"registering-middleware\"}]\n15:[\"$\",\"h2\",null,{\"id\":\"註冊-middleware\",\"children\":[\"$\",\"a\",null,{\"href\":\"#註冊-middleware\",\"children\":\"註冊 Middleware\"}]}]\n16:[\"$\",\"a\",null,{\"name\":\"global-middleware\"}]\n17:[\"$\",\"h3\",null,{\"id\":\"全域-middleware\",\"children\":[\"$\",\"a\",null,{\"href\":\"#全域-middleware\",\"children\":\"全域 Middleware\"}]}]\n18:[\"$\",\"p\",null,{\"children\":[\"如果您希望 Middleware 在應用程式的每個 HTTP 請求期間執行，您可以在應用程式的 \",[\"$\",\"code\",null,{\"children\":\"bootstrap/app.php\"}],\" 檔案中將其附加到全域 Middleware 堆疊：\"]}]\n19:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Http\\\\Middleware\\\\EnsureTokenIsValid;\\n\\n-\u003ewithMiddleware(function (Middleware $middleware): void {\\n     $middleware-\u003eappend(EnsureTokenIsValid::class);\\n})\\n\"}]}]\n1a:[\"$\",\"p\",null,{\"children\":[\"提供給 \",[\"$\",\"code\",null,{\"children\":\"withMiddleware\"}],\" Closure 的 \",[\"$\",\"code\",null,{\"children\":\"$$middleware\"}],\" 物件是 \",[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Foundation\\\\Configuration\\\\Middleware\"}],\" 的實例，負責管理分配給應用程式路由的 Middleware。\",[\"$\",\"code\",null,{\"children\":\"append\"}],\" 方法將 Middleware 新增到全域 Middleware 清單的末尾。如果您想將 Middleware 新增到清單的開頭，應使用 \",[\"$\",\"code\",null,{\"children\":\"prepend\"}],\" 方法。\"]}]\n1b:[\"$\",\"a\",null,{\"name\":\"manually-managing-laravels-default-global-middleware\"}]\n1c:[\"$\",\"h4\",null,{\"id\":\"手動管理-laravel-的預設全域-middleware\",\"children\":[\"$\",\"a\",null,{\"href\":\"#手動管理-laravel-的預設全域-middleware\",\"children\":\"手動管理 Laravel 的預設全域 Middleware\"}]}]\n1d:[\"$\",\"p\",null,{\"children\":[\"如果您想手動管理 Laravel 的全域 Middleware 堆疊，您可以將 Laravel 的預設全域 Middleware 堆疊提供給 \",[\"$\",\"code\",null,{\"children\":\"use\"}],\" 方法。然後，您可以根據需要調整預設的 Middleware 堆疊：\"]}]\n1e:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"-\u003ewithMiddleware(function (Middleware $middleware): void {\\n    $middleware-\u003euse([\\n        \\\\Illuminate\\\\Foundation\\\\Http\\\\Middleware\\\\InvokeDeferredCallbacks::class,\\n        // \\\\Illuminate\\\\Http\\\\Middleware\\\\TrustHosts::class,\\n        \\\\Illuminate\\\\Http\\\\Middleware\\\\TrustProxies::class,\\n        \\\\Illuminate\\\\Http\\\\Middleware\\\\HandleCors::class,\\n        \\\\Illuminate\\\\Foundation\\\\Http\\\\Middleware\\\\PreventRequestsDuringMaintenance::class,\\n        \\\\Illuminate\\\\Http\\\\Middleware\\\\ValidatePostSize::class,\\n        \\\\Il"])</script><script>self.__next_f.push([1,"luminate\\\\Foundation\\\\Http\\\\Middleware\\\\TrimStrings::class,\\n        \\\\Illuminate\\\\Foundation\\\\Http\\\\Middleware\\\\ConvertEmptyStringsToNull::class,\\n    ]);\\n})\\n\"}]}]\n1f:[\"$\",\"a\",null,{\"name\":\"assigning-middleware-to-routes\"}]\n20:[\"$\",\"h3\",null,{\"id\":\"將-middleware-分配給路由\",\"children\":[\"$\",\"a\",null,{\"href\":\"#將-middleware-分配給路由\",\"children\":\"將 Middleware 分配給路由\"}]}]\n21:[\"$\",\"p\",null,{\"children\":[\"如果您想將 Middleware 分配給特定路由，您可以在定義路由時呼叫 \",[\"$\",\"code\",null,{\"children\":\"middleware\"}],\" 方法：\"]}]\n22:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Http\\\\Middleware\\\\EnsureTokenIsValid;\\n\\nRoute::get('/profile', function () {\\n    // ...\\n})-\u003emiddleware(EnsureTokenIsValid::class);\\n\"}]}]\n23:[\"$\",\"p\",null,{\"children\":[\"您可以透過將 Middleware 名稱陣列傳遞給 \",[\"$\",\"code\",null,{\"children\":\"middleware\"}],\" 方法來將多個 Middleware 分配給路由：\"]}]\n24:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"Route::get('/', function () {\\n    // ...\\n})-\u003emiddleware([First::class, Second::class]);\\n\"}]}]\n25:[\"$\",\"a\",null,{\"name\":\"excluding-middleware\"}]\n26:[\"$\",\"h4\",null,{\"id\":\"排除-middleware\",\"children\":[\"$\",\"a\",null,{\"href\":\"#排除-middleware\",\"children\":\"排除 Middleware\"}]}]\n27:[\"$\",\"p\",null,{\"children\":[\"將 Middleware 分配給一組路由時，您可能偶爾需要防止 Middleware 應用於群組內的單個路由。您可以使用 \",[\"$\",\"code\",null,{\"children\":\"withoutMiddleware\"}],\" 方法來實現：\"]}]\n28:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Http\\\\Middleware\\\\EnsureTokenIsValid;\\n\\nRoute::middleware([EnsureTokenIsValid::class])-\u003egroup(function () {\\n    Route::get('/', function () {\\n        // ...\\n    });\\n\\n    Route::get('/profile', function () {\\n        // ...\\n    })-\u003ewithoutMiddleware([EnsureTokenIsValid::class]);\\n});\\n\"}]}]\n29:[\"$\",\"p\",null,{\"children\":[\"您還可以從整個路由定義 \",[\"$\",\"a\",null,{\"href\":\"/docs/%7B'12.x'%7D/routing#route-groups\",\"children\":\"群組\"}],\" 中排除給定的 Middleware 集：\"]}]\n2a:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Http\\\\Middleware\\\\EnsureTokenIsValid;\\n\\nRoute::withoutMiddleware([EnsureTokenIsValid::class])-\u003egroup(function () {\\n    Route::get('/profile', function () {\\n        // ...\\n    });\\n});\\n\"}]}]\n2b:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"withoutMiddleware\"}],\" 方法只能移除路由 Middleware，不適用於 \",[\"$\",\"a\",null,{\"href\":\"#global-middleware\",\"children\":\"全域 Middleware\"}],\"。\"]}]\n2c:[\"$\",\"a\",null,{\"name\":\"middleware-groups\"}]\n2d:[\"$\",\"h3\",null,{\"id\":\"middleware-群組\",\"children\":[\"$\",\"a\",null,{\"href\":\"#middleware-群組\",\"children\":\"Middleware 群組\"}]}]\n2e:[\"$\",\"p\",null,{\"children\":[\"有時您可能希望將多個 Middleware 分組在單個鍵下，以便更容易將它們分配給路由。您可以在應用程式的 \",[\"$\",\"code\",null,{\"children\":\"bootstrap/app.php\"}],\" 檔案中使用 \",[\"$\",\"code\",null,{\"children\":\"appendToGroup\"}],\" 方法來實現：\"]}]\n2f:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Http\\\\Middleware\\\\First;\\nuse App\\\\Http\\\\Middleware\\\\Second;\\n\\n-\u003ewithMiddleware(function (Middleware $middleware): void {\\n    $middleware-\u003eappendToGroup('group-name', [\\n        First::class,\\n        Second::class,\\n    ]);\\n\\n    $middleware-\u003eprependToGroup('group-name', [\\n        First::class,\\n        Second::class,\\n    ]);\\n})\\n\"}]}]\n30:[\"$\",\"p\",null,{\"children\":\"Middleware 群組可以使用與單個 Middleware 相同的語法分配給路由和 Controller Action：\"}]\n31:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"Route::get('/', function () {\\n    // ...\\n})-\u003emiddleware('group-name');\\n\\nRoute::middleware(['group-name'])-\u003egroup(function () {\\n    // ...\\n});\\n\"}]}]\n32:[\"$\",\"a\",null,{\"name\":\"laravels-default-middleware-groups\"}]\n33:["])</script><script>self.__next_f.push([1,"\"$\",\"h4\",null,{\"id\":\"laravel-的預設-middleware-群組\",\"children\":[\"$\",\"a\",null,{\"href\":\"#laravel-的預設-middleware-群組\",\"children\":\"Laravel 的預設 Middleware 群組\"}]}]\n34:[\"$\",\"p\",null,{\"children\":[\"Laravel 包含預定義的 \",[\"$\",\"code\",null,{\"children\":\"web\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"api\"}],\" Middleware 群組，其中包含您可能想要應用於 Web 和 API 路由的常見 Middleware。請記住，Laravel 會自動將這些 Middleware 群組應用於相應的 \",[\"$\",\"code\",null,{\"children\":\"routes/web.php\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"routes/api.php\"}],\" 檔案：\"]}]\n35:[\"$\",\"div\",null,{\"className\":\"overflow-auto\",\"children\":[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[\"$\",\"th\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"web\"}],\" Middleware 群組\"]}]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Cookie\\\\Middleware\\\\EncryptCookies\"}]}]}],[\"$\",\"tr\",null,{\"children\":[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Cookie\\\\Middleware\\\\AddQueuedCookiesToResponse\"}]}]}],[\"$\",\"tr\",null,{\"children\":[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Session\\\\Middleware\\\\StartSession\"}]}]}],[\"$\",\"tr\",null,{\"children\":[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\View\\\\Middleware\\\\ShareErrorsFromSession\"}]}]}],[\"$\",\"tr\",null,{\"children\":[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Foundation\\\\Http\\\\Middleware\\\\ValidateCsrfToken\"}]}]}],[\"$\",\"tr\",null,{\"children\":[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Routing\\\\Middleware\\\\SubstituteBindings\"}]}]}]]}]]}]}]\n36:[\"$\",\"div\",null,{\"className\":\"overflow-auto\",\"children\":[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[\"$\",\"th\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"api\"}],\" Middleware 群組\"]}]}]}],[\"$\",\"tbody\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Routing\\\\Middleware\\\\SubstituteBindings\"}]}]}]}]]}]}]\n37:[\"$\",\"p\",null,{\"children\":[\"如果您想將 Middleware 附加或前置到這些群組，您可以在應用程式的 \",[\"$\",\"code\",null,{\"children\":\"bootstrap/app.php\"}],\" 檔案中使用 \",[\"$\",\"code\",null,{\"children\":\"web\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"api\"}],\" 方法。\",[\"$\",\"code\",null,{\"children\":\"web\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"api\"}],\" 方法是 \",[\"$\",\"code\",null,{\"children\":\"appendToGroup\"}],\" 方法的便捷替代方案：\"]}]\n38:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Http\\\\Middleware\\\\EnsureTokenIsValid;\\nuse App\\\\Http\\\\Middleware\\\\EnsureUserIsSubscribed;\\n\\n-\u003ewithMiddleware(function (Middleware $middleware): void {\\n    $middleware-\u003eweb(append: [\\n        EnsureUserIsSubscribed::class,\\n    ]);\\n\\n    $middleware-\u003eapi(prepend: [\\n        EnsureTokenIsValid::class,\\n    ]);\\n})\\n\"}]}]\n39:[\"$\",\"p\",null,{\"children\":\"您甚至可以用您自己的自訂 Middleware 替換 Laravel 的預設 Middleware 群組項目之一：\"}]\n3a:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Http\\\\Middleware\\\\StartCustomSession;\\nuse Illuminate\\\\Session\\\\Middleware\\\\StartSession;\\n\\n$middleware-\u003eweb(replace: [\\n    StartSession::class =\u003e StartCustomSession::class,\\n]);\\n\"}]}]\n3b:[\"$\",\"p\",null,{\"children\":\"或者，您可以完全移除 Middleware：\"}]\n3c:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"$$middleware-\u003eweb(remove: [\\n    StartSession::class,\\n]);\\n\"}]}]\n3d:[\"$\",\"a\",null,{\"name\":\"manually-managing-laravels-default-middleware-groups\"}]\n3e:[\"$\",\"h4\",null,{\"id\":\"手動管理-laravel-的預設-middleware-群組\",\"children\":[\"$\",\"a\",null,{\"href\":\"#手動管理-laravel-的預設-middleware-群組\",\"children\":\"手動管理 Laravel 的預設 Middleware 群組\"}]}]\n3f:[\"$\",\"p\",null,{\"children\":[\"如果您想手動管理 Lara"])</script><script>self.__next_f.push([1,"vel 預設 \",[\"$\",\"code\",null,{\"children\":\"web\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"api\"}],\" Middleware 群組中的所有 Middleware，您可以完全重新定義這些群組。以下範例將使用其預設 Middleware 定義 \",[\"$\",\"code\",null,{\"children\":\"web\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"api\"}],\" Middleware 群組，允許您根據需要自訂它們：\"]}]\n40:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"-\u003ewithMiddleware(function (Middleware $middleware): void {\\n    $middleware-\u003egroup('web', [\\n        \\\\Illuminate\\\\Cookie\\\\Middleware\\\\EncryptCookies::class,\\n        \\\\Illuminate\\\\Cookie\\\\Middleware\\\\AddQueuedCookiesToResponse::class,\\n        \\\\Illuminate\\\\Session\\\\Middleware\\\\StartSession::class,\\n        \\\\Illuminate\\\\View\\\\Middleware\\\\ShareErrorsFromSession::class,\\n        \\\\Illuminate\\\\Foundation\\\\Http\\\\Middleware\\\\ValidateCsrfToken::class,\\n        \\\\Illuminate\\\\Routing\\\\Middleware\\\\SubstituteBindings::class,\\n        // \\\\Illuminate\\\\Session\\\\Middleware\\\\AuthenticateSession::class,\\n    ]);\\n\\n    $middleware-\u003egroup('api', [\\n        // \\\\Laravel\\\\Sanctum\\\\Http\\\\Middleware\\\\EnsureFrontendRequestsAreStateful::class,\\n        // 'throttle:api',\\n        \\\\Illuminate\\\\Routing\\\\Middleware\\\\SubstituteBindings::class,\\n    ]);\\n})\\n\"}]}]\n41:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!NOTE]\\n預設情況下，\",[\"$\",\"code\",null,{\"children\":\"web\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"api\"}],\" Middleware 群組會由 \",[\"$\",\"code\",null,{\"children\":\"bootstrap/app.php\"}],\" 檔案自動應用於應用程式對應的 \",[\"$\",\"code\",null,{\"children\":\"routes/web.php\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"routes/api.php\"}],\" 檔案。\"]}],\"\\n\"]}]\n42:[\"$\",\"a\",null,{\"name\":\"middleware-aliases\"}]\n43:[\"$\",\"h3\",null,{\"id\":\"middleware-別名\",\"children\":[\"$\",\"a\",null,{\"href\":\"#middleware-別名\",\"children\":\"Middleware 別名\"}]}]\n44:[\"$\",\"p\",null,{\"children\":[\"您可以在應用程式的 \",[\"$\",\"code\",null,{\"children\":\"bootstrap/app.php\"}],\" 檔案中為 Middleware 分配別名。Middleware 別名允許您為給定的 Middleware 類別定義簡短的別名，這對於具有長類別名稱的 Middleware 特別有用：\"]}]\n45:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Http\\\\Middleware\\\\EnsureUserIsSubscribed;\\n\\n-\u003ewithMiddleware(function (Middleware $middleware): void {\\n    $middleware-\u003ealias([\\n        'subscribed' =\u003e EnsureUserIsSubscribed::class\\n    ]);\\n})\\n\"}]}]\n46:[\"$\",\"p\",null,{\"children\":[\"一旦在應用程式的 \",[\"$\",\"code\",null,{\"children\":\"bootstrap/app.php\"}],\" 檔案中定義了 Middleware 別名，您就可以在將 Middleware 分配給路由時使用該別名：\"]}]\n47:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"Route::get('/profile', function () {\\n    // ...\\n})-\u003emiddleware('subscribed');\\n\"}]}]\n48:[\"$\",\"p\",null,{\"children\":[\"為了方便起見，Laravel 的一些內建 Middleware 預設已設定別名。例如，\",[\"$\",\"code\",null,{\"children\":\"auth\"}],\" Middleware 是 \",[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Auth\\\\Middleware\\\\Authenticate\"}],\" Middleware 的別名。以下是預設 Middleware 別名的清單：\"]}]\n"])</script><script>self.__next_f.push([1,"49:[\"$\",\"div\",null,{\"className\":\"overflow-auto\",\"children\":[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"別名\"}],[\"$\",\"th\",null,{\"children\":\"Middleware\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"auth\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Auth\\\\Middleware\\\\Authenticate\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"auth.basic\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Auth\\\\Middleware\\\\AuthenticateWithBasicAuth\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"auth.session\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Session\\\\Middleware\\\\AuthenticateSession\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"cache.headers\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Http\\\\Middleware\\\\SetCacheHeaders\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"can\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Auth\\\\Middleware\\\\Authorize\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"guest\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Auth\\\\Middleware\\\\RedirectIfAuthenticated\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"password.confirm\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Auth\\\\Middleware\\\\RequirePassword\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"precognitive\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Foundation\\\\Http\\\\Middleware\\\\HandlePrecognitiveRequests\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"signed\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Routing\\\\Middleware\\\\ValidateSignature\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"subscribed\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"\\\\Spark\\\\Http\\\\Middleware\\\\VerifyBillableIsSubscribed\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"throttle\"}]}],[\"$\",\"td\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Routing\\\\Middleware\\\\ThrottleRequests\"}],\" or \",[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Routing\\\\Middleware\\\\ThrottleRequestsWithRedis\"}]]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"verified\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Auth\\\\Middleware\\\\EnsureEmailIsVerified\"}]}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"4a:[\"$\",\"a\",null,{\"name\":\"sorting-middleware\"}]\n4b:[\"$\",\"h3\",null,{\"id\":\"排序-middleware\",\"children\":[\"$\",\"a\",null,{\"href\":\"#排序-middleware\",\"children\":\"排序 Middleware\"}]}]\n4c:[\"$\",\"p\",null,{\"children\":[\"在極少數情況下，您可能需要 Middleware 以特定順序執行，但在將它們分配給路由時無法控制它們的順序。在這些情況下，您可以在應用程式的 \",[\"$\",\"code\",null,{\"children\":\"bootstrap/app.php\"}],\" 檔案中使用 \",[\"$\",\"code\",null,{\"children\":\"priority\"}],\" 方法指定 Middleware 優先順序：\"]}]\n4d:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"-\u003ewithMiddleware(function (Middleware $middleware): void {\\n    $middleware-\u003epriority([\\n        \\\\Illuminate\\\\Foundation\\\\Http\\\\Middleware\\\\HandlePrecognitiveRequests::class,\\n        \\\\Illuminate\\\\Cookie\\\\Middleware\\\\EncryptCookies::class,\\n        \\\\Illuminate\\\\Cookie\\\\Middleware\\\\AddQueuedCookiesToResponse::class,\\n        \\\\Illuminate\\\\Session\\\\Middleware\\\\StartSession::class,\\n        \\\\Illuminate\\\\View\\\\Middleware\\\\ShareErrorsFromSession::class,\\n        \\\\Illuminate\\\\Foundation\\\\Http\\\\Middleware\\\\ValidateCsrfToken::class,\\n        \\\\Laravel\\\\Sanctum\\\\Http\\\\Middleware\\\\EnsureFrontendRequestsAreStateful::class,\\n        \\\\Illuminate\\\\Routing\\\\Middleware\\\\ThrottleRequests::class,\\n        \\\\Illuminate\\\\Routing\\\\Middleware\\\\ThrottleRequestsWithRedis::class,\\n        \\\\Illuminate\\\\Routing\\\\Middleware\\\\SubstituteBindings::class,\\n        \\\\Illuminate\\\\Contracts\\\\Auth\\\\Middleware\\\\AuthenticatesRequests::class,\\n        \\\\Illuminate\\\\Auth\\\\Middleware\\\\Authorize::class,\\n    ]);\\n})\\n\"}]}]\n4e:[\"$\",\"a\",null,{\"name\":\"middleware-parameters\"}]\n4f:[\"$\",\"h2\",null,{\"id\":\"middleware-參數\",\"children\":[\"$\",\"a\",null,{\"href\":\"#middleware-參數\",\"children\":\"Middleware 參數\"}]}]\n50:[\"$\",\"p\",null,{\"children\":[\"Middleware 也可以接收額外的參數。例如，如果您的應用程式需要在執行給定動作之前驗證經過驗證的使用者是否具有給定的「角色」，您可以建立一個 \",[\"$\",\"code\",null,{\"children\":\"EnsureUserHasRole\"}],\" Middleware，該 Middleware 接收角色名稱作為額外參數。\"]}]\n51:[\"$\",\"p\",null,{\"children\":[\"額外的 Middleware 參數將在 \",[\"$\",\"code\",null,{\"children\":\"$$next\"}],\" 參數之後傳遞給 Middleware：\"]}]\n52:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"\u003c?php\\n\\nnamespace App\\\\Http\\\\Middleware;\\n\\nuse Closure;\\nuse Illuminate\\\\Http\\\\Request;\\nuse Symfony\\\\Component\\\\HttpFoundation\\\\Response;\\n\\nclass EnsureUserHasRole\\n{\\n    /**\\n     * Handle an incoming request.\\n     *\\n     * @param  \\\\Closure(\\\\Illuminate\\\\Http\\\\Request): (\\\\Symfony\\\\Component\\\\HttpFoundation\\\\Response)  $next\\n     */\\n    public function handle(Request $request, Closure $next, string $role): Response\\n    {\\n        if (! $request-\u003euser()-\u003ehasRole($role)) {\\n            // Redirect...\\n        }\\n\\n        return $next($request);\\n    }\\n}\\n\"}]}]\n53:[\"$\",\"p\",null,{\"children\":[\"在定義路由時，可以透過使用 \",[\"$\",\"code\",null,{\"children\":\":\"}],\" 分隔 Middleware 名稱和參數來指定 Middleware 參數：\"]}]\n54:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Http\\\\Middleware\\\\EnsureUserHasRole;\\n\\nRoute::put('/post/{'{id}'}', function (string $id) {\\n    // ...\\n})-\u003emiddleware(EnsureUserHasRole::class.':editor');\\n\"}]}]\n55:[\"$\",\"p\",null,{\"children\":\"多個參數可以用逗號分隔：\"}]\n56:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"Route::put('/post/{'{id}'}', function (string $id) {\\n    // ...\\n})-\u003emiddleware(EnsureUserHasRole::class.':editor,publisher');\\n\"}]}]\n57:[\"$\",\"a\",null,{\"name\":\"terminable-middleware\"}]\n58:[\"$\",\"h2\",null,{\"id\":\"可終止的-middleware\",\"children\":[\"$\",\"a\",null,{\"href\":\"#可終止的-middleware\",\"children\":\"可終止的 Middleware\"}]}]\n59:[\"$\",\"p\",null,{\"children\":[\"有時 Middleware 可能需要在 HTTP 回應已發送到瀏覽器之後執行某些工作。如果您在 Middleware 上"])</script><script>self.__next_f.push([1,"定義了 \",[\"$\",\"code\",null,{\"children\":\"terminate\"}],\" 方法，並且您的 Web 伺服器正在使用 \",[\"$\",\"a\",null,{\"href\":\"https://www.php.net/manual/en/install.fpm.php\",\"children\":\"FastCGI\"}],\"，則在回應發送到瀏覽器後，\",[\"$\",\"code\",null,{\"children\":\"terminate\"}],\" 方法將自動被呼叫：\"]}]\n5a:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"\u003c?php\\n\\nnamespace Illuminate\\\\Session\\\\Middleware;\\n\\nuse Closure;\\nuse Illuminate\\\\Http\\\\Request;\\nuse Symfony\\\\Component\\\\HttpFoundation\\\\Response;\\n\\nclass TerminatingMiddleware\\n{\\n    /**\\n     * Handle an incoming request.\\n     *\\n     * @param  \\\\Closure(\\\\Illuminate\\\\Http\\\\Request): (\\\\Symfony\\\\Component\\\\HttpFoundation\\\\Response)  $next\\n     */\\n    public function handle(Request $request, Closure $next): Response\\n    {\\n        return $next($request);\\n    }\\n\\n    /**\\n     * Handle tasks after the response has been sent to the browser.\\n     */\\n    public function terminate(Request $request, Response $response): void\\n    {\\n        // ...\\n    }\\n}\\n\"}]}]\n5b:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"terminate\"}],\" 方法應同時接收請求和回應。一旦您定義了可終止的 Middleware，您應該將其新增到應用程式 \",[\"$\",\"code\",null,{\"children\":\"bootstrap/app.php\"}],\" 檔案中的路由或全域 Middleware 清單中。\"]}]\n5c:[\"$\",\"p\",null,{\"children\":[\"在 Middleware 上呼叫 \",[\"$\",\"code\",null,{\"children\":\"terminate\"}],\" 方法時，Laravel 將從 \",[\"$\",\"a\",null,{\"href\":\"/docs/%7B'12.x'%7D/container\",\"children\":\"Service Container\"}],\" 解析 Middleware 的新實例。如果您希望在呼叫 \",[\"$\",\"code\",null,{\"children\":\"handle\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"terminate\"}],\" 方法時使用相同的 Middleware 實例，請使用 Container 的 \",[\"$\",\"code\",null,{\"children\":\"singleton\"}],\" 方法向 Container 註冊 Middleware。通常這應該在您的 \",[\"$\",\"code\",null,{\"children\":\"AppServiceProvider\"}],\" 的 \",[\"$\",\"code\",null,{\"children\":\"register\"}],\" 方法中完成：\"]}]\n5d:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Http\\\\Middleware\\\\TerminatingMiddleware;\\n\\n/**\\n * Register any application services.\\n */\\npublic function register(): void\\n{\\n    $this-\u003eapp-\u003esingleton(TerminatingMiddleware::class);\\n}\\n\"}]}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"5e:I[27201,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"IconMark\"]\nc:[[\"$\",\"title\",\"0\",{\"children\":\"Create Next App\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Generated by create next app\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/favicon.ico?favicon.0b3bf435.ico\",\"sizes\":\"256x256\",\"type\":\"image/x-icon\"}],[\"$\",\"$L5e\",\"3\",{}]]\n8:null\n"])</script></body></html>