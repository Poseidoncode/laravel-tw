<!DOCTYPE html><!--2DrqUONp3UGGEsii_P_1z--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/797e433ab948586e-s.p.dbea232f.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/caa3a2e1cccd8315-s.p.853070df.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/chunks/f56971fdd088d69d.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/cbd55ab9639e1e66.js"/><script src="/_next/static/chunks/87a939617be2fa8c.js" async=""></script><script src="/_next/static/chunks/8368f298651cbd89.js" async=""></script><script src="/_next/static/chunks/6740f161f60c6ab5.js" async=""></script><script src="/_next/static/chunks/turbopack-929fc2ce3ca903db.js" async=""></script><script src="/_next/static/chunks/ff1a16fafef87110.js" async=""></script><script src="/_next/static/chunks/247eb132b7f7b574.js" async=""></script><script src="/_next/static/chunks/796e69ae18b2784c.js" async=""></script><script src="/_next/static/chunks/5f549f56d9b805d8.js" async=""></script><meta name="next-size-adjust" content=""/><title>Create Next App</title><meta name="description" content="Generated by create next app"/><link rel="icon" href="/favicon.ico?favicon.0b3bf435.ico" sizes="256x256" type="image/x-icon"/><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="geist_a71539c9-module__T19VSG__variable geist_mono_8d43a2aa-module__8Li5zG__variable antialiased"><div hidden=""><!--$--><!--/$--></div><div class="flex min-h-screen bg-background"><div class="w-64 border-r bg-background h-screen sticky top-0 hidden md:block"><div class="p-6 font-bold text-xl border-b flex items-center gap-2"><span class="text-red-600">Laravel</span> Docs CN</div><div dir="ltr" data-slot="scroll-area" class="relative h-[calc(100vh-65px)]" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><div class="p-4 space-y-6"><div><h4 class="mb-2 px-4 text-sm font-semibold text-muted-foreground">前言</h4><div class="space-y-1"><a class="block" href="/docs/releases"><button data-slot="button" class="inline-flex items-center whitespace-nowrap text-sm transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal">發行說明</button></a></div></div><div><h4 class="mb-2 px-4 text-sm font-semibold text-muted-foreground">入門</h4><div class="space-y-1"><a class="block" href="/docs/installation"><button data-slot="button" class="inline-flex items-center whitespace-nowrap text-sm transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal">安裝</button></a><a class="block" href="/docs/configuration"><button data-slot="button" class="inline-flex items-center whitespace-nowrap text-sm transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal">配置</button></a></div></div></div></div></div></div></div><main class="flex-1 relative"><div class="container mx-auto py-10"><div class="mx-auto max-w-3xl"><div class="mb-8"><h1 class="scroll-m-20 text-4xl font-extrabold tracking-tight lg:text-5xl">Mocking</h1><p class="text-xl text-muted-foreground mt-2">在 Laravel 中模擬物件和服務進行測試</p></div><article class="prose prose-slate dark:prose-invert max-w-none"><h1 id="mocking"><a href="#mocking">Mocking</a></h1>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#mocking-objects">Mocking Objects</a></li>
<li><a href="#mocking-facades">Mocking Facades</a>
<ul>
<li><a href="#facade-spies">Facade Spies</a></li>
</ul>
</li>
<li><a href="#interacting-with-time">Interacting With Time</a></li>
</ul>
<a name="introduction"></a>
<h2 id="簡介"><a href="#簡介">簡介</a></h2>
<p>When testing Laravel applications, you may wish to &quot;mock&quot; certain aspects of your application so they are not actually executed during a given test. For example, when testing a controller that dispatches an event, you may wish to mock the event listeners so they are not actually executed during the test. This allows you to only test the controller&#x27;s HTTP response without worrying about the execution of the event listeners since the event listeners can be tested in their own test case.</p>
<p>Laravel provides helpful methods for mocking events, jobs, and other facades out of the box. These helpers primarily provide a convenience layer over Mockery so you do not have to manually make complicated Mockery method calls.</p>
<a name="mocking-objects"></a>
<h2 id="mocking-objects"><a href="#mocking-objects">Mocking Objects</a></h2>
<p>When mocking an object that is going to be injected into your application via Laravel&#x27;s <a href="/docs/12.x/container">service container</a>, you will need to bind your mocked instance into the container as an <code>instance</code> binding. This will instruct the container to use your mocked instance of the object instead of constructing the object itself:</p>
<pre><code class="language-php">use App\Service;
use Mockery;
use Mockery\MockInterface;

test(&#x27;something can be mocked&#x27;, function () {
    $this-&gt;instance(
        Service::class,
        Mockery::mock(Service::class, function (MockInterface $mock) {
            $mock-&gt;expects(&#x27;process&#x27;);
        })
    );
});
</code></pre>
<pre><code class="language-php">use App\Service;
use Mockery;
use Mockery\MockInterface;

public function test_something_can_be_mocked(): void
{
    $this-&gt;instance(
        Service::class,
        Mockery::mock(Service::class, function (MockInterface $mock) {
            $mock-&gt;expects(&#x27;process&#x27;);
        })
    );
}
</code></pre>
<p>In order to make this more convenient, you may use the <code>mock</code> method that is provided by Laravel&#x27;s base test case class. For example, the following example is equivalent to the example above:</p>
<pre><code class="language-php">use App\Service;
use Mockery\MockInterface;

$mock = $this-&gt;mock(Service::class, function (MockInterface $mock) {
    $mock-&gt;expects(&#x27;process&#x27;);
});
</code></pre>
<p>You may use the <code>partialMock</code> method when you only need to mock a few methods of an object. The methods that are not mocked will be executed normally when called:</p>
<pre><code class="language-php">use App\Service;
use Mockery\MockInterface;

$mock = $this-&gt;partialMock(Service::class, function (MockInterface $mock) {
    $mock-&gt;expects(&#x27;process&#x27;);
});
</code></pre>
<p>Similarly, if you want to <a href="http://docs.mockery.io/en/latest/reference/spies.html">spy</a> on an object, Laravel&#x27;s base test case class offers a <code>spy</code> method as a convenient wrapper around the <code>Mockery::spy</code> method. Spies are similar to mocks; however, spies record any interaction between the spy and the code being tested, allowing you to make assertions after the code is executed:</p>
<pre><code class="language-php">use App\Service;

$spy = $this-&gt;spy(Service::class);

// ...

$spy-&gt;shouldHaveReceived(&#x27;process&#x27;);
</code></pre>
<a name="mocking-facades"></a>
<h2 id="mocking-facades"><a href="#mocking-facades">Mocking Facades</a></h2>
<p>Unlike traditional static method calls, <a href="/docs/12.x/facades">facades</a> (including <a href="/docs/12.x/facades#real-time-facades">real-time facades</a>) may be mocked. This provides a great advantage over traditional static methods and grants you the same testability that you would have if you were using traditional dependency injection. When testing, you may often want to mock a call to a Laravel facade that occurs in one of your controllers. For example, consider the following controller action:</p>
<pre><code class="language-php">&lt;?php

namespace App\Http\Controllers;

use Illuminate\Support\Facades\Cache;

class UserController extends Controller
{
    /**
     * Retrieve a list of all users of the application.
     */
    public function index(): array
    {
        $value = Cache::get(&#x27;key&#x27;);

        return [
            // ...
        ];
    }
}
</code></pre>
<p>We can mock the call to the <code>Cache</code> facade by using the <code>expects</code> method, which will return an instance of a <a href="https://github.com/padraic/mockery">Mockery</a> mock. Since facades are actually resolved and managed by the Laravel <a href="/docs/12.x/container">service container</a>, they have much more testability than a typical static class. For example, let&#x27;s mock our call to the <code>Cache</code> facade&#x27;s <code>get</code> method:</p>
<pre><code class="language-php">&lt;?php

use Illuminate\Support\Facades\Cache;

test(&#x27;get index&#x27;, function () {
    Cache::expects(&#x27;get&#x27;)
        -&gt;with(&#x27;key&#x27;)
        -&gt;andReturn(&#x27;value&#x27;);

    $response = $this-&gt;get(&#x27;/users&#x27;);

    // ...
});
</code></pre>
<pre><code class="language-php">&lt;?php

namespace Tests\Feature;

use Illuminate\Support\Facades\Cache;
use Tests\TestCase;

class UserControllerTest extends TestCase
{
    public function test_get_index(): void
    {
        Cache::expects(&#x27;get&#x27;)
            -&gt;with(&#x27;key&#x27;)
            -&gt;andReturn(&#x27;value&#x27;);

        $response = $this-&gt;get(&#x27;/users&#x27;);

        // ...
    }
}
</code></pre>
<blockquote>
<p>[!WARNING]
You should not mock the <code>Request</code> facade. Instead, pass the input you desire into the <a href="/docs/12.x/http-tests">HTTP testing methods</a> such as <code>get</code> and <code>post</code> when running your test. Likewise, instead of mocking the <code>Config</code> facade, call the <code>Config::set</code> method in your tests.</p>
</blockquote>
<a name="facade-spies"></a>
<h3 id="facade-spies"><a href="#facade-spies">Facade Spies</a></h3>
<p>If you would like to <a href="http://docs.mockery.io/en/latest/reference/spies.html">spy</a> on a facade, you may call the <code>spy</code> method on the corresponding facade. Spies are similar to mocks; however, spies record any interaction between the spy and the code being tested, allowing you to make assertions after the code is executed:</p>
<pre><code class="language-php">&lt;?php

use Illuminate\Support\Facades\Cache;

test(&#x27;values are stored in cache&#x27;, function () {
    Cache::spy();

    $response = $this-&gt;get(&#x27;/&#x27;);

    $response-&gt;assertStatus(200);

    Cache::shouldHaveReceived(&#x27;put&#x27;)-&gt;with(&#x27;name&#x27;, &#x27;Taylor&#x27;, 10);
});
</code></pre>
<pre><code class="language-php">use Illuminate\Support\Facades\Cache;

public function test_values_are_stored_in_cache(): void
{
    Cache::spy();

    $response = $this-&gt;get(&#x27;/&#x27;);

    $response-&gt;assertStatus(200);

    Cache::shouldHaveReceived(&#x27;put&#x27;)-&gt;with(&#x27;name&#x27;, &#x27;Taylor&#x27;, 10);
}
</code></pre>
<a name="interacting-with-time"></a>
<h2 id="interacting-with-time"><a href="#interacting-with-time">Interacting With Time</a></h2>
<p>When testing, you may occasionally need to modify the time returned by helpers such as <code>now</code> or <code>Illuminate\Support\Carbon::now()</code>. Thankfully, Laravel&#x27;s base feature test class includes helpers that allow you to manipulate the current time:</p>
<pre><code class="language-php">test(&#x27;time can be manipulated&#x27;, function () {
    // Travel into the future...
    $this-&gt;travel(5)-&gt;milliseconds();
    $this-&gt;travel(5)-&gt;seconds();
    $this-&gt;travel(5)-&gt;minutes();
    $this-&gt;travel(5)-&gt;hours();
    $this-&gt;travel(5)-&gt;days();
    $this-&gt;travel(5)-&gt;weeks();
    $this-&gt;travel(5)-&gt;years();

    // Travel into the past...
    $this-&gt;travel(-5)-&gt;hours();

    // Travel to an explicit time...
    $this-&gt;travelTo(now()-&gt;subHours(6));

    // Return back to the present time...
    $this-&gt;travelBack();
});
</code></pre>
<pre><code class="language-php">public function test_time_can_be_manipulated(): void
{
    // Travel into the future...
    $this-&gt;travel(5)-&gt;milliseconds();
    $this-&gt;travel(5)-&gt;seconds();
    $this-&gt;travel(5)-&gt;minutes();
    $this-&gt;travel(5)-&gt;hours();
    $this-&gt;travel(5)-&gt;days();
    $this-&gt;travel(5)-&gt;weeks();
    $this-&gt;travel(5)-&gt;years();

    // Travel into the past...
    $this-&gt;travel(-5)-&gt;hours();

    // Travel to an explicit time...
    $this-&gt;travelTo(now()-&gt;subHours(6));

    // Return back to the present time...
    $this-&gt;travelBack();
}
</code></pre>
<p>You may also provide a closure to the various time travel methods. The closure will be invoked with time frozen at the specified time. Once the closure has executed, time will resume as normal:</p>
<pre><code class="language-php">$this-&gt;travel(5)-&gt;days(function () {
    // Test something five days into the future...
});

$this-&gt;travelTo(now()-&gt;subDays(10), function () {
    // Test something during a given moment...
});
</code></pre>
<p>The <code>freezeTime</code> method may be used to freeze the current time. Similarly, the <code>freezeSecond</code> method will freeze the current time but at the start of the current second:</p>
<pre><code class="language-php">use Illuminate\Support\Carbon;

// Freeze time and resume normal time after executing closure...
$this-&gt;freezeTime(function (Carbon $time) {
    // ...
});

// Freeze time at the current second and resume normal time after executing closure...
$this-&gt;freezeSecond(function (Carbon $time) {
    // ...
})
</code></pre>
<p>As you would expect, all of the methods discussed above are primarily useful for testing time sensitive application behavior, such as locking inactive posts on a discussion forum:</p>
<pre><code class="language-php">use App\Models\Thread;

test(&#x27;forum threads lock after one week of inactivity&#x27;, function () {
    $thread = Thread::factory()-&gt;create();

    $this-&gt;travel(1)-&gt;week();

    expect($thread-&gt;isLockedByInactivity())-&gt;toBeTrue();
});
</code></pre>
<pre><code class="language-php">use App\Models\Thread;

public function test_forum_threads_lock_after_one_week_of_inactivity()
{
    $thread = Thread::factory()-&gt;create();

    $this-&gt;travel(1)-&gt;week();

    $this-&gt;assertTrue($thread-&gt;isLockedByInactivity());
}
</code></pre></article></div></div><!--$--><!--/$--></main></div><script src="/_next/static/chunks/cbd55ab9639e1e66.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[39756,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"default\"]\n3:I[37457,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"default\"]\n4:I[71435,[\"/_next/static/chunks/796e69ae18b2784c.js\",\"/_next/static/chunks/5f549f56d9b805d8.js\"],\"ScrollArea\"]\n5:I[22016,[\"/_next/static/chunks/796e69ae18b2784c.js\",\"/_next/static/chunks/5f549f56d9b805d8.js\"],\"\"]\nb:I[68027,[],\"default\"]\n:HL[\"/_next/static/chunks/f56971fdd088d69d.css\",\"style\"]\n:HL[\"/_next/static/media/797e433ab948586e-s.p.dbea232f.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/caa3a2e1cccd8315-s.p.853070df.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"2DrqUONp3UGGEsii_P-1z\",\"c\":[\"\",\"docs\",\"mocking\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[[\"slug\",\"mocking\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/f56971fdd088d69d.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"geist_a71539c9-module__T19VSG__variable geist_mono_8d43a2aa-module__8Li5zG__variable antialiased\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/796e69ae18b2784c.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/_next/static/chunks/5f549f56d9b805d8.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"div\",null,{\"className\":\"flex min-h-screen bg-background\",\"children\":[[\"$\",\"div\",null,{\"className\":\"w-64 border-r bg-background h-screen sticky top-0 hidden md:block\",\"children\":[[\"$\",\"div\",null,{\"className\":\"p-6 font-bold text-xl border-b flex items-center gap-2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"text-red-600\",\"children\":\"Laravel\"}],\" Docs CN\"]}],[\"$\",\"$L4\",null,{\"className\":\"h-[calc(100vh-65px)]\",\"children\":[\"$\",\"div\",null,{\"className\":\"p-4 space-y-6\",\"children\":[[\"$\",\"div\",\"前言\",{\"children\":[[\"$\",\"h4\",null,{\"className\":\"mb-2 px-4 text-sm font-semibold text-muted-foreground\",\"children\":\"前言\"}],[\"$\",\"div\",null,{\"className\":\"space-y-1\",\"children\":[[\"$\",\"$L5\",\"/docs/releases\",{\"href\":\"/docs/releases\",\"className\":\"block\",\"children\":[\"$\",\"button\",null,{\"data-slot\":\"button\",\"className\":\"inline-flex items-center whitespace-nowrap text-sm transition-all disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg:not([class*='size-'])]:size-4 shrink-0 [\u0026_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[\u003esvg]:px-2.5 w-full justify-start font-normal\",\"children\":\"發行說明\"}]}]]}]]}],[\"$\",\"div\",\"入門\",{\"children\":[[\"$\",\"h4\",null,{\"className\":\"mb-2 px-4 text-sm font-semibold text-muted-foreground\",\"children\":\"入門\"}],[\"$\",\"div\",null,{\"className\":\"space-y-1\",\"children\":[[\"$\",\"$L5\",\"/docs/installation\",{\"href\":\"/docs/installation\",\"className\":\"block\",\"children\":[\"$\",\"button\",null,{\"data-slot\":\"button\",\"className\":\"inline-flex items-center whitespace-nowrap text-sm transition-all disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg:not([class*='size-'])]:size-4 shrink-0 [\u0026_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[\u003esvg]:px-2.5 w-full justify-start font-normal\",\"children\":\"安裝\"}]}],\"$L6\"]}]]}]]}]}]]}],\"$L7\"]}]]}],{\"children\":[\"$L8\",{\"children\":[\"$L9\",{},null,false,false]},null,false,false]},null,false,false]},null,false,false],\"$La\",false]],\"m\":\"$undefined\",\"G\":[\"$b\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"d:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"OutletBoundary\"]\ne:\"$Sreact.suspense\"\n10:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"ViewportBoundary\"]\n12:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"MetadataBoundary\"]\n6:[\"$\",\"$L5\",\"/docs/configuration\",{\"href\":\"/docs/configuration\",\"className\":\"block\",\"children\":[\"$\",\"button\",null,{\"data-slot\":\"button\",\"className\":\"inline-flex items-center whitespace-nowrap text-sm transition-all disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg:not([class*='size-'])]:size-4 shrink-0 [\u0026_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[\u003esvg]:px-2.5 w-full justify-start font-normal\",\"children\":\"配置\"}]}]\n7:[\"$\",\"main\",null,{\"className\":\"flex-1 relative\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]\n8:[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]\n9:[\"$\",\"$1\",\"c\",{\"children\":[\"$Lc\",null,[\"$\",\"$Ld\",null,{\"children\":[\"$\",\"$e\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@f\"}]}]]}]\na:[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L10\",null,{\"children\":\"$@11\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$L12\",null,{\"children\":[\"$\",\"$e\",null,{\"name\":\"Next.Metadata\",\"children\":\"$@13\"}]}]}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}]\n"])</script><script>self.__next_f.push([1,"c:[\"$\",\"div\",null,{\"className\":\"container mx-auto py-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-3xl\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"scroll-m-20 text-4xl font-extrabold tracking-tight lg:text-5xl\",\"children\":\"Mocking\"}],[\"$\",\"p\",null,{\"className\":\"text-xl text-muted-foreground mt-2\",\"children\":\"在 Laravel 中模擬物件和服務進行測試\"}]]}],[\"$\",\"article\",null,{\"className\":\"prose prose-slate dark:prose-invert max-w-none\",\"children\":[[\"$\",\"h1\",null,{\"id\":\"mocking\",\"children\":[\"$\",\"a\",null,{\"href\":\"#mocking\",\"children\":\"Mocking\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#introduction\",\"children\":\"Introduction\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#mocking-objects\",\"children\":\"Mocking Objects\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"#mocking-facades\",\"children\":\"Mocking Facades\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#facade-spies\",\"children\":\"Facade Spies\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#interacting-with-time\",\"children\":\"Interacting With Time\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"a\",null,{\"name\":\"introduction\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"簡介\",\"children\":[\"$\",\"a\",null,{\"href\":\"#簡介\",\"children\":\"簡介\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"When testing Laravel applications, you may wish to \\\"mock\\\" certain aspects of your application so they are not actually executed during a given test. For example, when testing a controller that dispatches an event, you may wish to mock the event listeners so they are not actually executed during the test. This allows you to only test the controller's HTTP response without worrying about the execution of the event listeners since the event listeners can be tested in their own test case.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Laravel provides helpful methods for mocking events, jobs, and other facades out of the box. These helpers primarily provide a convenience layer over Mockery so you do not have to manually make complicated Mockery method calls.\"}],\"\\n\",[\"$\",\"a\",null,{\"name\":\"mocking-objects\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"mocking-objects\",\"children\":[\"$\",\"a\",null,{\"href\":\"#mocking-objects\",\"children\":\"Mocking Objects\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"When mocking an object that is going to be injected into your application via Laravel's \",[\"$\",\"a\",null,{\"href\":\"/docs/12.x/container\",\"children\":\"service container\"}],\", you will need to bind your mocked instance into the container as an \",[\"$\",\"code\",null,{\"children\":\"instance\"}],\" binding. This will instruct the container to use your mocked instance of the object instead of constructing the object itself:\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Service;\\nuse Mockery;\\nuse Mockery\\\\MockInterface;\\n\\ntest('something can be mocked', function () {\\n    $this-\u003einstance(\\n        Service::class,\\n        Mockery::mock(Service::class, function (MockInterface $mock) {\\n            $mock-\u003eexpects('process');\\n        })\\n    );\\n});\\n\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Service;\\nuse Mockery;\\nuse Mockery\\\\MockInterface;\\n\\npublic function test_something_can_be_mocked(): void\\n{\\n    $this-\u003einstance(\\n        Service::class,\\n        Mockery::mock(Service::class, function (MockInterface $mock) {\\n            $mock-\u003eexpects('process');\\n        })\\n    );\\n}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In order to make this more convenient, you may use the \",[\"$\",\"code\",null,{\"children\":\"mock\"}],\" method that is provided by Laravel's base test case class. For example, the following example is equivalent to the example above:\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Service;\\nuse Mockery\\\\MockInterface;\\n\\n$mock = $this-\u003emock(Service::class, function (MockInterface $mock) {\\n    $mock-\u003eexpects('process');\\n});\\n\"}]}],\"\\n\",\"$L14\",\"\\n\",\"$L15\",\"\\n\",\"$L16\",\"\\n\",\"$L17\",\"\\n\",\"$L18\",\"\\n\",\"$L19\",\"\\n\",\"$L1a\",\"\\n\",\"$L1b\",\"\\n\",\"$L1c\",\"\\n\",\"$L1d\",\"\\n\",\"$L1e\",\"\\n\",\"$L1f\",\"\\n\",\"$L20\",\"\\n\",\"$L21\",\"\\n\",\"$L22\",\"\\n\",\"$L23\",\"\\n\",\"$L24\",\"\\n\",\"$L25\",\"\\n\",\"$L26\",\"\\n\",\"$L27\",\"\\n\",\"$L28\",\"\\n\",\"$L29\",\"\\n\",\"$L2a\",\"\\n\",\"$L2b\",\"\\n\",\"$L2c\",\"\\n\",\"$L2d\",\"\\n\",\"$L2e\",\"\\n\",\"$L2f\",\"\\n\",\"$L30\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"14:[\"$\",\"p\",null,{\"children\":[\"You may use the \",[\"$\",\"code\",null,{\"children\":\"partialMock\"}],\" method when you only need to mock a few methods of an object. The methods that are not mocked will be executed normally when called:\"]}]\n15:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Service;\\nuse Mockery\\\\MockInterface;\\n\\n$mock = $this-\u003epartialMock(Service::class, function (MockInterface $mock) {\\n    $mock-\u003eexpects('process');\\n});\\n\"}]}]\n16:[\"$\",\"p\",null,{\"children\":[\"Similarly, if you want to \",[\"$\",\"a\",null,{\"href\":\"http://docs.mockery.io/en/latest/reference/spies.html\",\"children\":\"spy\"}],\" on an object, Laravel's base test case class offers a \",[\"$\",\"code\",null,{\"children\":\"spy\"}],\" method as a convenient wrapper around the \",[\"$\",\"code\",null,{\"children\":\"Mockery::spy\"}],\" method. Spies are similar to mocks; however, spies record any interaction between the spy and the code being tested, allowing you to make assertions after the code is executed:\"]}]\n17:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Service;\\n\\n$spy = $this-\u003espy(Service::class);\\n\\n// ...\\n\\n$spy-\u003eshouldHaveReceived('process');\\n\"}]}]\n18:[\"$\",\"a\",null,{\"name\":\"mocking-facades\"}]\n19:[\"$\",\"h2\",null,{\"id\":\"mocking-facades\",\"children\":[\"$\",\"a\",null,{\"href\":\"#mocking-facades\",\"children\":\"Mocking Facades\"}]}]\n1a:[\"$\",\"p\",null,{\"children\":[\"Unlike traditional static method calls, \",[\"$\",\"a\",null,{\"href\":\"/docs/12.x/facades\",\"children\":\"facades\"}],\" (including \",[\"$\",\"a\",null,{\"href\":\"/docs/12.x/facades#real-time-facades\",\"children\":\"real-time facades\"}],\") may be mocked. This provides a great advantage over traditional static methods and grants you the same testability that you would have if you were using traditional dependency injection. When testing, you may often want to mock a call to a Laravel facade that occurs in one of your controllers. For example, consider the following controller action:\"]}]\n1b:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"\u003c?php\\n\\nnamespace App\\\\Http\\\\Controllers;\\n\\nuse Illuminate\\\\Support\\\\Facades\\\\Cache;\\n\\nclass UserController extends Controller\\n{\\n    /**\\n     * Retrieve a list of all users of the application.\\n     */\\n    public function index(): array\\n    {\\n        $value = Cache::get('key');\\n\\n        return [\\n            // ...\\n        ];\\n    }\\n}\\n\"}]}]\n1c:[\"$\",\"p\",null,{\"children\":[\"We can mock the call to the \",[\"$\",\"code\",null,{\"children\":\"Cache\"}],\" facade by using the \",[\"$\",\"code\",null,{\"children\":\"expects\"}],\" method, which will return an instance of a \",[\"$\",\"a\",null,{\"href\":\"https://github.com/padraic/mockery\",\"children\":\"Mockery\"}],\" mock. Since facades are actually resolved and managed by the Laravel \",[\"$\",\"a\",null,{\"href\":\"/docs/12.x/container\",\"children\":\"service container\"}],\", they have much more testability than a typical static class. For example, let's mock our call to the \",[\"$\",\"code\",null,{\"children\":\"Cache\"}],\" facade's \",[\"$\",\"code\",null,{\"children\":\"get\"}],\" method:\"]}]\n1d:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"\u003c?php\\n\\nuse Illuminate\\\\Support\\\\Facades\\\\Cache;\\n\\ntest('get index', function () {\\n    Cache::expects('get')\\n        -\u003ewith('key')\\n        -\u003eandReturn('value');\\n\\n    $response = $this-\u003eget('/users');\\n\\n    // ...\\n});\\n\"}]}]\n1e:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"\u003c?php\\n\\nnamespace Tests\\\\Feature;\\n\\nuse Illuminate\\\\Support\\\\Facades\\\\Cache;\\nuse Tests\\\\TestCase;\\n\\nclass UserControllerTest extends TestCase\\n{\\n    public function test_get_index(): void\\n    {\\n        Cache::expects('get')\\n            -\u003ewith('key')\\n            -\u003eandReturn('value');\\n\\n        $response = $this-\u003eget('/users');\\n\\n        // ...\\n    }\\n}\\n\"}]}]\n1f:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!WARNING]\\nYou should not mock the \",[\"$\",\"code\",null,{\"children\":\"Request\"}],\" facade. Instead, pass the input you desire into the \",[\"$\",\"a\",null"])</script><script>self.__next_f.push([1,",{\"href\":\"/docs/12.x/http-tests\",\"children\":\"HTTP testing methods\"}],\" such as \",[\"$\",\"code\",null,{\"children\":\"get\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"post\"}],\" when running your test. Likewise, instead of mocking the \",[\"$\",\"code\",null,{\"children\":\"Config\"}],\" facade, call the \",[\"$\",\"code\",null,{\"children\":\"Config::set\"}],\" method in your tests.\"]}],\"\\n\"]}]\n20:[\"$\",\"a\",null,{\"name\":\"facade-spies\"}]\n21:[\"$\",\"h3\",null,{\"id\":\"facade-spies\",\"children\":[\"$\",\"a\",null,{\"href\":\"#facade-spies\",\"children\":\"Facade Spies\"}]}]\n22:[\"$\",\"p\",null,{\"children\":[\"If you would like to \",[\"$\",\"a\",null,{\"href\":\"http://docs.mockery.io/en/latest/reference/spies.html\",\"children\":\"spy\"}],\" on a facade, you may call the \",[\"$\",\"code\",null,{\"children\":\"spy\"}],\" method on the corresponding facade. Spies are similar to mocks; however, spies record any interaction between the spy and the code being tested, allowing you to make assertions after the code is executed:\"]}]\n23:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"\u003c?php\\n\\nuse Illuminate\\\\Support\\\\Facades\\\\Cache;\\n\\ntest('values are stored in cache', function () {\\n    Cache::spy();\\n\\n    $response = $this-\u003eget('/');\\n\\n    $response-\u003eassertStatus(200);\\n\\n    Cache::shouldHaveReceived('put')-\u003ewith('name', 'Taylor', 10);\\n});\\n\"}]}]\n24:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Illuminate\\\\Support\\\\Facades\\\\Cache;\\n\\npublic function test_values_are_stored_in_cache(): void\\n{\\n    Cache::spy();\\n\\n    $response = $this-\u003eget('/');\\n\\n    $response-\u003eassertStatus(200);\\n\\n    Cache::shouldHaveReceived('put')-\u003ewith('name', 'Taylor', 10);\\n}\\n\"}]}]\n25:[\"$\",\"a\",null,{\"name\":\"interacting-with-time\"}]\n26:[\"$\",\"h2\",null,{\"id\":\"interacting-with-time\",\"children\":[\"$\",\"a\",null,{\"href\":\"#interacting-with-time\",\"children\":\"Interacting With Time\"}]}]\n27:[\"$\",\"p\",null,{\"children\":[\"When testing, you may occasionally need to modify the time returned by helpers such as \",[\"$\",\"code\",null,{\"children\":\"now\"}],\" or \",[\"$\",\"code\",null,{\"children\":\"Illuminate\\\\Support\\\\Carbon::now()\"}],\". Thankfully, Laravel's base feature test class includes helpers that allow you to manipulate the current time:\"]}]\n28:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"test('time can be manipulated', function () {\\n    // Travel into the future...\\n    $this-\u003etravel(5)-\u003emilliseconds();\\n    $this-\u003etravel(5)-\u003eseconds();\\n    $this-\u003etravel(5)-\u003eminutes();\\n    $this-\u003etravel(5)-\u003ehours();\\n    $this-\u003etravel(5)-\u003edays();\\n    $this-\u003etravel(5)-\u003eweeks();\\n    $this-\u003etravel(5)-\u003eyears();\\n\\n    // Travel into the past...\\n    $this-\u003etravel(-5)-\u003ehours();\\n\\n    // Travel to an explicit time...\\n    $this-\u003etravelTo(now()-\u003esubHours(6));\\n\\n    // Return back to the present time...\\n    $this-\u003etravelBack();\\n});\\n\"}]}]\n29:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"public function test_time_can_be_manipulated(): void\\n{\\n    // Travel into the future...\\n    $this-\u003etravel(5)-\u003emilliseconds();\\n    $this-\u003etravel(5)-\u003eseconds();\\n    $this-\u003etravel(5)-\u003eminutes();\\n    $this-\u003etravel(5)-\u003ehours();\\n    $this-\u003etravel(5)-\u003edays();\\n    $this-\u003etravel(5)-\u003eweeks();\\n    $this-\u003etravel(5)-\u003eyears();\\n\\n    // Travel into the past...\\n    $this-\u003etravel(-5)-\u003ehours();\\n\\n    // Travel to an explicit time...\\n    $this-\u003etravelTo(now()-\u003esubHours(6));\\n\\n    // Return back to the present time...\\n    $this-\u003etravelBack();\\n}\\n\"}]}]\n2a:[\"$\",\"p\",null,{\"children\":\"You may also provide a closure to the various time travel methods. The closure will be invoked with time frozen at the specified time. Once the closure has executed, time will resume as normal:\"}]\n2b:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"$$this-\u003etravel(5)-\u003edays(function () {\\n    // Test something five days into the future...\\n});\\n\\n$this-\u003etravelTo(now()-\u003esubDays(10), function () {\\n    // Test something during a given moment...\\n});\\n\"}]}]\n2c:[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"code\",null,{\"children\":\""])</script><script>self.__next_f.push([1,"freezeTime\"}],\" method may be used to freeze the current time. Similarly, the \",[\"$\",\"code\",null,{\"children\":\"freezeSecond\"}],\" method will freeze the current time but at the start of the current second:\"]}]\n2d:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Illuminate\\\\Support\\\\Carbon;\\n\\n// Freeze time and resume normal time after executing closure...\\n$this-\u003efreezeTime(function (Carbon $time) {\\n    // ...\\n});\\n\\n// Freeze time at the current second and resume normal time after executing closure...\\n$this-\u003efreezeSecond(function (Carbon $time) {\\n    // ...\\n})\\n\"}]}]\n2e:[\"$\",\"p\",null,{\"children\":\"As you would expect, all of the methods discussed above are primarily useful for testing time sensitive application behavior, such as locking inactive posts on a discussion forum:\"}]\n2f:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Models\\\\Thread;\\n\\ntest('forum threads lock after one week of inactivity', function () {\\n    $thread = Thread::factory()-\u003ecreate();\\n\\n    $this-\u003etravel(1)-\u003eweek();\\n\\n    expect($thread-\u003eisLockedByInactivity())-\u003etoBeTrue();\\n});\\n\"}]}]\n30:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Models\\\\Thread;\\n\\npublic function test_forum_threads_lock_after_one_week_of_inactivity()\\n{\\n    $thread = Thread::factory()-\u003ecreate();\\n\\n    $this-\u003etravel(1)-\u003eweek();\\n\\n    $this-\u003eassertTrue($thread-\u003eisLockedByInactivity());\\n}\\n\"}]}]\n"])</script><script>self.__next_f.push([1,"11:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"31:I[27201,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"IconMark\"]\n13:[[\"$\",\"title\",\"0\",{\"children\":\"Create Next App\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Generated by create next app\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/favicon.ico?favicon.0b3bf435.ico\",\"sizes\":\"256x256\",\"type\":\"image/x-icon\"}],[\"$\",\"$L31\",\"3\",{}]]\nf:null\n"])</script></body></html>