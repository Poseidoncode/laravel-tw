<!DOCTYPE html><!--0lISzds8vnU9N34ubzJcA--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/797e433ab948586e-s.p.dbea232f.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/caa3a2e1cccd8315-s.p.853070df.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/chunks/bc6e94e20a39014e.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/cbd55ab9639e1e66.js"/><script src="/_next/static/chunks/87a939617be2fa8c.js" async=""></script><script src="/_next/static/chunks/8368f298651cbd89.js" async=""></script><script src="/_next/static/chunks/6740f161f60c6ab5.js" async=""></script><script src="/_next/static/chunks/turbopack-929fc2ce3ca903db.js" async=""></script><script src="/_next/static/chunks/ff1a16fafef87110.js" async=""></script><script src="/_next/static/chunks/247eb132b7f7b574.js" async=""></script><script src="/_next/static/chunks/796e69ae18b2784c.js" async=""></script><script src="/_next/static/chunks/2b257daea29fbb42.js" async=""></script><meta name="next-size-adjust" content=""/><title>Create Next App</title><meta name="description" content="Generated by create next app"/><link rel="icon" href="/favicon.ico?favicon.0b3bf435.ico" sizes="256x256" type="image/x-icon"/><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="geist_a71539c9-module__T19VSG__variable geist_mono_8d43a2aa-module__8Li5zG__variable antialiased"><div hidden=""><!--$--><!--/$--></div><div class="flex min-h-screen bg-background"><div class="w-64 border-r bg-background h-screen sticky top-0 hidden md:block"><div class="p-6 font-bold text-xl border-b flex items-center gap-2"><span class="text-red-600">Laravel</span> Docs（中文）</div><div dir="ltr" data-slot="scroll-area" class="relative h-[calc(100vh-65px)]" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><div class="p-4 space-y-2"><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>前言</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down h-4 w-4" aria-hidden="true"><path d="m6 9 6 6 6-6"></path></svg></button><div class="ml-4 mt-1 space-y-1"><a class="block" href="/docs/releases"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">發行說明</button></a></div></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>入門</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down h-4 w-4" aria-hidden="true"><path d="m6 9 6 6 6-6"></path></svg></button><div class="ml-4 mt-1 space-y-1"><a class="block" href="/docs/installation"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">安裝</button></a><a class="block" href="/docs/configuration"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">配置</button></a><a class="block" href="/docs/structure"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">目錄結構</button></a><a class="block" href="/docs/lifecycle"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">生命週期</button></a><a class="block" href="/docs/frontend"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">前端</button></a><a class="block" href="/docs/starter-kits"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">啟動套件</button></a><a class="block" href="/docs/deployment"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">部署</button></a></div></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>架構</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>基礎功能</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>深入探討</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>安全性</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>資料庫</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>Eloquent ORM</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>測試</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>其他</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>官方套件</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div class="border-t pt-4 space-y-2"><a class="block" href="/docs/api"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">API 文件</button></a><a class="block" href="/docs/releases"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">更新日誌</button></a></div></div></div></div></div></div><main class="flex-1 relative"><div class="container mx-auto py-10"><div class="mx-auto max-w-3xl"><div class="mb-8"><h1 class="scroll-m-20 text-4xl font-extrabold tracking-tight lg:text-5xl">Context</h1><p class="text-xl text-muted-foreground mt-2">Laravel Context 可讓您在整個應用程式中擷取、取回與共享資訊</p></div><article class="prose prose-slate dark:prose-invert max-w-none"><h1 id="context"><a href="#context">Context</a></h1>
<ul>
<li><a href="#introduction">介紹</a>
<ul>
<li><a href="#how-it-works">運作方式</a></li>
</ul>
</li>
<li><a href="#capturing-context">擷取 Context</a>
<ul>
<li><a href="#stacks">Stacks</a></li>
</ul>
</li>
<li><a href="#retrieving-context">取回 Context</a>
<ul>
<li><a href="#determining-item-existence">判斷項目是否存在</a></li>
</ul>
</li>
<li><a href="#removing-context">移除 Context</a></li>
<li><a href="#hidden-context">隱藏的 Context</a></li>
<li><a href="#events">Events</a>
<ul>
<li><a href="#dehydrating">Dehydrating</a></li>
<li><a href="#hydrated">Hydrated</a></li>
</ul>
</li>
</ul>
<a name="introduction"></a>
<h2 id="介紹"><a href="#介紹">介紹</a></h2>
<p>Laravel 的「context」功能可讓您在應用程式中執行的 requests、jobs 和 commands 之間擷取、取回與共享資訊。這些擷取的資訊也會包含在應用程式寫入的 logs 中，讓您更深入了解在寫入 log 條目之前發生的周圍程式碼執行歷史，並允許您追蹤整個分散式系統的執行流程。</p>
<a name="how-it-works"></a>
<h3 id="運作方式"><a href="#運作方式">運作方式</a></h3>
<p>了解 Laravel context 功能的最佳方式是使用內建的 logging 功能來實際操作。首先，您可以使用 <code>Context</code> facade 來<a href="#capturing-context">將資訊加入到 context</a>。在此範例中，我們將使用 <a href="/docs/middleware">middleware</a> 在每個傳入 request 上將 request URL 和唯一的 trace ID 加入到 context：</p>
<pre><code class="language-php">&lt;?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Context;
use Illuminate\Support\Str;
use Symfony\Component\HttpFoundation\Response;

class AddContext
{
    /**
     * Handle an incoming request.
     */
    public function handle(Request $request, Closure $next): Response
    {
        Context::add(&#x27;url&#x27;, $request-&gt;url());
        Context::add(&#x27;trace_id&#x27;, Str::uuid()-&gt;toString());

        return $next($request);
    }
}
</code></pre>
<p>加入到 context 的資訊會自動作為 metadata 附加到整個 request 過程中寫入的任何 <a href="/docs/logging">log 條目</a>。將 context 作為 metadata 附加可以區分傳遞給個別 log 條目的資訊與透過 <code>Context</code> 共享的資訊。例如，假設我們寫入以下 log 條目：</p>
<pre><code class="language-php">Log::info(&#x27;User authenticated.&#x27;, [&#x27;auth_id&#x27; =&gt; Auth::id()]);
</code></pre>
<p>寫入的 log 將包含傳遞給 log 條目的 <code>auth_id</code>，但它也會包含 context 的 <code>url</code> 和 <code>trace_id</code> 作為 metadata：</p>
<pre><code class="language-text">User authenticated. {&quot;auth_id&quot;:27} {&quot;url&quot;:&quot;https://example.com/login&quot;,&quot;trace_id&quot;:&quot;e04e1a11-e75c-4db3-b5b5-cfef4ef56697&quot;}
</code></pre>
<p>加入到 context 的資訊也可供發送到 queue 的 jobs 使用。例如，假設我們在將一些資訊加入到 context 後，將 <code>ProcessPodcast</code> job 發送到 queue：</p>
<pre><code class="language-php">// In our middleware...
Context::add(&#x27;url&#x27;, $request-&gt;url());
Context::add(&#x27;trace_id&#x27;, Str::uuid()-&gt;toString());

// In our controller...
ProcessPodcast::dispatch($podcast);
</code></pre>
<p>當 job 被發送時，目前儲存在 context 中的任何資訊都會被擷取並與 job 共享。擷取的資訊會在 job 執行時被 hydrated 回到目前的 context 中。因此，如果我們的 job 的 handle 方法要寫入 log：</p>
<pre><code class="language-php">class ProcessPodcast implements ShouldQueue
{
    use Queueable;

    // ...

    /**
     * Execute the job.
     */
    public function handle(): void
    {
        Log::info(&#x27;Processing podcast.&#x27;, [
            &#x27;podcast_id&#x27; =&gt; $this-&gt;podcast-&gt;id,
        ]);

        // ...
    }
}
</code></pre>
<p>產生的 log 條目將包含在最初發送 job 的 request 期間加入到 context 的資訊：</p>
<pre><code class="language-text">Processing podcast. {&quot;podcast_id&quot;:95} {&quot;url&quot;:&quot;https://example.com/login&quot;,&quot;trace_id&quot;:&quot;e04e1a11-e75c-4db3-b5b5-cfef4ef56697&quot;}
</code></pre>
<p>雖然我們專注於 Laravel context 的內建 logging 相關功能，但以下文件將說明 context 如何讓您跨 HTTP request / queued job 邊界共享資訊，甚至如何加入不會與 log 條目一起寫入的<a href="#hidden-context">隱藏 context 資料</a>。</p>
<a name="capturing-context"></a>
<h2 id="擷取-context"><a href="#擷取-context">擷取 Context</a></h2>
<p>您可以使用 <code>Context</code> facade 的 <code>add</code> 方法將資訊儲存在目前的 context 中：</p>
<pre><code class="language-php">use Illuminate\Support\Facades\Context;

Context::add(&#x27;key&#x27;, &#x27;value&#x27;);
</code></pre>
<p>要一次加入多個項目，您可以傳遞一個關聯陣列給 <code>add</code> 方法：</p>
<pre><code class="language-php">Context::add([
    &#x27;first_key&#x27; =&gt; &#x27;value&#x27;,
    &#x27;second_key&#x27; =&gt; &#x27;value&#x27;,
]);
</code></pre>
<p><code>add</code> 方法會覆蓋任何共享相同 key 的現有值。如果您只想在 key 尚不存在時才將資訊加入到 context，您可以使用 <code>addIf</code> 方法：</p>
<pre><code class="language-php">Context::add(&#x27;key&#x27;, &#x27;first&#x27;);

Context::get(&#x27;key&#x27;);
// &quot;first&quot;

Context::addIf(&#x27;key&#x27;, &#x27;second&#x27;);

Context::get(&#x27;key&#x27;);
// &quot;first&quot;
</code></pre>
<p>Context 還提供了方便的方法來遞增或遞減給定的 key。這兩個方法至少接受一個引數：要追蹤的 key。可以提供第二個引數來指定 key 應該遞增或遞減的量：</p>
<pre><code class="language-php">Context::increment(&#x27;records_added&#x27;);
Context::increment(&#x27;records_added&#x27;, 5);

Context::decrement(&#x27;records_added&#x27;);
Context::decrement(&#x27;records_added&#x27;, 5);
</code></pre>
<a name="conditional-context"></a>
<h4 id="條件式-context"><a href="#條件式-context">條件式 Context</a></h4>
<p><code>when</code> 方法可用於根據給定條件將資料加入到 context。如果給定條件評估為 <code>true</code>，則會呼叫提供給 <code>when</code> 方法的第一個 closure，如果條件評估為 <code>false</code>，則會呼叫第二個 closure：</p>
<pre><code class="language-php">use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Context;

Context::when(
    Auth::user()-&gt;isAdmin(),
    fn ($context) =&gt; $context-&gt;add(&#x27;permissions&#x27;, Auth::user()-&gt;permissions),
    fn ($context) =&gt; $context-&gt;add(&#x27;permissions&#x27;, []),
);
</code></pre>
<a name="scoped-context"></a>
<h4 id="作用域-context"><a href="#作用域-context">作用域 Context</a></h4>
<p><code>scope</code> 方法提供了一種在給定 callback 執行期間暫時修改 context，並在 callback 完成執行時將 context 還原到原始狀態的方式。此外，您可以傳遞額外的資料（作為第二和第三個引數），這些資料應在 closure 執行時合併到 context 中。</p>
<pre><code class="language-php">use Illuminate\Support\Facades\Context;
use Illuminate\Support\Facades\Log;

Context::add(&#x27;trace_id&#x27;, &#x27;abc-999&#x27;);
Context::addHidden(&#x27;user_id&#x27;, 123);

Context::scope(
    function () {
        Context::add(&#x27;action&#x27;, &#x27;adding_friend&#x27;);

        $userId = Context::getHidden(&#x27;user_id&#x27;);

        Log::debug(&quot;Adding user [{$userId}] to friends list.&quot;);
        // Adding user [987] to friends list.  {&quot;trace_id&quot;:&quot;abc-999&quot;,&quot;user_name&quot;:&quot;taylor_otwell&quot;,&quot;action&quot;:&quot;adding_friend&quot;}
    },
    data: [&#x27;user_name&#x27; =&gt; &#x27;taylor_otwell&#x27;],
    hidden: [&#x27;user_id&#x27; =&gt; 987],
);

Context::all();
// [
//     &#x27;trace_id&#x27; =&gt; &#x27;abc-999&#x27;,
// ]

Context::allHidden();
// [
//     &#x27;user_id&#x27; =&gt; 123,
// ]
</code></pre>
<blockquote>
<p>[!WARNING]
如果在作用域 closure 內修改了 context 中的物件，該變更將反映在作用域外。</p>
</blockquote>
<a name="stacks"></a>
<h3 id="stacks"><a href="#stacks">Stacks</a></h3>
<p>Context 提供了建立「stacks」的功能，這是按照加入順序儲存的資料列表。您可以透過呼叫 <code>push</code> 方法將資訊加入到 stack：</p>
<pre><code class="language-php">use Illuminate\Support\Facades\Context;

Context::push(&#x27;breadcrumbs&#x27;, &#x27;first_value&#x27;);

Context::push(&#x27;breadcrumbs&#x27;, &#x27;second_value&#x27;, &#x27;third_value&#x27;);

Context::get(&#x27;breadcrumbs&#x27;);
// [
//     &#x27;first_value&#x27;,
//     &#x27;second_value&#x27;,
//     &#x27;third_value&#x27;,
// ]
</code></pre>
<p>Stacks 可用於擷取有關 request 的歷史資訊，例如整個應用程式中發生的 events。例如，您可以建立一個 event listener，在每次執行查詢時推送到 stack，將查詢 SQL 和持續時間擷取為 tuple：</p>
<pre><code class="language-php">use Illuminate\Support\Facades\Context;
use Illuminate\Support\Facades\DB;

// In AppServiceProvider.php...
DB::listen(function ($event) {
    Context::push(&#x27;queries&#x27;, [$event-&gt;time, $event-&gt;sql]);
});
</code></pre>
<p>您可以使用 <code>stackContains</code> 和 <code>hiddenStackContains</code> 方法來判斷值是否在 stack 中：</p>
<pre><code class="language-php">if (Context::stackContains(&#x27;breadcrumbs&#x27;, &#x27;first_value&#x27;)) {
    //
}

if (Context::hiddenStackContains(&#x27;secrets&#x27;, &#x27;first_value&#x27;)) {
    //
}
</code></pre>
<p><code>stackContains</code> 和 <code>hiddenStackContains</code> 方法也接受 closure 作為其第二個引數，允許更多控制值比較操作：</p>
<pre><code class="language-php">use Illuminate\Support\Facades\Context;
use Illuminate\Support\Str;

return Context::stackContains(&#x27;breadcrumbs&#x27;, function ($value) {
    return Str::startsWith($value, &#x27;query_&#x27;);
});
</code></pre>
<a name="retrieving-context"></a>
<h2 id="取回-context"><a href="#取回-context">取回 Context</a></h2>
<p>您可以使用 <code>Context</code> facade 的 <code>get</code> 方法從 context 取回資訊：</p>
<pre><code class="language-php">use Illuminate\Support\Facades\Context;

$value = Context::get(&#x27;key&#x27;);
</code></pre>
<p><code>only</code> 和 <code>except</code> 方法可用於取回 context 中資訊的子集：</p>
<pre><code class="language-php">$data = Context::only([&#x27;first_key&#x27;, &#x27;second_key&#x27;]);

$data = Context::except([&#x27;first_key&#x27;]);
</code></pre>
<p><code>pull</code> 方法可用於從 context 取回資訊並立即將其從 context 中移除：</p>
<pre><code class="language-php">$value = Context::pull(&#x27;key&#x27;);
</code></pre>
<p>如果 context 資料儲存在 <a href="#stacks">stack</a> 中，您可以使用 <code>pop</code> 方法從 stack 彈出項目：</p>
<pre><code class="language-php">Context::push(&#x27;breadcrumbs&#x27;, &#x27;first_value&#x27;, &#x27;second_value&#x27;);

Context::pop(&#x27;breadcrumbs&#x27;);
// second_value

Context::get(&#x27;breadcrumbs&#x27;);
// [&#x27;first_value&#x27;]
</code></pre>
<p><code>remember</code> 和 <code>rememberHidden</code> 方法可用於從 context 取回資訊，如果請求的資訊不存在，則將 context 值設定為給定 closure 傳回的值：</p>
<pre><code class="language-php">$permissions = Context::remember(
    &#x27;user-permissions&#x27;,
    fn () =&gt; $user-&gt;permissions,
);
</code></pre>
<p>如果您想取回儲存在 context 中的所有資訊，您可以呼叫 <code>all</code> 方法：</p>
<pre><code class="language-php">$data = Context::all();
</code></pre>
<a name="determining-item-existence"></a>
<h3 id="判斷項目是否存在"><a href="#判斷項目是否存在">判斷項目是否存在</a></h3>
<p>您可以使用 <code>has</code> 和 <code>missing</code> 方法來判斷 context 是否為給定 key 儲存了任何值：</p>
<pre><code class="language-php">use Illuminate\Support\Facades\Context;

if (Context::has(&#x27;key&#x27;)) {
    // ...
}

if (Context::missing(&#x27;key&#x27;)) {
    // ...
}
</code></pre>
<p>無論儲存的值是什麼，<code>has</code> 方法都會傳回 <code>true</code>。因此，例如，具有 <code>null</code> 值的 key 將被視為存在：</p>
<pre><code class="language-php">Context::add(&#x27;key&#x27;, null);

Context::has(&#x27;key&#x27;);
// true
</code></pre>
<a name="removing-context"></a>
<h2 id="移除-context"><a href="#移除-context">移除 Context</a></h2>
<p><code>forget</code> 方法可用於從目前的 context 中移除 key 及其值：</p>
<pre><code class="language-php">use Illuminate\Support\Facades\Context;

Context::add([&#x27;first_key&#x27; =&gt; 1, &#x27;second_key&#x27; =&gt; 2]);

Context::forget(&#x27;first_key&#x27;);

Context::all();

// [&#x27;second_key&#x27; =&gt; 2]
</code></pre>
<p>您可以透過向 <code>forget</code> 方法提供陣列來一次忘記多個 key：</p>
<pre><code class="language-php">Context::forget([&#x27;first_key&#x27;, &#x27;second_key&#x27;]);
</code></pre>
<a name="hidden-context"></a>
<h2 id="隱藏的-context"><a href="#隱藏的-context">隱藏的 Context</a></h2>
<p>Context 提供了儲存「隱藏」資料的功能。這些隱藏資訊不會附加到 logs，也無法透過上述記載的資料取回方法存取。Context 提供了一組不同的方法來與隱藏的 context 資訊互動：</p>
<pre><code class="language-php">use Illuminate\Support\Facades\Context;

Context::addHidden(&#x27;key&#x27;, &#x27;value&#x27;);

Context::getHidden(&#x27;key&#x27;);
// &#x27;value&#x27;

Context::get(&#x27;key&#x27;);
// null
</code></pre>
<p>「隱藏」方法反映了上述記載的非隱藏方法的功能：</p>
<pre><code class="language-php">Context::addHidden(/* ... */);
Context::addHiddenIf(/* ... */);
Context::pushHidden(/* ... */);
Context::getHidden(/* ... */);
Context::pullHidden(/* ... */);
Context::popHidden(/* ... */);
Context::onlyHidden(/* ... */);
Context::exceptHidden(/* ... */);
Context::allHidden(/* ... */);
Context::hasHidden(/* ... */);
Context::missingHidden(/* ... */);
Context::forgetHidden(/* ... */);
</code></pre>
<a name="events"></a>
<h2 id="events"><a href="#events">Events</a></h2>
<p>Context 會發送兩個 events，讓您可以掛鉤到 context 的 hydration 和 dehydration 過程。</p>
<p>為了說明如何使用這些 events，假設在應用程式的 middleware 中，您根據傳入 HTTP request 的 <code>Accept-Language</code> header 設定 <code>app.locale</code> 設定值。Context 的 events 讓您可以在 request 期間擷取此值並在 queue 上還原它，確保在 queue 上發送的 notifications 具有正確的 <code>app.locale</code> 值。我們可以使用 context 的 events 和<a href="#hidden-context">隱藏</a>資料來實現這一點，以下文件將說明這一點。</p>
<a name="dehydrating"></a>
<h3 id="dehydrating"><a href="#dehydrating">Dehydrating</a></h3>
<p>每當 job 被發送到 queue 時，context 中的資料會被「dehydrated」並與 job 的 payload 一起擷取。<code>Context::dehydrating</code> 方法讓您可以註冊一個將在 dehydration 過程中呼叫的 closure。在此 closure 中，您可以對將與 queued job 共享的資料進行變更。</p>
<p>通常，您應該在應用程式的 <code>AppServiceProvider</code> 類別的 <code>boot</code> 方法中註冊 <code>dehydrating</code> callbacks：</p>
<pre><code class="language-php">use Illuminate\Log\Context\Repository;
use Illuminate\Support\Facades\Config;
use Illuminate\Support\Facades\Context;

/**
 * Bootstrap any application services.
 */
public function boot(): void
{
    Context::dehydrating(function (Repository $context) {
        $context-&gt;addHidden(&#x27;locale&#x27;, Config::get(&#x27;app.locale&#x27;));
    });
}
</code></pre>
<blockquote>
<p>[!NOTE]
您不應該在 <code>dehydrating</code> callback 中使用 <code>Context</code> facade，因為這將改變目前 process 的 context。請確保您只對傳遞給 callback 的 repository 進行變更。</p>
</blockquote>
<a name="hydrated"></a>
<h3 id="hydrated"><a href="#hydrated">Hydrated</a></h3>
<p>每當 queued job 開始在 queue 上執行時，與 job 共享的任何 context 都將被「hydrated」回到目前的 context 中。<code>Context::hydrated</code> 方法讓您可以註冊一個將在 hydration 過程中呼叫的 closure。</p>
<p>通常，您應該在應用程式的 <code>AppServiceProvider</code> 類別的 <code>boot</code> 方法中註冊 <code>hydrated</code> callbacks：</p>
<pre><code class="language-php">use Illuminate\Log\Context\Repository;
use Illuminate\Support\Facades\Config;
use Illuminate\Support\Facades\Context;

/**
 * Bootstrap any application services.
 */
public function boot(): void
{
    Context::hydrated(function (Repository $context) {
        if ($context-&gt;hasHidden(&#x27;locale&#x27;)) {
            Config::set(&#x27;app.locale&#x27;, $context-&gt;getHidden(&#x27;locale&#x27;));
        }
    });
}
</code></pre>
<blockquote>
<p>[!NOTE]
您不應該在 <code>hydrated</code> callback 中使用 <code>Context</code> facade，而是確保您只對傳遞給 callback 的 repository 進行變更。</p>
</blockquote></article></div></div><!--$--><!--/$--></main></div><script src="/_next/static/chunks/cbd55ab9639e1e66.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[39756,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"default\"]\n3:I[37457,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"default\"]\n4:I[93649,[\"/_next/static/chunks/796e69ae18b2784c.js\",\"/_next/static/chunks/2b257daea29fbb42.js\"],\"DocsSidebar\"]\n6:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"OutletBoundary\"]\n7:\"$Sreact.suspense\"\n9:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"ViewportBoundary\"]\nb:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"MetadataBoundary\"]\nd:I[68027,[],\"default\"]\n:HL[\"/_next/static/chunks/bc6e94e20a39014e.css\",\"style\"]\n:HL[\"/_next/static/media/797e433ab948586e-s.p.dbea232f.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/caa3a2e1cccd8315-s.p.853070df.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"0lISzds8vnU9N34ubzJcA\",\"c\":[\"\",\"docs\",\"context\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[[\"slug\",\"context\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/bc6e94e20a39014e.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"geist_a71539c9-module__T19VSG__variable geist_mono_8d43a2aa-module__8Li5zG__variable antialiased\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/796e69ae18b2784c.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/_next/static/chunks/2b257daea29fbb42.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"div\",null,{\"className\":\"flex min-h-screen bg-background\",\"children\":[[\"$\",\"$L4\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-1 relative\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@8\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L9\",null,{\"children\":\"$@a\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$Lb\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.Metadata\",\"children\":\"$@c\"}]}]}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"className\":\"container mx-auto py-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-3xl\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"scroll-m-20 text-4xl font-extrabold tracking-tight lg:text-5xl\",\"children\":\"Context\"}],[\"$\",\"p\",null,{\"className\":\"text-xl text-muted-foreground mt-2\",\"children\":\"Laravel Context 可讓您在整個應用程式中擷取、取回與共享資訊\"}]]}],[\"$\",\"article\",null,{\"className\":\"prose prose-slate dark:prose-invert max-w-none\",\"children\":[[\"$\",\"h1\",null,{\"id\":\"context\",\"children\":[\"$\",\"a\",null,{\"href\":\"#context\",\"children\":\"Context\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"#introduction\",\"children\":\"介紹\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#how-it-works\",\"children\":\"運作方式\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"#capturing-context\",\"children\":\"擷取 Context\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#stacks\",\"children\":\"Stacks\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"#retrieving-context\",\"children\":\"取回 Context\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#determining-item-existence\",\"children\":\"判斷項目是否存在\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#removing-context\",\"children\":\"移除 Context\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#hidden-context\",\"children\":\"隱藏的 Context\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"#events\",\"children\":\"Events\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#dehydrating\",\"children\":\"Dehydrating\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#hydrated\",\"children\":\"Hydrated\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"a\",null,{\"name\":\"introduction\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"介紹\",\"children\":[\"$\",\"a\",null,{\"href\":\"#介紹\",\"children\":\"介紹\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Laravel 的「context」功能可讓您在應用程式中執行的 requests、jobs 和 commands 之間擷取、取回與共享資訊。這些擷取的資訊也會包含在應用程式寫入的 logs 中，讓您更深入了解在寫入 log 條目之前發生的周圍程式碼執行歷史，並允許您追蹤整個分散式系統的執行流程。\"}],\"\\n\",[\"$\",\"a\",null,{\"name\":\"how-it-works\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"運作方式\",\"children\":[\"$\",\"a\",null,{\"href\":\"#運作方式\",\"children\":\"運作方式\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"了解 Laravel context 功能的最佳方式是使用內建的 logging 功能來實際操作。首先，您可以使用 \",[\"$\",\"code\",null,{\"children\":\"Context\"}],\" facade 來\",[\"$\",\"a\",null,{\"href\":\"#capturing-context\",\"children\":\"將資訊加入到 context\"}],\"。在此範例中，我們將使用 \",[\"$\",\"a\",null,{\"href\":\"/docs/middleware\",\"children\":\"middleware\"}],\" 在每個傳入 request 上將 request URL 和唯一的 trace ID 加入到 context：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"\u003c?php\\n\\nnamespace App\\\\Http\\\\Middleware;\\n\\nuse Closure;\\nuse Illuminate\\\\Http\\\\Request;\\nuse Illuminate\\\\Support\\\\Facades\\\\Context;\\nuse Illuminate\\\\Support\\\\Str;\\nuse Symfony\\\\Component\\\\HttpFoundation\\\\Response;\\n\\nclass AddContext\\n{\\n    /**\\n     * Handle an incoming request.\\n     */\\n    public function handle(Request $request, Closure $next): Response\\n    {\\n        Context::add('url', $request-\u003eurl());\\n        Context::add('trace_id', Str::uuid()-\u003etoString());\\n\\n        return $next($request);\\n    }\\n}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"加入到 context 的資訊會自動作為 metadata 附加到整個 request 過程中寫入的任何 \",[\"$\",\"a\",null,{\"href\":\"/docs/logging\",\"children\":\"log 條目\"}],\"。將 context 作為 metadata 附加可以區分傳遞給個別 log 條目的資訊與透過 \",[\"$\",\"code\",null,{\"children\":\"Context\"}],\" 共享的資訊。例如，假設我們寫入以下 log 條目：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"Log::info('User authenticated.', ['auth_id' =\u003e Auth::id()]);\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"寫入的 log 將包含傳遞給 log 條目的 \",[\"$\",\"code\",null,{\"children\":\"auth_id\"}],\"，但它也會包含 context 的 \",[\"$\",\"code\",null,{\"children\":\"url\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"trace_id\"}],\" 作為 metadata：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-text\",\"children\":\"User authenticated. {\\\"auth_id\\\":27} {\\\"url\\\":\\\"https://example.com/login\\\",\\\"trace_id\\\":\\\"e04e1a11-e75c-4db3-b5b5-cfef4ef56697\\\"}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"加入到 context 的資訊也可供發送到 queue 的 jobs 使用。例如，假設我們在將一些資訊加入到 context 後，將 \",[\"$\",\"code\",null,{\"children\":\"ProcessPodcast\"}],\" job 發送到 queue：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"// In our middleware...\\nContext::add('url', $request-\u003eurl());\\nContext::add('trace_id', Str::uuid()-\u003etoString());\\n\\n// In our controller...\\nProcessPodcast::dispatch($podcast);\\n\"}]}],\"\\n\",\"$Le\",\"\\n\",\"$Lf\",\"\\n\",\"$L10\",\"\\n\",\"$L11\",\"\\n\",\"$L12\",\"\\n\",\"$L13\",\"\\n\",\"$L14\",\"\\n\",\"$L15\",\"\\n\",\"$L16\",\"\\n\",\"$L17\",\"\\n\",\"$L18\",\"\\n\",\"$L19\",\"\\n\",\"$L1a\",\"\\n\",\"$L1b\",\"\\n\",\"$L1c\",\"\\n\",\"$L1d\",\"\\n\",\"$L1e\",\"\\n\",\"$L1f\",\"\\n\",\"$L20\",\"\\n\",\"$L21\",\"\\n\",\"$L22\",\"\\n\",\"$L23\",\"\\n\",\"$L24\",\"\\n\",\"$L25\",\"\\n\",\"$L26\",\"\\n\",\"$L27\",\"\\n\",\"$L28\",\"\\n\",\"$L29\",\"\\n\",\"$L2a\",\"\\n\",\"$L2b\",\"\\n\",\"$L2c\",\"\\n\",\"$L2d\",\"\\n\",\"$L2e\",\"\\n\",\"$L2f\",\"\\n\",\"$L30\",\"\\n\",\"$L31\",\"\\n\",\"$L32\",\"\\n\",\"$L33\",\"\\n\",\"$L34\",\"\\n\",\"$L35\",\"\\n\",\"$L36\",\"\\n\",\"$L37\",\"\\n\",\"$L38\",\"\\n\",\"$L39\",\"\\n\",\"$L3a\",\"\\n\",\"$L3b\",\"\\n\",\"$L3c\",\"\\n\",\"$L3d\",\"\\n\",\"$L3e\",\"\\n\",\"$L3f\",\"\\n\",\"$L40\",\"\\n\",\"$L41\",\"\\n\",\"$L42\",\"\\n\",\"$L43\",\"\\n\",\"$L44\",\"\\n\",\"$L45\",\"\\n\",\"$L46\",\"\\n\",\"$L47\",\"\\n\",\"$L48\",\"\\n\",\"$L49\",\"\\n\",\"$L4a\",\"\\n\",\"$L4b\",\"\\n\",\"$L4c\",\"\\n\",\"$L4d\",\"\\n\",\"$L4e\",\"\\n\",\"$L4f\",\"\\n\",\"$L50\",\"\\n\",\"$L51\",\"\\n\",\"$L52\",\"\\n\",\"$L53\",\"\\n\",\"$L54\",\"\\n\",\"$L55\",\"\\n\",\"$L56\",\"\\n\",\"$L57\",\"\\n\",\"$L58\",\"\\n\",\"$L59\",\"\\n\",\"$L5a\",\"\\n\",\"$L5b\",\"\\n\",\"$L5c\",\"\\n\",\"$L5d\",\"\\n\",\"$L5e\",\"\\n\",\"$L5f\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"e:[\"$\",\"p\",null,{\"children\":\"當 job 被發送時，目前儲存在 context 中的任何資訊都會被擷取並與 job 共享。擷取的資訊會在 job 執行時被 hydrated 回到目前的 context 中。因此，如果我們的 job 的 handle 方法要寫入 log：\"}]\nf:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"class ProcessPodcast implements ShouldQueue\\n{\\n    use Queueable;\\n\\n    // ...\\n\\n    /**\\n     * Execute the job.\\n     */\\n    public function handle(): void\\n    {\\n        Log::info('Processing podcast.', [\\n            'podcast_id' =\u003e $this-\u003epodcast-\u003eid,\\n        ]);\\n\\n        // ...\\n    }\\n}\\n\"}]}]\n10:[\"$\",\"p\",null,{\"children\":\"產生的 log 條目將包含在最初發送 job 的 request 期間加入到 context 的資訊：\"}]\n11:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-text\",\"children\":\"Processing podcast. {\\\"podcast_id\\\":95} {\\\"url\\\":\\\"https://example.com/login\\\",\\\"trace_id\\\":\\\"e04e1a11-e75c-4db3-b5b5-cfef4ef56697\\\"}\\n\"}]}]\n12:[\"$\",\"p\",null,{\"children\":[\"雖然我們專注於 Laravel context 的內建 logging 相關功能，但以下文件將說明 context 如何讓您跨 HTTP request / queued job 邊界共享資訊，甚至如何加入不會與 log 條目一起寫入的\",[\"$\",\"a\",null,{\"href\":\"#hidden-context\",\"children\":\"隱藏 context 資料\"}],\"。\"]}]\n13:[\"$\",\"a\",null,{\"name\":\"capturing-context\"}]\n14:[\"$\",\"h2\",null,{\"id\":\"擷取-context\",\"children\":[\"$\",\"a\",null,{\"href\":\"#擷取-context\",\"children\":\"擷取 Context\"}]}]\n15:[\"$\",\"p\",null,{\"children\":[\"您可以使用 \",[\"$\",\"code\",null,{\"children\":\"Context\"}],\" facade 的 \",[\"$\",\"code\",null,{\"children\":\"add\"}],\" 方法將資訊儲存在目前的 context 中：\"]}]\n16:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Illuminate\\\\Support\\\\Facades\\\\Context;\\n\\nContext::add('key', 'value');\\n\"}]}]\n17:[\"$\",\"p\",null,{\"children\":[\"要一次加入多個項目，您可以傳遞一個關聯陣列給 \",[\"$\",\"code\",null,{\"children\":\"add\"}],\" 方法：\"]}]\n18:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"Context::add([\\n    'first_key' =\u003e 'value',\\n    'second_key' =\u003e 'value',\\n]);\\n\"}]}]\n19:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"add\"}],\" 方法會覆蓋任何共享相同 key 的現有值。如果您只想在 key 尚不存在時才將資訊加入到 context，您可以使用 \",[\"$\",\"code\",null,{\"children\":\"addIf\"}],\" 方法：\"]}]\n1a:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"Context::add('key', 'first');\\n\\nContext::get('key');\\n// \\\"first\\\"\\n\\nContext::addIf('key', 'second');\\n\\nContext::get('key');\\n// \\\"first\\\"\\n\"}]}]\n1b:[\"$\",\"p\",null,{\"children\":\"Context 還提供了方便的方法來遞增或遞減給定的 key。這兩個方法至少接受一個引數：要追蹤的 key。可以提供第二個引數來指定 key 應該遞增或遞減的量：\"}]\n1c:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"Context::increment('records_added');\\nContext::increment('records_added', 5);\\n\\nContext::decrement('records_added');\\nContext::decrement('records_added', 5);\\n\"}]}]\n1d:[\"$\",\"a\",null,{\"name\":\"conditional-context\"}]\n1e:[\"$\",\"h4\",null,{\"id\":\"條件式-context\",\"children\":[\"$\",\"a\",null,{\"href\":\"#條件式-context\",\"children\":\"條件式 Context\"}]}]\n1f:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"when\"}],\" 方法可用於根據給定條件將資料加入到 context。如果給定條件評估為 \",[\"$\",\"code\",null,{\"children\":\"true\"}],\"，則會呼叫提供給 \",[\"$\",\"code\",null,{\"children\":\"when\"}],\" 方法的第一個 closure，如果條件評估為 \",[\"$\",\"code\",null,{\"children\":\"false\"}],\"，則會呼叫第二個 closure：\"]}]\n20:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Illuminate\\\\Support\\\\Facades\\\\Auth;\\nuse Illuminate\\\\Support\\\\Facades\\\\Context;\\n\\nContext::when(\\n    Auth::user()-\u003eisAdmin(),\\n    fn ($context) =\u003e $context-\u003eadd('permissions', Auth::user()-\u003ep"])</script><script>self.__next_f.push([1,"ermissions),\\n    fn ($context) =\u003e $context-\u003eadd('permissions', []),\\n);\\n\"}]}]\n21:[\"$\",\"a\",null,{\"name\":\"scoped-context\"}]\n22:[\"$\",\"h4\",null,{\"id\":\"作用域-context\",\"children\":[\"$\",\"a\",null,{\"href\":\"#作用域-context\",\"children\":\"作用域 Context\"}]}]\n23:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"scope\"}],\" 方法提供了一種在給定 callback 執行期間暫時修改 context，並在 callback 完成執行時將 context 還原到原始狀態的方式。此外，您可以傳遞額外的資料（作為第二和第三個引數），這些資料應在 closure 執行時合併到 context 中。\"]}]\n24:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Illuminate\\\\Support\\\\Facades\\\\Context;\\nuse Illuminate\\\\Support\\\\Facades\\\\Log;\\n\\nContext::add('trace_id', 'abc-999');\\nContext::addHidden('user_id', 123);\\n\\nContext::scope(\\n    function () {\\n        Context::add('action', 'adding_friend');\\n\\n        $userId = Context::getHidden('user_id');\\n\\n        Log::debug(\\\"Adding user [{$userId}] to friends list.\\\");\\n        // Adding user [987] to friends list.  {\\\"trace_id\\\":\\\"abc-999\\\",\\\"user_name\\\":\\\"taylor_otwell\\\",\\\"action\\\":\\\"adding_friend\\\"}\\n    },\\n    data: ['user_name' =\u003e 'taylor_otwell'],\\n    hidden: ['user_id' =\u003e 987],\\n);\\n\\nContext::all();\\n// [\\n//     'trace_id' =\u003e 'abc-999',\\n// ]\\n\\nContext::allHidden();\\n// [\\n//     'user_id' =\u003e 123,\\n// ]\\n\"}]}]\n25:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"[!WARNING]\\n如果在作用域 closure 內修改了 context 中的物件，該變更將反映在作用域外。\"}],\"\\n\"]}]\n26:[\"$\",\"a\",null,{\"name\":\"stacks\"}]\n27:[\"$\",\"h3\",null,{\"id\":\"stacks\",\"children\":[\"$\",\"a\",null,{\"href\":\"#stacks\",\"children\":\"Stacks\"}]}]\n28:[\"$\",\"p\",null,{\"children\":[\"Context 提供了建立「stacks」的功能，這是按照加入順序儲存的資料列表。您可以透過呼叫 \",[\"$\",\"code\",null,{\"children\":\"push\"}],\" 方法將資訊加入到 stack：\"]}]\n29:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Illuminate\\\\Support\\\\Facades\\\\Context;\\n\\nContext::push('breadcrumbs', 'first_value');\\n\\nContext::push('breadcrumbs', 'second_value', 'third_value');\\n\\nContext::get('breadcrumbs');\\n// [\\n//     'first_value',\\n//     'second_value',\\n//     'third_value',\\n// ]\\n\"}]}]\n2a:[\"$\",\"p\",null,{\"children\":\"Stacks 可用於擷取有關 request 的歷史資訊，例如整個應用程式中發生的 events。例如，您可以建立一個 event listener，在每次執行查詢時推送到 stack，將查詢 SQL 和持續時間擷取為 tuple：\"}]\n2b:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Illuminate\\\\Support\\\\Facades\\\\Context;\\nuse Illuminate\\\\Support\\\\Facades\\\\DB;\\n\\n// In AppServiceProvider.php...\\nDB::listen(function ($event) {\\n    Context::push('queries', [$event-\u003etime, $event-\u003esql]);\\n});\\n\"}]}]\n2c:[\"$\",\"p\",null,{\"children\":[\"您可以使用 \",[\"$\",\"code\",null,{\"children\":\"stackContains\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"hiddenStackContains\"}],\" 方法來判斷值是否在 stack 中：\"]}]\n2d:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"if (Context::stackContains('breadcrumbs', 'first_value')) {\\n    //\\n}\\n\\nif (Context::hiddenStackContains('secrets', 'first_value')) {\\n    //\\n}\\n\"}]}]\n2e:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"stackContains\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"hiddenStackContains\"}],\" 方法也接受 closure 作為其第二個引數，允許更多控制值比較操作：\"]}]\n2f:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Illuminate\\\\Support\\\\Facades\\\\Context;\\nuse Illuminate\\\\Support\\\\Str;\\n\\nreturn Context::stackContains('breadcrumbs', function ($value) {\\n    return Str::startsWith($value, 'query_');\\n});\\n\"}]}]\n30:[\"$\",\"a\",null,{\"name\":\"retrieving-context\"}]\n31:[\"$\",\"h2\",null,{\"id\":\"取回-context\",\"children\":[\"$\",\"a\",null,{\"href\":\"#取回-context\",\"children\":\"取回 Context\"}]}]\n32:[\"$\",\"p\",nul"])</script><script>self.__next_f.push([1,"l,{\"children\":[\"您可以使用 \",[\"$\",\"code\",null,{\"children\":\"Context\"}],\" facade 的 \",[\"$\",\"code\",null,{\"children\":\"get\"}],\" 方法從 context 取回資訊：\"]}]\n33:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Illuminate\\\\Support\\\\Facades\\\\Context;\\n\\n$value = Context::get('key');\\n\"}]}]\n34:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"only\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"except\"}],\" 方法可用於取回 context 中資訊的子集：\"]}]\n35:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"$$data = Context::only(['first_key', 'second_key']);\\n\\n$data = Context::except(['first_key']);\\n\"}]}]\n36:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"pull\"}],\" 方法可用於從 context 取回資訊並立即將其從 context 中移除：\"]}]\n37:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"$$value = Context::pull('key');\\n\"}]}]\n38:[\"$\",\"p\",null,{\"children\":[\"如果 context 資料儲存在 \",[\"$\",\"a\",null,{\"href\":\"#stacks\",\"children\":\"stack\"}],\" 中，您可以使用 \",[\"$\",\"code\",null,{\"children\":\"pop\"}],\" 方法從 stack 彈出項目：\"]}]\n39:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"Context::push('breadcrumbs', 'first_value', 'second_value');\\n\\nContext::pop('breadcrumbs');\\n// second_value\\n\\nContext::get('breadcrumbs');\\n// ['first_value']\\n\"}]}]\n3a:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"remember\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"rememberHidden\"}],\" 方法可用於從 context 取回資訊，如果請求的資訊不存在，則將 context 值設定為給定 closure 傳回的值：\"]}]\n3b:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"$$permissions = Context::remember(\\n    'user-permissions',\\n    fn () =\u003e $user-\u003epermissions,\\n);\\n\"}]}]\n3c:[\"$\",\"p\",null,{\"children\":[\"如果您想取回儲存在 context 中的所有資訊，您可以呼叫 \",[\"$\",\"code\",null,{\"children\":\"all\"}],\" 方法：\"]}]\n3d:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"$$data = Context::all();\\n\"}]}]\n3e:[\"$\",\"a\",null,{\"name\":\"determining-item-existence\"}]\n3f:[\"$\",\"h3\",null,{\"id\":\"判斷項目是否存在\",\"children\":[\"$\",\"a\",null,{\"href\":\"#判斷項目是否存在\",\"children\":\"判斷項目是否存在\"}]}]\n40:[\"$\",\"p\",null,{\"children\":[\"您可以使用 \",[\"$\",\"code\",null,{\"children\":\"has\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"missing\"}],\" 方法來判斷 context 是否為給定 key 儲存了任何值：\"]}]\n41:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Illuminate\\\\Support\\\\Facades\\\\Context;\\n\\nif (Context::has('key')) {\\n    // ...\\n}\\n\\nif (Context::missing('key')) {\\n    // ...\\n}\\n\"}]}]\n42:[\"$\",\"p\",null,{\"children\":[\"無論儲存的值是什麼，\",[\"$\",\"code\",null,{\"children\":\"has\"}],\" 方法都會傳回 \",[\"$\",\"code\",null,{\"children\":\"true\"}],\"。因此，例如，具有 \",[\"$\",\"code\",null,{\"children\":\"null\"}],\" 值的 key 將被視為存在：\"]}]\n43:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"Context::add('key', null);\\n\\nContext::has('key');\\n// true\\n\"}]}]\n44:[\"$\",\"a\",null,{\"name\":\"removing-context\"}]\n45:[\"$\",\"h2\",null,{\"id\":\"移除-context\",\"children\":[\"$\",\"a\",null,{\"href\":\"#移除-context\",\"children\":\"移除 Context\"}]}]\n46:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"forget\"}],\" 方法可用於從目前的 context 中移除 key 及其值：\"]}]\n47:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Illuminate\\\\Support\\\\Facades\\\\Context;\\n\\nContext::add(['first_key' =\u003e 1, 'second_key' =\u003e 2]);\\n\\nContext::forget('first_key');\\n\\nContext::all();\\n\\n// ['second_key' =\u003e 2]\\n\"}]}]\n48:[\"$\",\"p\",null,{\"children\":[\"您可以透過向 \",[\"$\",\"code\",null,{\"children\":\"forget\"}],\" 方法提供陣列來一次忘記多個 key：\"]}]\n49:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"Context::for"])</script><script>self.__next_f.push([1,"get(['first_key', 'second_key']);\\n\"}]}]\n4a:[\"$\",\"a\",null,{\"name\":\"hidden-context\"}]\n4b:[\"$\",\"h2\",null,{\"id\":\"隱藏的-context\",\"children\":[\"$\",\"a\",null,{\"href\":\"#隱藏的-context\",\"children\":\"隱藏的 Context\"}]}]\n4c:[\"$\",\"p\",null,{\"children\":\"Context 提供了儲存「隱藏」資料的功能。這些隱藏資訊不會附加到 logs，也無法透過上述記載的資料取回方法存取。Context 提供了一組不同的方法來與隱藏的 context 資訊互動：\"}]\n4d:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Illuminate\\\\Support\\\\Facades\\\\Context;\\n\\nContext::addHidden('key', 'value');\\n\\nContext::getHidden('key');\\n// 'value'\\n\\nContext::get('key');\\n// null\\n\"}]}]\n4e:[\"$\",\"p\",null,{\"children\":\"「隱藏」方法反映了上述記載的非隱藏方法的功能：\"}]\n4f:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"Context::addHidden(/* ... */);\\nContext::addHiddenIf(/* ... */);\\nContext::pushHidden(/* ... */);\\nContext::getHidden(/* ... */);\\nContext::pullHidden(/* ... */);\\nContext::popHidden(/* ... */);\\nContext::onlyHidden(/* ... */);\\nContext::exceptHidden(/* ... */);\\nContext::allHidden(/* ... */);\\nContext::hasHidden(/* ... */);\\nContext::missingHidden(/* ... */);\\nContext::forgetHidden(/* ... */);\\n\"}]}]\n50:[\"$\",\"a\",null,{\"name\":\"events\"}]\n51:[\"$\",\"h2\",null,{\"id\":\"events\",\"children\":[\"$\",\"a\",null,{\"href\":\"#events\",\"children\":\"Events\"}]}]\n52:[\"$\",\"p\",null,{\"children\":\"Context 會發送兩個 events，讓您可以掛鉤到 context 的 hydration 和 dehydration 過程。\"}]\n53:[\"$\",\"p\",null,{\"children\":[\"為了說明如何使用這些 events，假設在應用程式的 middleware 中，您根據傳入 HTTP request 的 \",[\"$\",\"code\",null,{\"children\":\"Accept-Language\"}],\" header 設定 \",[\"$\",\"code\",null,{\"children\":\"app.locale\"}],\" 設定值。Context 的 events 讓您可以在 request 期間擷取此值並在 queue 上還原它，確保在 queue 上發送的 notifications 具有正確的 \",[\"$\",\"code\",null,{\"children\":\"app.locale\"}],\" 值。我們可以使用 context 的 events 和\",[\"$\",\"a\",null,{\"href\":\"#hidden-context\",\"children\":\"隱藏\"}],\"資料來實現這一點，以下文件將說明這一點。\"]}]\n54:[\"$\",\"a\",null,{\"name\":\"dehydrating\"}]\n55:[\"$\",\"h3\",null,{\"id\":\"dehydrating\",\"children\":[\"$\",\"a\",null,{\"href\":\"#dehydrating\",\"children\":\"Dehydrating\"}]}]\n56:[\"$\",\"p\",null,{\"children\":[\"每當 job 被發送到 queue 時，context 中的資料會被「dehydrated」並與 job 的 payload 一起擷取。\",[\"$\",\"code\",null,{\"children\":\"Context::dehydrating\"}],\" 方法讓您可以註冊一個將在 dehydration 過程中呼叫的 closure。在此 closure 中，您可以對將與 queued job 共享的資料進行變更。\"]}]\n57:[\"$\",\"p\",null,{\"children\":[\"通常，您應該在應用程式的 \",[\"$\",\"code\",null,{\"children\":\"AppServiceProvider\"}],\" 類別的 \",[\"$\",\"code\",null,{\"children\":\"boot\"}],\" 方法中註冊 \",[\"$\",\"code\",null,{\"children\":\"dehydrating\"}],\" callbacks：\"]}]\n58:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Illuminate\\\\Log\\\\Context\\\\Repository;\\nuse Illuminate\\\\Support\\\\Facades\\\\Config;\\nuse Illuminate\\\\Support\\\\Facades\\\\Context;\\n\\n/**\\n * Bootstrap any application services.\\n */\\npublic function boot(): void\\n{\\n    Context::dehydrating(function (Repository $context) {\\n        $context-\u003eaddHidden('locale', Config::get('app.locale'));\\n    });\\n}\\n\"}]}]\n59:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!NOTE]\\n您不應該在 \",[\"$\",\"code\",null,{\"children\":\"dehydrating\"}],\" callback 中使用 \",[\"$\",\"code\",null,{\"children\":\"Context\"}],\" facade，因為這將改變目前 process 的 context。請確保您只對傳遞給 callback 的 repository 進行變更。\"]}],\"\\n\"]}]\n5a:[\"$\",\"a\",null,{\"name\":\"hydrated\"}]\n5b:[\"$\",\"h3\",null,{\"id\":\"hydrated\",\"children\":[\"$\",\"a\",null,{\"href\":\"#hydrated\",\"children\":\"Hydrated\"}]}]\n5c:[\"$\",\"p\",null,{\"children\":[\"每當 queued job 開始在 queue 上執行時，與 job 共享的任何 context 都將被「hydrat"])</script><script>self.__next_f.push([1,"ed」回到目前的 context 中。\",[\"$\",\"code\",null,{\"children\":\"Context::hydrated\"}],\" 方法讓您可以註冊一個將在 hydration 過程中呼叫的 closure。\"]}]\n5d:[\"$\",\"p\",null,{\"children\":[\"通常，您應該在應用程式的 \",[\"$\",\"code\",null,{\"children\":\"AppServiceProvider\"}],\" 類別的 \",[\"$\",\"code\",null,{\"children\":\"boot\"}],\" 方法中註冊 \",[\"$\",\"code\",null,{\"children\":\"hydrated\"}],\" callbacks：\"]}]\n5e:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Illuminate\\\\Log\\\\Context\\\\Repository;\\nuse Illuminate\\\\Support\\\\Facades\\\\Config;\\nuse Illuminate\\\\Support\\\\Facades\\\\Context;\\n\\n/**\\n * Bootstrap any application services.\\n */\\npublic function boot(): void\\n{\\n    Context::hydrated(function (Repository $context) {\\n        if ($context-\u003ehasHidden('locale')) {\\n            Config::set('app.locale', $context-\u003egetHidden('locale'));\\n        }\\n    });\\n}\\n\"}]}]\n5f:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!NOTE]\\n您不應該在 \",[\"$\",\"code\",null,{\"children\":\"hydrated\"}],\" callback 中使用 \",[\"$\",\"code\",null,{\"children\":\"Context\"}],\" facade，而是確保您只對傳遞給 callback 的 repository 進行變更。\"]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"60:I[27201,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"IconMark\"]\nc:[[\"$\",\"title\",\"0\",{\"children\":\"Create Next App\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Generated by create next app\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/favicon.ico?favicon.0b3bf435.ico\",\"sizes\":\"256x256\",\"type\":\"image/x-icon\"}],[\"$\",\"$L60\",\"3\",{}]]\n8:null\n"])</script></body></html>