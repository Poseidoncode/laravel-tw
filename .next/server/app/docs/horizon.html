<!DOCTYPE html><!--kE5s4wNidqhVn8fA906WC--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/797e433ab948586e-s.p.dbea232f.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/caa3a2e1cccd8315-s.p.853070df.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="https://laravel.com/img/docs/horizon-example.png" as="image"/><link rel="stylesheet" href="/_next/static/chunks/bc6e94e20a39014e.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/cbd55ab9639e1e66.js"/><script src="/_next/static/chunks/87a939617be2fa8c.js" async=""></script><script src="/_next/static/chunks/8368f298651cbd89.js" async=""></script><script src="/_next/static/chunks/6740f161f60c6ab5.js" async=""></script><script src="/_next/static/chunks/turbopack-929fc2ce3ca903db.js" async=""></script><script src="/_next/static/chunks/ff1a16fafef87110.js" async=""></script><script src="/_next/static/chunks/247eb132b7f7b574.js" async=""></script><script src="/_next/static/chunks/796e69ae18b2784c.js" async=""></script><script src="/_next/static/chunks/2b257daea29fbb42.js" async=""></script><meta name="next-size-adjust" content=""/><title>Create Next App</title><meta name="description" content="Generated by create next app"/><link rel="icon" href="/favicon.ico?favicon.0b3bf435.ico" sizes="256x256" type="image/x-icon"/><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="geist_a71539c9-module__T19VSG__variable geist_mono_8d43a2aa-module__8Li5zG__variable antialiased"><div hidden=""><!--$--><!--/$--></div><div class="flex min-h-screen bg-background"><div class="w-64 border-r bg-background h-screen sticky top-0 hidden md:block"><div class="p-6 font-bold text-xl border-b flex items-center gap-2"><span class="text-red-600">Laravel</span> Docs（中文）</div><div dir="ltr" data-slot="scroll-area" class="relative h-[calc(100vh-65px)]" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><div class="p-4 space-y-2"><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>前言</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down h-4 w-4" aria-hidden="true"><path d="m6 9 6 6 6-6"></path></svg></button><div class="ml-4 mt-1 space-y-1"><a class="block" href="/docs/releases"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">發行說明</button></a></div></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>入門</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down h-4 w-4" aria-hidden="true"><path d="m6 9 6 6 6-6"></path></svg></button><div class="ml-4 mt-1 space-y-1"><a class="block" href="/docs/installation"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">安裝</button></a><a class="block" href="/docs/configuration"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">配置</button></a><a class="block" href="/docs/structure"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">目錄結構</button></a><a class="block" href="/docs/lifecycle"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">生命週期</button></a><a class="block" href="/docs/frontend"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">前端</button></a><a class="block" href="/docs/starter-kits"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">啟動套件</button></a><a class="block" href="/docs/deployment"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">部署</button></a></div></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>架構</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>基礎功能</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>深入探討</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>安全性</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>資料庫</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>Eloquent ORM</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>測試</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>其他</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div><button class="w-full flex items-center justify-between px-4 py-2 text-sm font-semibold text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors"><span>官方套件</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-4 w-4" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg></button></div><div class="border-t pt-4 space-y-2"><a class="block" href="/docs/api"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">API 文件</button></a><a class="block" href="/docs/releases"><button data-slot="button" class="inline-flex items-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5 w-full justify-start font-normal text-sm">更新日誌</button></a></div></div></div></div></div></div><main class="flex-1 relative"><div class="container mx-auto py-10"><div class="mx-auto max-w-3xl"><div class="mb-8"><h1 class="scroll-m-20 text-4xl font-extrabold tracking-tight lg:text-5xl">Horizon</h1><p class="text-xl text-muted-foreground mt-2">Laravel Horizon 為 Laravel Redis 佇列提供了美觀的儀表板</p></div><article class="prose prose-slate dark:prose-invert max-w-none"><h1 id="laravel-horizon"><a href="#laravel-horizon">Laravel Horizon</a></h1>
<ul>
<li><a href="#introduction">簡介 (Introduction)</a></li>
<li><a href="#installation">安裝 (Installation)</a>
<ul>
<li><a href="#configuration">設定 (Configuration)</a></li>
<li><a href="#dashboard-authorization">儀表板授權 (Dashboard Authorization)</a></li>
<li><a href="#max-job-attempts">最大 Job 嘗試次數 (Max Job Attempts)</a></li>
<li><a href="#job-timeout">Job 超時 (Job Timeout)</a></li>
<li><a href="#job-backoff">Job Backoff</a></li>
<li><a href="#silenced-jobs">靜音 Job (Silenced Jobs)</a></li>
</ul>
</li>
<li><a href="#balancing-strategies">平衡策略 (Balancing Strategies)</a>
<ul>
<li><a href="#auto-balancing">自動平衡 (Auto Balancing)</a></li>
<li><a href="#simple-balancing">簡易平衡 (Simple Balancing)</a></li>
<li><a href="#no-balancing">無平衡 (No Balancing)</a></li>
</ul>
</li>
<li><a href="#upgrading-horizon">升級 Horizon (Upgrading Horizon)</a></li>
<li><a href="#running-horizon">執行 Horizon (Running Horizon)</a>
<ul>
<li><a href="#deploying-horizon">部署 Horizon (Deploying Horizon)</a></li>
</ul>
</li>
<li><a href="#tags">標籤 (Tags)</a></li>
<li><a href="#notifications">通知 (Notifications)</a></li>
<li><a href="#metrics">指標 (Metrics)</a></li>
<li><a href="#deleting-failed-jobs">刪除失敗的 Job (Deleting Failed Jobs)</a></li>
<li><a href="#clearing-jobs-from-queues">清除佇列中的 Job (Clearing Jobs From Queues)</a></li>
</ul>
<a name="introduction"></a>
<h2 id="簡介-introduction"><a href="#簡介-introduction">簡介 (Introduction)</a></h2>
<blockquote>
<p>[!NOTE]
在深入了解 Laravel Horizon 之前，你應該先熟悉 Laravel 的基礎 <a href="/docs/queues">佇列服務</a>。Horizon 為 Laravel 的佇列增加了額外的功能，如果你還不熟悉 Laravel 提供的基本佇列功能，可能會感到困惑。</p>
</blockquote>
<p><a href="https://github.com/laravel/horizon">Laravel Horizon</a> 為你的 Laravel <a href="/docs/queues">Redis 佇列</a> 提供了一個美觀的儀表板和程式碼驅動的設定。Horizon 讓你能夠輕鬆監控佇列系統的關鍵指標，例如 Job 吞吐量、執行時間和 Job 失敗情況。</p>
<p>使用 Horizon 時，你所有的佇列 Worker 設定都儲存在一個簡單的設定檔中。透過在版本控制的檔案中定義應用程式的 Worker 設定，你在部署應用程式時可以輕鬆擴展或修改應用程式的佇列 Worker。</p>
<img src="https://laravel.com/img/docs/horizon-example.png"/>
<a name="installation"></a>
<h2 id="安裝-installation"><a href="#安裝-installation">安裝 (Installation)</a></h2>
<blockquote>
<p>[!WARNING]
Laravel Horizon 要求你使用 <a href="https://redis.io">Redis</a> 來驅動你的佇列。因此，你應該確保應用程式的 <code>config/queue.php</code> 設定檔中的佇列連線設定為 <code>redis</code>。</p>
</blockquote>
<p>你可以使用 Composer 套件管理器將 Horizon 安裝到你的專案中：</p>
<pre><code class="language-shell">composer require laravel/horizon
</code></pre>
<p>安裝 Horizon 後，使用 <code>horizon:install</code> Artisan 指令發布其資源：</p>
<pre><code class="language-shell">php artisan horizon:install
</code></pre>
<a name="configuration"></a>
<h3 id="設定-configuration"><a href="#設定-configuration">設定 (Configuration)</a></h3>
<p>發布 Horizon 的資源後，其主要設定檔將位於 <code>config/horizon.php</code>。此設定檔允許你設定應用程式的佇列 Worker 選項。每個設定選項都包含其用途的說明，因此請務必仔細閱讀此檔案。</p>
<blockquote>
<p>[!WARNING]
Horizon 內部使用名為 <code>horizon</code> 的 Redis 連線。此 Redis 連線名稱是保留的，不應指派給 <code>database.php</code> 設定檔中的其他 Redis 連線，也不應作為 <code>horizon.php</code> 設定檔中 <code>use</code> 選項的值。</p>
</blockquote>
<a name="environments"></a>
<h4 id="環境-environments"><a href="#環境-environments">環境 (Environments)</a></h4>
<p>安裝後，你應該熟悉的主要 Horizon 設定選項是 <code>environments</code> 設定選項。此設定選項是一個陣列，包含你的應用程式執行的環境，並定義了每個環境的 Worker Process 選項。預設情況下，此項目包含 <code>production</code> 和 <code>local</code> 環境。但是，你可以根據需要自由添加更多環境：</p>
<pre><code class="language-php">&#x27;environments&#x27; =&gt; [
    &#x27;production&#x27; =&gt; [
        &#x27;supervisor-1&#x27; =&gt; [
            &#x27;maxProcesses&#x27; =&gt; 10,
            &#x27;balanceMaxShift&#x27; =&gt; 1,
            &#x27;balanceCooldown&#x27; =&gt; 3,
        ],
    ],

    &#x27;local&#x27; =&gt; [
        &#x27;supervisor-1&#x27; =&gt; [
            &#x27;maxProcesses&#x27; =&gt; 3,
        ],
    ],
],
</code></pre>
<p>你也可以定義一個萬用字元環境 (<code>*</code>)，當找不到其他相符的環境時將使用該環境：</p>
<pre><code class="language-php">&#x27;environments&#x27; =&gt; [
    // ...

    &#x27;*&#x27; =&gt; [
        &#x27;supervisor-1&#x27; =&gt; [
            &#x27;maxProcesses&#x27; =&gt; 3,
        ],
    ],
],
</code></pre>
<p>當你啟動 Horizon 時，它將使用你的應用程式目前執行環境的 Worker Process 設定選項。通常，環境由 <code>APP_ENV</code> <a href="/docs/configuration#determining-the-current-environment">環境變數</a> 的值決定。例如，預設的 <code>local</code> Horizon 環境設定為啟動三個 Worker Process，並自動平衡指派給每個佇列的 Worker Process 數量。預設的 <code>production</code> 環境設定為啟動最多 10 個 Worker Process，並自動平衡指派給每個佇列的 Worker Process 數量。</p>
<blockquote>
<p>[!WARNING]
你應該確保 <code>horizon</code> 設定檔的 <code>environments</code> 部分包含你計劃執行 Horizon 的每個 <a href="/docs/configuration#environment-configuration">環境</a> 的項目。</p>
</blockquote>
<a name="supervisors"></a>
<h4 id="supervisors"><a href="#supervisors">Supervisors</a></h4>
<p>正如你在 Horizon 的預設設定檔中看到的，每個環境可以包含一個或多個 &quot;supervisors&quot;。預設情況下，設定檔將此 supervisor 定義為 <code>supervisor-1</code>；但是，你可以自由地將你的 supervisors 命名為任何你想要的名稱。每個 supervisor 本質上負責 &quot;監督&quot; 一組 Worker Process，並負責跨佇列平衡 Worker Process。</p>
<p>如果你想定義一組應該在該環境中執行的新 Worker Process，你可以向給定的環境添加額外的 supervisors。如果你想為應用程式使用的給定佇列定義不同的平衡策略或 Worker Process 數量，你可以選擇這樣做。</p>
<a name="maintenance-mode"></a>
<h4 id="維護模式-maintenance-mode"><a href="#維護模式-maintenance-mode">維護模式 (Maintenance Mode)</a></h4>
<p>當你的應用程式處於 <a href="/docs/configuration#maintenance-mode">維護模式</a> 時，除非在 Horizon 設定檔中將 supervisor 的 <code>force</code> 選項定義為 <code>true</code>，否則 Horizon 不會處理佇列中的 Job：</p>
<pre><code class="language-php">&#x27;environments&#x27; =&gt; [
    &#x27;production&#x27; =&gt; [
        &#x27;supervisor-1&#x27; =&gt; [
            // ...
            &#x27;force&#x27; =&gt; true,
        ],
    ],
],
</code></pre>
<a name="default-values"></a>
<h4 id="預設值-default-values"><a href="#預設值-default-values">預設值 (Default Values)</a></h4>
<p>在 Horizon 的預設設定檔中，你會注意到一個 <code>defaults</code> 設定選項。此設定選項指定了應用程式 <a href="#supervisors">supervisors</a> 的預設值。Supervisor 的預設設定值將合併到每個環境的 supervisor 設定中，讓你在此定義 supervisors 時避免不必要的重複。</p>
<a name="dashboard-authorization"></a>
<h3 id="儀表板授權-dashboard-authorization"><a href="#儀表板授權-dashboard-authorization">儀表板授權 (Dashboard Authorization)</a></h3>
<p>Horizon 儀表板可以透過 <code>/horizon</code> 路由存取。預設情況下，你只能在 <code>local</code> 環境中存取此儀表板。但是，在你的 <code>app/Providers/HorizonServiceProvider.php</code> 檔案中，有一個 <a href="/docs/authorization#gates">授權 Gate</a> 定義。此授權 Gate 控制在 <strong>非本地</strong> 環境中對 Horizon 的存取。你可以根據需要自由修改此 Gate 以限制對 Horizon 安裝的存取：</p>
<pre><code class="language-php">/**
 * Register the Horizon gate.
 *
 * This gate determines who can access Horizon in non-local environments.
 */
protected function gate(): void
{
    Gate::define(&#x27;viewHorizon&#x27;, function (User $user) {
        return in_array($user-&gt;email, [
            &#x27;taylor@laravel.com&#x27;,
        ]);
    });
}
</code></pre>
<a name="alternative-authentication-strategies"></a>
<h4 id="替代身分驗證策略-alternative-authentication-strategies"><a href="#替代身分驗證策略-alternative-authentication-strategies">替代身分驗證策略 (Alternative Authentication Strategies)</a></h4>
<p>請記住，Laravel 會自動將經過身分驗證的使用者注入到 Gate Closure 中。如果你的應用程式透過其他方法（例如 IP 限制）提供 Horizon 安全性，那麼你的 Horizon 使用者可能不需要 &quot;登入&quot;。因此，你需要將上面的 <code>function (User $user)</code> Closure 簽名更改為 <code>function (User $user = null)</code>，以強制 Laravel 不要求身分驗證。</p>
<a name="max-job-attempts"></a>
<h3 id="最大-job-嘗試次數-max-job-attempts"><a href="#最大-job-嘗試次數-max-job-attempts">最大 Job 嘗試次數 (Max Job Attempts)</a></h3>
<blockquote>
<p>[!NOTE]
在調整這些選項之前，請確保你熟悉 Laravel 的預設 <a href="/docs/queues#max-job-attempts-and-timeout">佇列服務</a> 和 &#x27;attempts&#x27; 的概念。</p>
</blockquote>
<p>你可以在 supervisor 的設定中定義 Job 可以消耗的最大嘗試次數：</p>
<pre><code class="language-php">&#x27;environments&#x27; =&gt; [
    &#x27;production&#x27; =&gt; [
        &#x27;supervisor-1&#x27; =&gt; [
            // ...
            &#x27;tries&#x27; =&gt; 10,
        ],
    ],
],
</code></pre>
<blockquote>
<p>[!NOTE]
此選項類似於使用 Artisan 指令處理佇列時的 <code>--tries</code> 選項。</p>
</blockquote>
<p>當使用 <code>WithoutOverlapping</code> 或 <code>RateLimited</code> 等 Middleware 時，調整 <code>tries</code> 選項至關重要，因為它們會消耗嘗試次數。為了處理這個問題，請在 supervisor 層級調整 <code>tries</code> 設定值，或在 Job 類別上定義 <code>$tries</code> 屬性。</p>
<p>如果你沒有設定 <code>tries</code> 選項，Horizon 預設為單次嘗試，除非 Job 類別定義了 <code>$tries</code>，這將優先於 Horizon 設定。</p>
<p>將 <code>tries</code> 或 <code>$tries</code> 設定為 0 允許無限次嘗試，這在嘗試次數不確定時非常理想。為了防止無休止的失敗，你可以透過在 Job 類別上設定 <code>$maxExceptions</code> 屬性來限制允許的例外數量。</p>
<a name="job-timeout"></a>
<h3 id="job-超時-job-timeout"><a href="#job-超時-job-timeout">Job 超時 (Job Timeout)</a></h3>
<p>同樣地，你可以在 supervisor 層級設定 <code>timeout</code> 值，它指定 Worker Process 在強制終止 Job 之前可以執行多少秒。一旦終止，Job 將根據你的佇列設定被重試或標記為失敗：</p>
<pre><code class="language-php">&#x27;environments&#x27; =&gt; [
    &#x27;production&#x27; =&gt; [
        &#x27;supervisor-1&#x27; =&gt; [
            // ...¨
            &#x27;timeout&#x27; =&gt; 60,
        ],
    ],
],
</code></pre>
<blockquote>
<p>[!WARNING]
當使用 <code>auto</code> 平衡策略時，Horizon 會將執行中的 Worker 視為 &quot;掛起&quot;，並在縮減規模期間超過 Horizon 超時後強制終止它們。始終確保 Horizon 超時大於任何 Job 層級的超時，否則 Job 可能會在執行中途被終止。此外，<code>timeout</code> 值應始終比 <code>config/queue.php</code> 設定檔中定義的 <code>retry_after</code> 值短幾秒。否則，你的 Job 可能會被處理兩次。</p>
</blockquote>
<a name="job-backoff"></a>
<h3 id="job-backoff"><a href="#job-backoff">Job Backoff</a></h3>
<p>你可以在 supervisor 層級定義 <code>backoff</code> 值，以指定 Horizon 在重試遇到未處理例外的 Job 之前應等待多長時間：</p>
<pre><code class="language-php">&#x27;environments&#x27; =&gt; [
    &#x27;production&#x27; =&gt; [
        &#x27;supervisor-1&#x27; =&gt; [
            // ...
            &#x27;backoff&#x27; =&gt; 10,
        ],
    ],
],
</code></pre>
<p>你也可以透過為 <code>backoff</code> 值使用陣列來設定 &quot;指數&quot; backoffs。在此範例中，第一次重試的延遲將為 1 秒，第二次重試為 5 秒，第三次重試為 10 秒，如果還有剩餘嘗試次數，則後續每次重試均為 10 秒：</p>
<pre><code class="language-php">&#x27;environments&#x27; =&gt; [
    &#x27;production&#x27; =&gt; [
        &#x27;supervisor-1&#x27; =&gt; [
            // ...
            &#x27;backoff&#x27; =&gt; [1, 5, 10],
        ],
    ],
],
</code></pre>
<a name="silenced-jobs"></a>
<h3 id="靜音-job-silenced-jobs"><a href="#靜音-job-silenced-jobs">靜音 Job (Silenced Jobs)</a></h3>
<p>有時，你可能對檢視應用程式或第三方套件分派的某些 Job 不感興趣。你可以將這些 Job 靜音，而不是讓它們佔用 &quot;Completed Jobs&quot; 列表中的空間。要開始使用，請將 Job 的類別名稱添加到應用程式 <code>horizon</code> 設定檔中的 <code>silenced</code> 設定選項中：</p>
<pre><code class="language-php">&#x27;silenced&#x27; =&gt; [
    App\Jobs\ProcessPodcast::class,
],
</code></pre>
<p>除了靜音個別 Job 類別之外，Horizon 還支援基於 <a href="#tags">標籤</a> 靜音 Job。如果你想隱藏共用相同標籤的多個 Job，這會很有用：</p>
<pre><code class="language-php">&#x27;silenced_tags&#x27; =&gt; [
    &#x27;notifications&#x27;
],
</code></pre>
<p>或者，你希望靜音的 Job 可以實作 <code>Laravel\Horizon\Contracts\Silenced</code> 介面。如果 Job 實作了此介面，即使它不存在於 <code>silenced</code> 設定陣列中，也會自動被靜音：</p>
<pre><code class="language-php">use Laravel\Horizon\Contracts\Silenced;

class ProcessPodcast implements ShouldQueue, Silenced
{
    use Queueable;

    // ...
}
</code></pre>
<a name="balancing-strategies"></a>
<h2 id="平衡策略-balancing-strategies"><a href="#平衡策略-balancing-strategies">平衡策略 (Balancing Strategies)</a></h2>
<p>每個 supervisor 可以處理一個或多個佇列，但與 Laravel 的預設佇列系統不同，Horizon 允許你從三種 Worker 平衡策略中進行選擇：<code>auto</code>、<code>simple</code> 和 <code>false</code>。</p>
<a name="auto-balancing"></a>
<h3 id="自動平衡-auto-balancing"><a href="#自動平衡-auto-balancing">自動平衡 (Auto Balancing)</a></h3>
<p><code>auto</code> 策略是預設策略，它根據佇列目前的負載調整每個佇列的 Worker Process 數量。例如，如果你的 <code>notifications</code> 佇列有 1,000 個待處理 Job，而你的 <code>default</code> 佇列是空的，Horizon 將分配更多 Worker 到你的 <code>notifications</code> 佇列，直到佇列清空。</p>
<p>當使用 <code>auto</code> 策略時，你也可以設定 <code>minProcesses</code> 和 <code>maxProcesses</code> 設定選項：</p>
<div class="content-list" markdown="1"><ul>
<li><code>minProcesses</code> 定義每個佇列的最小 Worker Process 數量。此值必須大於或等於 1。</li>
<li><code>maxProcesses</code> 定義 Horizon 可以跨所有佇列擴展的最大總 Worker Process 數量。此值通常應大於佇列數量乘以 <code>minProcesses</code> 值。為了防止 supervisor 產生任何 Process，你可以將此值設定為 0。</li>
</ul></div>
<p>例如，你可以設定 Horizon 為每個佇列維持至少一個 Process，並擴展到總共 10 個 Worker Process：</p>
<pre><code class="language-php">&#x27;environments&#x27; =&gt; [
    &#x27;production&#x27; =&gt; [
        &#x27;supervisor-1&#x27; =&gt; [
            &#x27;connection&#x27; =&gt; &#x27;redis&#x27;,
            &#x27;queue&#x27; =&gt; [&#x27;default&#x27;, &#x27;notifications&#x27;],
            &#x27;balance&#x27; =&gt; &#x27;auto&#x27;,
            &#x27;autoScalingStrategy&#x27; =&gt; &#x27;time&#x27;,
            &#x27;minProcesses&#x27; =&gt; 1,
            &#x27;maxProcesses&#x27; =&gt; 10,
            &#x27;balanceMaxShift&#x27; =&gt; 1,
            &#x27;balanceCooldown&#x27; =&gt; 3,
        ],
    ],
],
</code></pre>
<p><code>autoScalingStrategy</code> 設定選項決定 Horizon 如何將更多 Worker Process 指派給佇列。你可以選擇兩種策略：</p>
<div class="content-list" markdown="1"><ul>
<li><code>time</code> 策略將根據清除佇列所需的總估計時間來指派 Worker。</li>
<li><code>size</code> 策略將根據佇列上的總 Job 數量來指派 Worker。</li>
</ul></div>
<p><code>balanceMaxShift</code> 和 <code>balanceCooldown</code> 設定值決定 Horizon 擴展以滿足 Worker 需求的速度。在上面的範例中，每三秒鐘最多建立或銷毀一個新 Process。你可以根據應用程式的需求自由調整這些值。</p>
<a name="auto-queue-priorities"></a>
<h4 id="佇列優先順序和自動平衡-queue-priorities-and-auto-balancing"><a href="#佇列優先順序和自動平衡-queue-priorities-and-auto-balancing">佇列優先順序和自動平衡 (Queue Priorities and Auto Balancing)</a></h4>
<p>當使用 <code>auto</code> 平衡策略時，Horizon 不會在佇列之間強制執行嚴格的優先順序。Supervisor 設定中佇列的順序不會影響 Worker Process 的指派方式。相反，Horizon 依賴選定的 <code>autoScalingStrategy</code> 根據佇列負載動態分配 Worker Process。</p>
<p>例如，在以下設定中，儘管 <code>high</code> 佇列在列表中排在第一位，但它並不比 <code>default</code> 佇列優先：</p>
<pre><code class="language-php">&#x27;environments&#x27; =&gt; [
    &#x27;production&#x27; =&gt; [
        &#x27;supervisor-1&#x27; =&gt; [
            // ...
            &#x27;queue&#x27; =&gt; [&#x27;high&#x27;, &#x27;default&#x27;],
            &#x27;minProcesses&#x27; =&gt; 1,
            &#x27;maxProcesses&#x27; =&gt; 10,
        ],
    ],
],
</code></pre>
<p>如果你需要在佇列之間強制執行相對優先順序，你可以定義多個 supervisors 並明確分配處理資源：</p>
<pre><code class="language-php">&#x27;environments&#x27; =&gt; [
    &#x27;production&#x27; =&gt; [
        &#x27;supervisor-1&#x27; =&gt; [
            // ...
            &#x27;queue&#x27; =&gt; [&#x27;default&#x27;],
            &#x27;minProcesses&#x27; =&gt; 1,
            &#x27;maxProcesses&#x27; =&gt; 10,
        ],
        &#x27;supervisor-2&#x27; =&gt; [
            // ...
            &#x27;queue&#x27; =&gt; [&#x27;images&#x27;],
            &#x27;minProcesses&#x27; =&gt; 1,
            &#x27;maxProcesses&#x27; =&gt; 1,
        ],
    ],
],
</code></pre>
<p>在此範例中，<code>default</code> 佇列可以擴展到 10 個 Process，而 <code>images</code> 佇列限制為一個 Process。此設定確保你的佇列可以獨立擴展。</p>
<blockquote>
<p>[!NOTE]
當分派資源密集型 Job 時，有時最好將它們指派給具有有限 <code>maxProcesses</code> 值的專用佇列。否則，這些 Job 可能會消耗過多的 CPU 資源並使你的系統過載。</p>
</blockquote>
<a name="simple-balancing"></a>
<h3 id="簡易平衡-simple-balancing"><a href="#簡易平衡-simple-balancing">簡易平衡 (Simple Balancing)</a></h3>
<p><code>simple</code> 策略將 Worker Process 平均分配到指定的佇列。使用此策略，Horizon 不會自動擴展 Worker Process 的數量。相反，它使用固定數量的 Process：</p>
<pre><code class="language-php">&#x27;environments&#x27; =&gt; [
    &#x27;production&#x27; =&gt; [
        &#x27;supervisor-1&#x27; =&gt; [
            // ...
            &#x27;queue&#x27; =&gt; [&#x27;default&#x27;, &#x27;notifications&#x27;],
            &#x27;balance&#x27; =&gt; &#x27;simple&#x27;,
            &#x27;processes&#x27; =&gt; 10,
        ],
    ],
],
</code></pre>
<p>在上面的範例中，Horizon 將為每個佇列指派 5 個 Process，將總共 10 個 Process 平均分配。</p>
<p>如果你想控制指派給每個佇列的 Worker Process 數量，你可以定義多個 supervisors：</p>
<pre><code class="language-php">&#x27;environments&#x27; =&gt; [
    &#x27;production&#x27; =&gt; [
        &#x27;supervisor-1&#x27; =&gt; [
            // ...
            &#x27;queue&#x27; =&gt; [&#x27;default&#x27;],
            &#x27;balance&#x27; =&gt; &#x27;simple&#x27;,
            &#x27;processes&#x27; =&gt; 10,
        ],
        &#x27;supervisor-notifications&#x27; =&gt; [
            // ...
            &#x27;queue&#x27; =&gt; [&#x27;notifications&#x27;],
            &#x27;balance&#x27; =&gt; &#x27;simple&#x27;,
            &#x27;processes&#x27; =&gt; 2,
        ],
    ],
],
</code></pre>
<p>透過此設定，Horizon 將指派 10 個 Process 給 <code>default</code> 佇列，並指派 2 個 Process 給 <code>notifications</code> 佇列。</p>
<a name="no-balancing"></a>
<h3 id="無平衡-no-balancing"><a href="#無平衡-no-balancing">無平衡 (No Balancing)</a></h3>
<p>當 <code>balance</code> 選項設定為 <code>false</code> 時，Horizon 嚴格按照列出的順序處理佇列，類似於 Laravel 的預設佇列系統。但是，如果 Job 開始累積，它仍然會擴展 Worker Process 的數量：</p>
<pre><code class="language-php">&#x27;environments&#x27; =&gt; [
    &#x27;production&#x27; =&gt; [
        &#x27;supervisor-1&#x27; =&gt; [
            // ...
            &#x27;queue&#x27; =&gt; [&#x27;default&#x27;, &#x27;notifications&#x27;],
            &#x27;balance&#x27; =&gt; false,
            &#x27;minProcesses&#x27; =&gt; 1,
            &#x27;maxProcesses&#x27; =&gt; 10,
        ],
    ],
],
</code></pre>
<p>在上面的範例中，<code>default</code> 佇列中的 Job 總是優先於 <code>notifications</code> 佇列中的 Job。例如，如果 <code>default</code> 中有 1,000 個 Job，而 <code>notifications</code> 中只有 10 個，Horizon 將在處理 <code>notifications</code> 中的任何 Job 之前完全處理所有 <code>default</code> Job。</p>
<p>你可以使用 <code>minProcesses</code> 和 <code>maxProcesses</code> 選項控制 Horizon 擴展 Worker Process 的能力：</p>
<div class="content-list" markdown="1"><ul>
<li><code>minProcesses</code> 定義總共的最小 Worker Process 數量。此值必須大於或等於 1。</li>
<li><code>maxProcesses</code> 定義 Horizon 可以擴展到的最大總 Worker Process 數量。</li>
</ul></div>
<a name="upgrading-horizon"></a>
<h2 id="升級-horizon-upgrading-horizon"><a href="#升級-horizon-upgrading-horizon">升級 Horizon (Upgrading Horizon)</a></h2>
<p>當升級到 Horizon 的新主要版本時，請務必仔細閱讀 <a href="https://github.com/laravel/horizon/blob/master/UPGRADE.md">升級指南</a>。</p>
<a name="running-horizon"></a>
<h2 id="執行-horizon-running-horizon"><a href="#執行-horizon-running-horizon">執行 Horizon (Running Horizon)</a></h2>
<p>一旦你在應用程式的 <code>config/horizon.php</code> 設定檔中設定了 supervisors 和 workers，你就可以使用 <code>horizon</code> Artisan 指令啟動 Horizon。這個單一指令將啟動目前環境的所有已設定 Worker Process：</p>
<pre><code class="language-shell">php artisan horizon
</code></pre>
<p>你可以使用 <code>horizon:pause</code> 和 <code>horizon:continue</code> Artisan 指令暫停 Horizon Process 並指示其繼續處理 Job：</p>
<pre><code class="language-shell">php artisan horizon:pause

php artisan horizon:continue
</code></pre>
<p>你也可以使用 <code>horizon:pause-supervisor</code> 和 <code>horizon:continue-supervisor</code> Artisan 指令暫停和繼續特定的 Horizon <a href="#supervisors">supervisors</a>：</p>
<pre><code class="language-shell">php artisan horizon:pause-supervisor supervisor-1

php artisan horizon:continue-supervisor supervisor-1
</code></pre>
<p>你可以使用 <code>horizon:status</code> Artisan 指令檢查 Horizon Process 的目前狀態：</p>
<pre><code class="language-shell">php artisan horizon:status
</code></pre>
<p>你可以使用 <code>horizon:supervisor-status</code> Artisan 指令檢查特定 Horizon <a href="#supervisors">supervisor</a> 的目前狀態：</p>
<pre><code class="language-shell">php artisan horizon:supervisor-status supervisor-1
</code></pre>
<p>你可以使用 <code>horizon:terminate</code> Artisan 指令優雅地終止 Horizon Process。任何目前正在處理的 Job 都將完成，然後 Horizon 將停止執行：</p>
<pre><code class="language-shell">php artisan horizon:terminate
</code></pre>
<a name="deploying-horizon"></a>
<h3 id="部署-horizon-deploying-horizon"><a href="#部署-horizon-deploying-horizon">部署 Horizon (Deploying Horizon)</a></h3>
<p>當你準備好將 Horizon 部署到應用程式的實際伺服器時，你應該設定一個 Process 監視器來監視 <code>php artisan horizon</code> 指令，並在其意外退出時重新啟動它。別擔心，我們將在下面討論如何安裝 Process 監視器。</p>
<p>在應用程式的部署過程中，你應該指示 Horizon Process 終止，以便 Process 監視器重新啟動它並接收你的程式碼變更：</p>
<pre><code class="language-shell">php artisan horizon:terminate
</code></pre>
<a name="installing-supervisor"></a>
<h4 id="安裝-supervisor-installing-supervisor"><a href="#安裝-supervisor-installing-supervisor">安裝 Supervisor (Installing Supervisor)</a></h4>
<p>Supervisor 是 Linux 作業系統的 Process 監視器，如果 <code>horizon</code> Process 停止執行，它將自動重新啟動該 Process。要在 Ubuntu 上安裝 Supervisor，你可以使用以下指令。如果你不使用 Ubuntu，你可能可以使用作業系統的套件管理器安裝 Supervisor：</p>
<pre><code class="language-shell">sudo apt-get install supervisor
</code></pre>
<blockquote>
<p>[!NOTE]
如果自行設定 Supervisor 聽起來很麻煩，請考慮使用 <a href="https://cloud.laravel.com">Laravel Cloud</a>，它可以管理 Laravel 應用程式的背景 Process。</p>
</blockquote>
<a name="supervisor-configuration"></a>
<h4 id="supervisor-設定-supervisor-configuration"><a href="#supervisor-設定-supervisor-configuration">Supervisor 設定 (Supervisor Configuration)</a></h4>
<p>Supervisor 設定檔通常儲存在伺服器的 <code>/etc/supervisor/conf.d</code> 目錄中。在此目錄中，你可以建立任意數量的設定檔，指示 Supervisor 應如何監視你的 Process。例如，讓我們建立一個 <code>horizon.conf</code> 檔案，該檔案啟動並監視 <code>horizon</code> Process：</p>
<pre><code class="language-ini">[program:horizon]
process_name=%(program_name)s
command=php /home/forge/example.com/artisan horizon
autostart=true
autorestart=true
user=forge
redirect_stderr=true
stdout_logfile=/home/forge/example.com/horizon.log
stopwaitsecs=3600
</code></pre>
<p>定義 Supervisor 設定時，你應該確保 <code>stopwaitsecs</code> 的值大於最長執行 Job 所消耗的秒數。否則，Supervisor 可能會在 Job 完成處理之前將其殺死。</p>
<blockquote>
<p>[!WARNING]
雖然上面的範例適用於基於 Ubuntu 的伺服器，但 Supervisor 設定檔預期的位置和副檔名可能因其他伺服器作業系統而異。請參閱你的伺服器文件以獲取更多資訊。</p>
</blockquote>
<a name="starting-supervisor"></a>
<h4 id="啟動-supervisor-starting-supervisor"><a href="#啟動-supervisor-starting-supervisor">啟動 Supervisor (Starting Supervisor)</a></h4>
<p>建立設定檔後，你可以使用以下指令更新 Supervisor 設定並啟動受監視的 Process：</p>
<pre><code class="language-shell">sudo supervisorctl reread

sudo supervisorctl update

sudo supervisorctl start horizon
</code></pre>
<blockquote>
<p>[!NOTE]
有關執行 Supervisor 的更多資訊，請參閱 <a href="http://supervisord.org/index.html">Supervisor 文件</a>。</p>
</blockquote>
<a name="tags"></a>
<h2 id="標籤-tags"><a href="#標籤-tags">標籤 (Tags)</a></h2>
<p>Horizon 允許你將 &quot;tags&quot; 指派給 Job，包括 mailables、廣播事件、通知和佇列事件監聽器。事實上，Horizon 會根據附加到 Job 的 Eloquent 模型，智慧地自動標記大多數 Job。例如，看看下面的 Job：</p>
<pre><code class="language-php">&lt;?php

namespace App\Jobs;

use App\Models\Video;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Foundation\Queue\Queueable;

class RenderVideo implements ShouldQueue
{
    use Queueable;

    /**
     * Create a new job instance.
     */
    public function __construct(
        public Video $video,
    ) {}

    /**
     * Execute the job.
     */
    public function handle(): void
    {
        // ...
    }
}
</code></pre>
<p>如果此 Job 與具有 <code>id</code> 屬性為 <code>1</code> 的 <code>App\Models\Video</code> 實例一起排入佇列，它將自動接收標籤 <code>App\Models\Video:1</code>。這是因為 Horizon 會搜尋 Job 的屬性以尋找任何 Eloquent 模型。如果找到 Eloquent 模型，Horizon 將使用模型的類別名稱和主鍵智慧地標記 Job：</p>
<pre><code class="language-php">use App\Jobs\RenderVideo;
use App\Models\Video;

$video = Video::find(1);

RenderVideo::dispatch($video);
</code></pre>
<a name="manually-tagging-jobs"></a>
<h4 id="手動標記-job-manually-tagging-jobs"><a href="#手動標記-job-manually-tagging-jobs">手動標記 Job (Manually Tagging Jobs)</a></h4>
<p>如果你想手動定義其中一個可排入佇列物件的標籤，你可以在類別上定義一個 <code>tags</code> 方法：</p>
<pre><code class="language-php">class RenderVideo implements ShouldQueue
{
    /**
     * Get the tags that should be assigned to the job.
     *
     * @return array&lt;int, string&gt;
     */
    public function tags(): array
    {
        return [&#x27;render&#x27;, &#x27;video:&#x27;.$this-&gt;video-&gt;id];
    }
}
</code></pre>
<a name="manually-tagging-event-listeners"></a>
<h4 id="手動標記事件監聽器-manually-tagging-event-listeners"><a href="#手動標記事件監聽器-manually-tagging-event-listeners">手動標記事件監聽器 (Manually Tagging Event Listeners)</a></h4>
<p>當檢索佇列事件監聽器的標籤時，Horizon 會自動將事件實例傳遞給 <code>tags</code> 方法，讓你將事件資料添加到標籤中：</p>
<pre><code class="language-php">class SendRenderNotifications implements ShouldQueue
{
    /**
     * Get the tags that should be assigned to the listener.
     *
     * @return array&lt;int, string&gt;
     */
    public function tags(VideoRendered $event): array
    {
        return [&#x27;video:&#x27;.$event-&gt;video-&gt;id];
    }
}
</code></pre>
<a name="notifications"></a>
<h2 id="通知-notifications"><a href="#通知-notifications">通知 (Notifications)</a></h2>
<blockquote>
<p>[!WARNING]
當設定 Horizon 發送 Slack 或 SMS 通知時，你應該查看 <a href="/docs/notifications">相關通知頻道的先決條件</a>。</p>
</blockquote>
<p>如果你想在其中一個佇列有很長的等待時間時收到通知，你可以使用 <code>Horizon::routeMailNotificationsTo</code>、<code>Horizon::routeSlackNotificationsTo</code> 和 <code>Horizon::routeSmsNotificationsTo</code> 方法。你可以從應用程式的 <code>App\Providers\HorizonServiceProvider</code> 的 <code>boot</code> 方法呼叫這些方法：</p>
<pre><code class="language-php">/**
 * Bootstrap any application services.
 */
public function boot(): void
{
    parent::boot();

    Horizon::routeSmsNotificationsTo(&#x27;15556667777&#x27;);
    Horizon::routeMailNotificationsTo(&#x27;example@example.com&#x27;);
    Horizon::routeSlackNotificationsTo(&#x27;slack-webhook-url&#x27;, &#x27;#channel&#x27;);
}
</code></pre>
<a name="configuring-notification-wait-time-thresholds"></a>
<h4 id="設定通知等待時間閾值-configuring-notification-wait-time-thresholds"><a href="#設定通知等待時間閾值-configuring-notification-wait-time-thresholds">設定通知等待時間閾值 (Configuring Notification Wait Time Thresholds)</a></h4>
<p>你可以在應用程式的 <code>config/horizon.php</code> 設定檔中設定多少秒被視為 &quot;長時間等待&quot;。此檔案中的 <code>waits</code> 設定選項允許你控制每個連線 / 佇列組合的長時間等待閾值。任何未定義的連線 / 佇列組合將預設為 60 秒的長時間等待閾值：</p>
<pre><code class="language-php">&#x27;waits&#x27; =&gt; [
    &#x27;redis:critical&#x27; =&gt; 30,
    &#x27;redis:default&#x27; =&gt; 60,
    &#x27;redis:batch&#x27; =&gt; 120,
],
</code></pre>
<p>將佇列的閾值設定為 <code>0</code> 將停用該佇列的長時間等待通知。</p>
<a name="metrics"></a>
<h2 id="指標-metrics"><a href="#指標-metrics">指標 (Metrics)</a></h2>
<p>Horizon 包含一個指標儀表板，提供有關 Job 和佇列等待時間及吞吐量的資訊。為了填充此儀表板，你應該在應用程式的 <code>routes/console.php</code> 檔案中設定 Horizon 的 <code>snapshot</code> Artisan 指令每五分鐘執行一次：</p>
<pre><code class="language-php">use Illuminate\Support\Facades\Schedule;

Schedule::command(&#x27;horizon:snapshot&#x27;)-&gt;everyFiveMinutes();
</code></pre>
<p>如果你想刪除所有指標資料，你可以呼叫 <code>horizon:clear-metrics</code> Artisan 指令：</p>
<pre><code class="language-shell">php artisan horizon:clear-metrics
</code></pre>
<a name="deleting-failed-jobs"></a>
<h2 id="刪除失敗的-job-deleting-failed-jobs"><a href="#刪除失敗的-job-deleting-failed-jobs">刪除失敗的 Job (Deleting Failed Jobs)</a></h2>
<p>如果你想刪除失敗的 Job，你可以使用 <code>horizon:forget</code> 指令。<code>horizon:forget</code> 指令接受失敗 Job 的 ID 或 UUID 作為其唯一參數：</p>
<pre><code class="language-shell">php artisan horizon:forget 5
</code></pre>
<p>如果你想刪除所有失敗的 Job，你可以向 <code>horizon:forget</code> 指令提供 <code>--all</code> 選項：</p>
<pre><code class="language-shell">php artisan horizon:forget --all
</code></pre>
<a name="clearing-jobs-from-queues"></a>
<h2 id="清除佇列中的-job-clearing-jobs-from-queues"><a href="#清除佇列中的-job-clearing-jobs-from-queues">清除佇列中的 Job (Clearing Jobs From Queues)</a></h2>
<p>如果你想刪除應用程式預設佇列中的所有 Job，你可以使用 <code>horizon:clear</code> Artisan 指令：</p>
<pre><code class="language-shell">php artisan horizon:clear
</code></pre>
<p>你可以提供 <code>queue</code> 選項來刪除特定佇列中的 Job：</p>
<pre><code class="language-shell">php artisan horizon:clear --queue=emails
</code></pre></article></div></div><!--$--><!--/$--></main></div><script src="/_next/static/chunks/cbd55ab9639e1e66.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[39756,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"default\"]\n3:I[37457,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"default\"]\n4:I[93649,[\"/_next/static/chunks/796e69ae18b2784c.js\",\"/_next/static/chunks/2b257daea29fbb42.js\"],\"DocsSidebar\"]\n6:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"OutletBoundary\"]\n7:\"$Sreact.suspense\"\n9:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"ViewportBoundary\"]\nb:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"MetadataBoundary\"]\nd:I[68027,[],\"default\"]\n:HL[\"/_next/static/chunks/bc6e94e20a39014e.css\",\"style\"]\n:HL[\"/_next/static/media/797e433ab948586e-s.p.dbea232f.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/caa3a2e1cccd8315-s.p.853070df.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"kE5s4wNidqhVn8fA906WC\",\"c\":[\"\",\"docs\",\"horizon\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[[\"slug\",\"horizon\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/bc6e94e20a39014e.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"geist_a71539c9-module__T19VSG__variable geist_mono_8d43a2aa-module__8Li5zG__variable antialiased\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/796e69ae18b2784c.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/_next/static/chunks/2b257daea29fbb42.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"div\",null,{\"className\":\"flex min-h-screen bg-background\",\"children\":[[\"$\",\"$L4\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-1 relative\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@8\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L9\",null,{\"children\":\"$@a\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$Lb\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.Metadata\",\"children\":\"$@c\"}]}]}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,":HL[\"https://laravel.com/img/docs/horizon-example.png\",\"image\"]\n"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"className\":\"container mx-auto py-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-3xl\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"scroll-m-20 text-4xl font-extrabold tracking-tight lg:text-5xl\",\"children\":\"Horizon\"}],[\"$\",\"p\",null,{\"className\":\"text-xl text-muted-foreground mt-2\",\"children\":\"Laravel Horizon 為 Laravel Redis 佇列提供了美觀的儀表板\"}]]}],[\"$\",\"article\",null,{\"className\":\"prose prose-slate dark:prose-invert max-w-none\",\"children\":[[\"$\",\"h1\",null,{\"id\":\"laravel-horizon\",\"children\":[\"$\",\"a\",null,{\"href\":\"#laravel-horizon\",\"children\":\"Laravel Horizon\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#introduction\",\"children\":\"簡介 (Introduction)\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"#installation\",\"children\":\"安裝 (Installation)\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#configuration\",\"children\":\"設定 (Configuration)\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#dashboard-authorization\",\"children\":\"儀表板授權 (Dashboard Authorization)\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#max-job-attempts\",\"children\":\"最大 Job 嘗試次數 (Max Job Attempts)\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#job-timeout\",\"children\":\"Job 超時 (Job Timeout)\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#job-backoff\",\"children\":\"Job Backoff\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#silenced-jobs\",\"children\":\"靜音 Job (Silenced Jobs)\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"#balancing-strategies\",\"children\":\"平衡策略 (Balancing Strategies)\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#auto-balancing\",\"children\":\"自動平衡 (Auto Balancing)\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#simple-balancing\",\"children\":\"簡易平衡 (Simple Balancing)\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#no-balancing\",\"children\":\"無平衡 (No Balancing)\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#upgrading-horizon\",\"children\":\"升級 Horizon (Upgrading Horizon)\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"#running-horizon\",\"children\":\"執行 Horizon (Running Horizon)\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#deploying-horizon\",\"children\":\"部署 Horizon (Deploying Horizon)\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#tags\",\"children\":\"標籤 (Tags)\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#notifications\",\"children\":\"通知 (Notifications)\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#metrics\",\"children\":\"指標 (Metrics)\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#deleting-failed-jobs\",\"children\":\"刪除失敗的 Job (Deleting Failed Jobs)\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#clearing-jobs-from-queues\",\"children\":\"清除佇列中的 Job (Clearing Jobs From Queues)\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"a\",null,{\"name\":\"introduction\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"簡介-introduction\",\"children\":[\"$\",\"a\",null,{\"href\":\"#簡介-introduction\",\"children\":\"簡介 (Introduction)\"}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!NOTE]\\n在深入了解 Laravel Horizon 之前，你應該先熟悉 Laravel 的基礎 \",[\"$\",\"a\",null,{\"href\":\"/docs/queues\",\"children\":\"佇列服務\"}],\"。Horizon 為 Laravel 的佇列增加了額外的功能，如果你還不熟悉 Laravel 提供的基本佇列功能，可能會感到困惑。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"https://github.com/laravel/horizon\",\"children\":\"Laravel Horizon\"}],\" 為你的 Laravel \",[\"$\",\"a\",null,{\"href\":\"/docs/queues\",\"children\":\"Redis 佇列\"}],\" 提供了一個美觀的儀表板和程式碼驅動的設定。Horizon 讓你能夠輕鬆監控佇列系統的關鍵指標，例如 Job 吞吐量、執行時間和 Job 失敗情況。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"使用 Horizon 時，你所有的佇列 Worker 設定都儲存在一個簡單的設定檔中。透過在版本控制的檔案中定義應用程式的 Worker 設定，你在部署應用程式時可以輕鬆擴展或修改應用程式的佇列 Worker。\"}],\"\\n\",[\"$\",\"img\",null,{\"src\":\"https://laravel.com/img/docs/horizon-example.png\"}],\"\\n\",[\"$\",\"a\",null,{\"name\":\"installation\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"安裝-installation\",\"children\":[\"$\",\"a\",null,{\"href\":\"#安裝-installation\",\"children\":\"安裝 (Installation)\"}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!WARNING]\\nLaravel Horizon 要求你使用 \",[\"$\",\"a\",null,{\"href\":\"https://redis.io\",\"children\":\"Redis\"}],\" 來驅動你的佇列。因此，你應該確保應用程式的 \",[\"$\",\"code\",null,{\"children\":\"config/queue.php\"}],\" 設定檔中的佇列連線設定為 \",[\"$\",\"code\",null,{\"children\":\"redis\"}],\"。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"你可以使用 Composer 套件管理器將 Horizon 安裝到你的專案中：\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"composer require laravel/horizon\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"安裝 Horizon 後，使用 \",\"$Le\",\" Artisan 指令發布其資源：\"]}],\"\\n\",\"$Lf\",\"\\n\",\"$L10\",\"\\n\",\"$L11\",\"\\n\",\"$L12\",\"\\n\",\"$L13\",\"\\n\",\"$L14\",\"\\n\",\"$L15\",\"\\n\",\"$L16\",\"\\n\",\"$L17\",\"\\n\",\"$L18\",\"\\n\",\"$L19\",\"\\n\",\"$L1a\",\"\\n\",\"$L1b\",\"\\n\",\"$L1c\",\"\\n\",\"$L1d\",\"\\n\",\"$L1e\",\"\\n\",\"$L1f\",\"\\n\",\"$L20\",\"\\n\",\"$L21\",\"\\n\",\"$L22\",\"\\n\",\"$L23\",\"\\n\",\"$L24\",\"\\n\",\"$L25\",\"\\n\",\"$L26\",\"\\n\",\"$L27\",\"\\n\",\"$L28\",\"\\n\",\"$L29\",\"\\n\",\"$L2a\",\"\\n\",\"$L2b\",\"\\n\",\"$L2c\",\"\\n\",\"$L2d\",\"\\n\",\"$L2e\",\"\\n\",\"$L2f\",\"\\n\",\"$L30\",\"\\n\",\"$L31\",\"\\n\",\"$L32\",\"\\n\",\"$L33\",\"\\n\",\"$L34\",\"\\n\",\"$L35\",\"\\n\",\"$L36\",\"\\n\",\"$L37\",\"\\n\",\"$L38\",\"\\n\",\"$L39\",\"\\n\",\"$L3a\",\"\\n\",\"$L3b\",\"\\n\",\"$L3c\",\"\\n\",\"$L3d\",\"\\n\",\"$L3e\",\"\\n\",\"$L3f\",\"\\n\",\"$L40\",\"\\n\",\"$L41\",\"\\n\",\"$L42\",\"\\n\",\"$L43\",\"\\n\",\"$L44\",\"\\n\",\"$L45\",\"\\n\",\"$L46\",\"\\n\",\"$L47\",\"\\n\",\"$L48\",\"\\n\",\"$L49\",\"\\n\",\"$L4a\",\"\\n\",\"$L4b\",\"\\n\",\"$L4c\",\"\\n\",\"$L4d\",\"\\n\",\"$L4e\",\"\\n\",\"$L4f\",\"\\n\",\"$L50\",\"\\n\",\"$L51\",\"\\n\",\"$L52\",\"\\n\",\"$L53\",\"\\n\",\"$L54\",\"\\n\",\"$L55\",\"\\n\",\"$L56\",\"\\n\",\"$L57\",\"\\n\",\"$L58\",\"\\n\",\"$L59\",\"\\n\",\"$L5a\",\"\\n\",\"$L5b\",\"\\n\",\"$L5c\",\"\\n\",\"$L5d\",\"\\n\",\"$L5e\",\"\\n\",\"$L5f\",\"\\n\",\"$L60\",\"\\n\",\"$L61\",\"\\n\",\"$L62\",\"\\n\",\"$L63\",\"\\n\",\"$L64\",\"\\n\",\"$L65\",\"\\n\",\"$L66\",\"\\n\",\"$L67\",\"\\n\",\"$L68\",\"\\n\",\"$L69\",\"\\n\",\"$L6a\",\"\\n\",\"$L6b\",\"\\n\",\"$L6c\",\"\\n\",\"$L6d\",\"\\n\",\"$L6e\",\"\\n\",\"$L6f\",\"\\n\",\"$L70\",\"\\n\",\"$L71\",\"\\n\",\"$L72\",\"\\n\",\"$L73\",\"\\n\",\"$L74\",\"\\n\",\"$L75\",\"\\n\",\"$L76\",\"\\n\",\"$L77\",\"\\n\",\"$L78\",\"\\n\",\"$L79\",\"\\n\",\"$L7a\",\"\\n\",\"$L7b\",\"\\n\",\"$L7c\",\"\\n\",\"$L7d\",\"\\n\",\"$L7e\",\"\\n\",\"$L7f\",\"\\n\",\"$L80\",\"\\n\",\"$L81\",\"\\n\",\"$L82\",\"\\n\",\"$L83\",\"\\n\",\"$L84\",\"\\n\",\"$L85\",\"\\n\",\"$L86\",\"\\n\",\"$L87\",\"\\n\",\"$L88\",\"\\n\",\"$L89\",\"\\n\",\"$L8a\",\"\\n\",\"$L8b\",\"\\n\",\"$L8c\",\"\\n\",\"$L8d\",\"\\n\",\"$L8e\",\"\\n\",\"$L8f\",\"\\n\",\"$L90\",\"\\n\",\"$L91\",\"\\n\",\"$L92\",\"\\n\",\"$L93\",\"\\n\",\"$L94\",\"\\n\",\"$L95\",\"\\n\",\"$L96\",\"\\n\",\"$L97\",\"\\n\",\"$L98\",\"\\n\",\"$L99\",\"\\n\",\"$L9a\",\"\\n\",\"$L9b\",\"\\n\",\"$L9c\",\"\\n\",\"$L9d\",\"\\n\",\"$L9e\",\"\\n\",\"$L9f\",\"\\n\",\"$La0\",\"\\n\",\"$La1\",\"\\n\",\"$La2\",\"\\n\",\"$La3\",\"\\n\",\"$La4\",\"\\n\",\"$La5\",\"\\n\",\"$La6\",\"\\n\",\"$La7\",\"\\n\",\"$La8\",\"\\n\",\"$La9\",\"\\n\",\"$Laa\",\"\\n\",\"$Lab\",\"\\n\",\"$Lac\",\"\\n\",\"$Lad\",\"\\n\",\"$Lae\",\"\\n\",\"$Laf\",\"\\n\",\"$Lb0\",\"\\n\",\"$Lb1\",\"\\n\",\"$Lb2\",\"\\n\",\"$Lb3\",\"\\n\",\"$Lb4\",\"\\n\",\"$Lb5\",\"\\n\",\"$Lb6\",\"\\n\",\"$Lb7\",\"\\n\",\"$Lb8\",\"\\n\",\"$Lb9\",\"\\n\",\"$Lba\",\"\\n\",\"$Lbb\",\"\\n\",\"$Lbc\",\"\\n\",\"$Lbd\",\"\\n\",\"$Lbe\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"e:[\"$\",\"code\",null,{\"children\":\"horizon:install\"}]\nf:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"php artisan horizon:install\\n\"}]}]\n10:[\"$\",\"a\",null,{\"name\":\"configuration\"}]\n11:[\"$\",\"h3\",null,{\"id\":\"設定-configuration\",\"children\":[\"$\",\"a\",null,{\"href\":\"#設定-configuration\",\"children\":\"設定 (Configuration)\"}]}]\n12:[\"$\",\"p\",null,{\"children\":[\"發布 Horizon 的資源後，其主要設定檔將位於 \",[\"$\",\"code\",null,{\"children\":\"config/horizon.php\"}],\"。此設定檔允許你設定應用程式的佇列 Worker 選項。每個設定選項都包含其用途的說明，因此請務必仔細閱讀此檔案。\"]}]\n13:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!WARNING]\\nHorizon 內部使用名為 \",[\"$\",\"code\",null,{\"children\":\"horizon\"}],\" 的 Redis 連線。此 Redis 連線名稱是保留的，不應指派給 \",[\"$\",\"code\",null,{\"children\":\"database.php\"}],\" 設定檔中的其他 Redis 連線，也不應作為 \",[\"$\",\"code\",null,{\"children\":\"horizon.php\"}],\" 設定檔中 \",[\"$\",\"code\",null,{\"children\":\"use\"}],\" 選項的值。\"]}],\"\\n\"]}]\n14:[\"$\",\"a\",null,{\"name\":\"environments\"}]\n15:[\"$\",\"h4\",null,{\"id\":\"環境-environments\",\"children\":[\"$\",\"a\",null,{\"href\":\"#環境-environments\",\"children\":\"環境 (Environments)\"}]}]\n16:[\"$\",\"p\",null,{\"children\":[\"安裝後，你應該熟悉的主要 Horizon 設定選項是 \",[\"$\",\"code\",null,{\"children\":\"environments\"}],\" 設定選項。此設定選項是一個陣列，包含你的應用程式執行的環境，並定義了每個環境的 Worker Process 選項。預設情況下，此項目包含 \",[\"$\",\"code\",null,{\"children\":\"production\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"local\"}],\" 環境。但是，你可以根據需要自由添加更多環境：\"]}]\n17:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"'environments' =\u003e [\\n    'production' =\u003e [\\n        'supervisor-1' =\u003e [\\n            'maxProcesses' =\u003e 10,\\n            'balanceMaxShift' =\u003e 1,\\n            'balanceCooldown' =\u003e 3,\\n        ],\\n    ],\\n\\n    'local' =\u003e [\\n        'supervisor-1' =\u003e [\\n            'maxProcesses' =\u003e 3,\\n        ],\\n    ],\\n],\\n\"}]}]\n18:[\"$\",\"p\",null,{\"children\":[\"你也可以定義一個萬用字元環境 (\",[\"$\",\"code\",null,{\"children\":\"*\"}],\")，當找不到其他相符的環境時將使用該環境：\"]}]\n19:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"'environments' =\u003e [\\n    // ...\\n\\n    '*' =\u003e [\\n        'supervisor-1' =\u003e [\\n            'maxProcesses' =\u003e 3,\\n        ],\\n    ],\\n],\\n\"}]}]\n1a:[\"$\",\"p\",null,{\"children\":[\"當你啟動 Horizon 時，它將使用你的應用程式目前執行環境的 Worker Process 設定選項。通常，環境由 \",[\"$\",\"code\",null,{\"children\":\"APP_ENV\"}],\" \",[\"$\",\"a\",null,{\"href\":\"/docs/configuration#determining-the-current-environment\",\"children\":\"環境變數\"}],\" 的值決定。例如，預設的 \",[\"$\",\"code\",null,{\"children\":\"local\"}],\" Horizon 環境設定為啟動三個 Worker Process，並自動平衡指派給每個佇列的 Worker Process 數量。預設的 \",[\"$\",\"code\",null,{\"children\":\"production\"}],\" 環境設定為啟動最多 10 個 Worker Process，並自動平衡指派給每個佇列的 Worker Process 數量。\"]}]\n1b:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!WARNING]\\n你應該確保 \",[\"$\",\"code\",null,{\"children\":\"horizon\"}],\" 設定檔的 \",[\"$\",\"code\",null,{\"children\":\"environments\"}],\" 部分包含你計劃執行 Horizon 的每個 \",[\"$\",\"a\",null,{\"href\":\"/docs/configuration#environment-configuration\",\"children\":\"環境\"}],\" 的項目。\"]}],\"\\n\"]}]\n1c:[\"$\",\"a\",null,{\"name\":\"supervisors\"}]\n1d:[\"$\",\"h4\",null,{\"id\":\"supervisors\",\"children\":[\"$\",\"a\",null,{\"href\":\"#supervisors\",\"children\":\"Supervisors\"}]}]\n1e:[\"$\",\"p\",null,{\"children\":[\"正如你在 Horizon 的預設設定檔中看到的，每個環境可以包含一個或多個 \\\"supervisors\\\"。預設情況下，設定檔將此 supervisor 定義為 \",[\"$\",\"code\",null,{\"children\":\"supervisor-1\"}],\"；但是，你可以"])</script><script>self.__next_f.push([1,"自由地將你的 supervisors 命名為任何你想要的名稱。每個 supervisor 本質上負責 \\\"監督\\\" 一組 Worker Process，並負責跨佇列平衡 Worker Process。\"]}]\n1f:[\"$\",\"p\",null,{\"children\":\"如果你想定義一組應該在該環境中執行的新 Worker Process，你可以向給定的環境添加額外的 supervisors。如果你想為應用程式使用的給定佇列定義不同的平衡策略或 Worker Process 數量，你可以選擇這樣做。\"}]\n20:[\"$\",\"a\",null,{\"name\":\"maintenance-mode\"}]\n21:[\"$\",\"h4\",null,{\"id\":\"維護模式-maintenance-mode\",\"children\":[\"$\",\"a\",null,{\"href\":\"#維護模式-maintenance-mode\",\"children\":\"維護模式 (Maintenance Mode)\"}]}]\n22:[\"$\",\"p\",null,{\"children\":[\"當你的應用程式處於 \",[\"$\",\"a\",null,{\"href\":\"/docs/configuration#maintenance-mode\",\"children\":\"維護模式\"}],\" 時，除非在 Horizon 設定檔中將 supervisor 的 \",[\"$\",\"code\",null,{\"children\":\"force\"}],\" 選項定義為 \",[\"$\",\"code\",null,{\"children\":\"true\"}],\"，否則 Horizon 不會處理佇列中的 Job：\"]}]\n23:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"'environments' =\u003e [\\n    'production' =\u003e [\\n        'supervisor-1' =\u003e [\\n            // ...\\n            'force' =\u003e true,\\n        ],\\n    ],\\n],\\n\"}]}]\n24:[\"$\",\"a\",null,{\"name\":\"default-values\"}]\n25:[\"$\",\"h4\",null,{\"id\":\"預設值-default-values\",\"children\":[\"$\",\"a\",null,{\"href\":\"#預設值-default-values\",\"children\":\"預設值 (Default Values)\"}]}]\n26:[\"$\",\"p\",null,{\"children\":[\"在 Horizon 的預設設定檔中，你會注意到一個 \",[\"$\",\"code\",null,{\"children\":\"defaults\"}],\" 設定選項。此設定選項指定了應用程式 \",[\"$\",\"a\",null,{\"href\":\"#supervisors\",\"children\":\"supervisors\"}],\" 的預設值。Supervisor 的預設設定值將合併到每個環境的 supervisor 設定中，讓你在此定義 supervisors 時避免不必要的重複。\"]}]\n27:[\"$\",\"a\",null,{\"name\":\"dashboard-authorization\"}]\n28:[\"$\",\"h3\",null,{\"id\":\"儀表板授權-dashboard-authorization\",\"children\":[\"$\",\"a\",null,{\"href\":\"#儀表板授權-dashboard-authorization\",\"children\":\"儀表板授權 (Dashboard Authorization)\"}]}]\n29:[\"$\",\"p\",null,{\"children\":[\"Horizon 儀表板可以透過 \",[\"$\",\"code\",null,{\"children\":\"/horizon\"}],\" 路由存取。預設情況下，你只能在 \",[\"$\",\"code\",null,{\"children\":\"local\"}],\" 環境中存取此儀表板。但是，在你的 \",[\"$\",\"code\",null,{\"children\":\"app/Providers/HorizonServiceProvider.php\"}],\" 檔案中，有一個 \",[\"$\",\"a\",null,{\"href\":\"/docs/authorization#gates\",\"children\":\"授權 Gate\"}],\" 定義。此授權 Gate 控制在 \",[\"$\",\"strong\",null,{\"children\":\"非本地\"}],\" 環境中對 Horizon 的存取。你可以根據需要自由修改此 Gate 以限制對 Horizon 安裝的存取：\"]}]\n2a:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"/**\\n * Register the Horizon gate.\\n *\\n * This gate determines who can access Horizon in non-local environments.\\n */\\nprotected function gate(): void\\n{\\n    Gate::define('viewHorizon', function (User $user) {\\n        return in_array($user-\u003eemail, [\\n            'taylor@laravel.com',\\n        ]);\\n    });\\n}\\n\"}]}]\n2b:[\"$\",\"a\",null,{\"name\":\"alternative-authentication-strategies\"}]\n2c:[\"$\",\"h4\",null,{\"id\":\"替代身分驗證策略-alternative-authentication-strategies\",\"children\":[\"$\",\"a\",null,{\"href\":\"#替代身分驗證策略-alternative-authentication-strategies\",\"children\":\"替代身分驗證策略 (Alternative Authentication Strategies)\"}]}]\n2d:[\"$\",\"p\",null,{\"children\":[\"請記住，Laravel 會自動將經過身分驗證的使用者注入到 Gate Closure 中。如果你的應用程式透過其他方法（例如 IP 限制）提供 Horizon 安全性，那麼你的 Horizon 使用者可能不需要 \\\"登入\\\"。因此，你需要將上面的 \",[\"$\",\"code\",null,{\"children\":\"function (User $user)\"}],\" Closure 簽名更改為 \",[\"$\",\"code\",null,{\"children\":\"function (User $user = null)\"}],\"，以強制 Laravel 不要求身分驗證。\"]}]\n2e:[\"$\",\"a\",null,{\"name\":\"max-job-attempts\"}]\n2f:[\"$\","])</script><script>self.__next_f.push([1,"\"h3\",null,{\"id\":\"最大-job-嘗試次數-max-job-attempts\",\"children\":[\"$\",\"a\",null,{\"href\":\"#最大-job-嘗試次數-max-job-attempts\",\"children\":\"最大 Job 嘗試次數 (Max Job Attempts)\"}]}]\n30:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!NOTE]\\n在調整這些選項之前，請確保你熟悉 Laravel 的預設 \",[\"$\",\"a\",null,{\"href\":\"/docs/queues#max-job-attempts-and-timeout\",\"children\":\"佇列服務\"}],\" 和 'attempts' 的概念。\"]}],\"\\n\"]}]\n31:[\"$\",\"p\",null,{\"children\":\"你可以在 supervisor 的設定中定義 Job 可以消耗的最大嘗試次數：\"}]\n32:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"'environments' =\u003e [\\n    'production' =\u003e [\\n        'supervisor-1' =\u003e [\\n            // ...\\n            'tries' =\u003e 10,\\n        ],\\n    ],\\n],\\n\"}]}]\n33:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!NOTE]\\n此選項類似於使用 Artisan 指令處理佇列時的 \",[\"$\",\"code\",null,{\"children\":\"--tries\"}],\" 選項。\"]}],\"\\n\"]}]\n34:[\"$\",\"p\",null,{\"children\":[\"當使用 \",[\"$\",\"code\",null,{\"children\":\"WithoutOverlapping\"}],\" 或 \",[\"$\",\"code\",null,{\"children\":\"RateLimited\"}],\" 等 Middleware 時，調整 \",[\"$\",\"code\",null,{\"children\":\"tries\"}],\" 選項至關重要，因為它們會消耗嘗試次數。為了處理這個問題，請在 supervisor 層級調整 \",[\"$\",\"code\",null,{\"children\":\"tries\"}],\" 設定值，或在 Job 類別上定義 \",[\"$\",\"code\",null,{\"children\":\"$$tries\"}],\" 屬性。\"]}]\n35:[\"$\",\"p\",null,{\"children\":[\"如果你沒有設定 \",[\"$\",\"code\",null,{\"children\":\"tries\"}],\" 選項，Horizon 預設為單次嘗試，除非 Job 類別定義了 \",[\"$\",\"code\",null,{\"children\":\"$$tries\"}],\"，這將優先於 Horizon 設定。\"]}]\n36:[\"$\",\"p\",null,{\"children\":[\"將 \",[\"$\",\"code\",null,{\"children\":\"tries\"}],\" 或 \",[\"$\",\"code\",null,{\"children\":\"$$tries\"}],\" 設定為 0 允許無限次嘗試，這在嘗試次數不確定時非常理想。為了防止無休止的失敗，你可以透過在 Job 類別上設定 \",[\"$\",\"code\",null,{\"children\":\"$$maxExceptions\"}],\" 屬性來限制允許的例外數量。\"]}]\n37:[\"$\",\"a\",null,{\"name\":\"job-timeout\"}]\n38:[\"$\",\"h3\",null,{\"id\":\"job-超時-job-timeout\",\"children\":[\"$\",\"a\",null,{\"href\":\"#job-超時-job-timeout\",\"children\":\"Job 超時 (Job Timeout)\"}]}]\n39:[\"$\",\"p\",null,{\"children\":[\"同樣地，你可以在 supervisor 層級設定 \",[\"$\",\"code\",null,{\"children\":\"timeout\"}],\" 值，它指定 Worker Process 在強制終止 Job 之前可以執行多少秒。一旦終止，Job 將根據你的佇列設定被重試或標記為失敗：\"]}]\n3a:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"'environments' =\u003e [\\n    'production' =\u003e [\\n        'supervisor-1' =\u003e [\\n            // ...¨\\n            'timeout' =\u003e 60,\\n        ],\\n    ],\\n],\\n\"}]}]\n3b:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!WARNING]\\n當使用 \",[\"$\",\"code\",null,{\"children\":\"auto\"}],\" 平衡策略時，Horizon 會將執行中的 Worker 視為 \\\"掛起\\\"，並在縮減規模期間超過 Horizon 超時後強制終止它們。始終確保 Horizon 超時大於任何 Job 層級的超時，否則 Job 可能會在執行中途被終止。此外，\",[\"$\",\"code\",null,{\"children\":\"timeout\"}],\" 值應始終比 \",[\"$\",\"code\",null,{\"children\":\"config/queue.php\"}],\" 設定檔中定義的 \",[\"$\",\"code\",null,{\"children\":\"retry_after\"}],\" 值短幾秒。否則，你的 Job 可能會被處理兩次。\"]}],\"\\n\"]}]\n3c:[\"$\",\"a\",null,{\"name\":\"job-backoff\"}]\n3d:[\"$\",\"h3\",null,{\"id\":\"job-backoff\",\"children\":[\"$\",\"a\",null,{\"href\":\"#job-backoff\",\"children\":\"Job Backoff\"}]}]\n3e:[\"$\",\"p\",null,{\"children\":[\"你可以在 supervisor 層級定義 \",[\"$\",\"code\",null,{\"children\":\"backoff\"}],\" 值，以指定 Horizon 在重試遇到未處理例外的 Job 之前應等待多長時間：\"]}]\n3f:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"'environments' =\u003e [\\n    'production' =\u003e [\\n        'supervisor-1' =\u003e [\\n            // ...\\n            'backoff' =\u003e "])</script><script>self.__next_f.push([1,"10,\\n        ],\\n    ],\\n],\\n\"}]}]\n40:[\"$\",\"p\",null,{\"children\":[\"你也可以透過為 \",[\"$\",\"code\",null,{\"children\":\"backoff\"}],\" 值使用陣列來設定 \\\"指數\\\" backoffs。在此範例中，第一次重試的延遲將為 1 秒，第二次重試為 5 秒，第三次重試為 10 秒，如果還有剩餘嘗試次數，則後續每次重試均為 10 秒：\"]}]\n41:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"'environments' =\u003e [\\n    'production' =\u003e [\\n        'supervisor-1' =\u003e [\\n            // ...\\n            'backoff' =\u003e [1, 5, 10],\\n        ],\\n    ],\\n],\\n\"}]}]\n42:[\"$\",\"a\",null,{\"name\":\"silenced-jobs\"}]\n43:[\"$\",\"h3\",null,{\"id\":\"靜音-job-silenced-jobs\",\"children\":[\"$\",\"a\",null,{\"href\":\"#靜音-job-silenced-jobs\",\"children\":\"靜音 Job (Silenced Jobs)\"}]}]\n44:[\"$\",\"p\",null,{\"children\":[\"有時，你可能對檢視應用程式或第三方套件分派的某些 Job 不感興趣。你可以將這些 Job 靜音，而不是讓它們佔用 \\\"Completed Jobs\\\" 列表中的空間。要開始使用，請將 Job 的類別名稱添加到應用程式 \",[\"$\",\"code\",null,{\"children\":\"horizon\"}],\" 設定檔中的 \",[\"$\",\"code\",null,{\"children\":\"silenced\"}],\" 設定選項中：\"]}]\n45:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"'silenced' =\u003e [\\n    App\\\\Jobs\\\\ProcessPodcast::class,\\n],\\n\"}]}]\n46:[\"$\",\"p\",null,{\"children\":[\"除了靜音個別 Job 類別之外，Horizon 還支援基於 \",[\"$\",\"a\",null,{\"href\":\"#tags\",\"children\":\"標籤\"}],\" 靜音 Job。如果你想隱藏共用相同標籤的多個 Job，這會很有用：\"]}]\n47:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"'silenced_tags' =\u003e [\\n    'notifications'\\n],\\n\"}]}]\n48:[\"$\",\"p\",null,{\"children\":[\"或者，你希望靜音的 Job 可以實作 \",[\"$\",\"code\",null,{\"children\":\"Laravel\\\\Horizon\\\\Contracts\\\\Silenced\"}],\" 介面。如果 Job 實作了此介面，即使它不存在於 \",[\"$\",\"code\",null,{\"children\":\"silenced\"}],\" 設定陣列中，也會自動被靜音：\"]}]\n49:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Laravel\\\\Horizon\\\\Contracts\\\\Silenced;\\n\\nclass ProcessPodcast implements ShouldQueue, Silenced\\n{\\n    use Queueable;\\n\\n    // ...\\n}\\n\"}]}]\n4a:[\"$\",\"a\",null,{\"name\":\"balancing-strategies\"}]\n4b:[\"$\",\"h2\",null,{\"id\":\"平衡策略-balancing-strategies\",\"children\":[\"$\",\"a\",null,{\"href\":\"#平衡策略-balancing-strategies\",\"children\":\"平衡策略 (Balancing Strategies)\"}]}]\n4c:[\"$\",\"p\",null,{\"children\":[\"每個 supervisor 可以處理一個或多個佇列，但與 Laravel 的預設佇列系統不同，Horizon 允許你從三種 Worker 平衡策略中進行選擇：\",[\"$\",\"code\",null,{\"children\":\"auto\"}],\"、\",[\"$\",\"code\",null,{\"children\":\"simple\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"false\"}],\"。\"]}]\n4d:[\"$\",\"a\",null,{\"name\":\"auto-balancing\"}]\n4e:[\"$\",\"h3\",null,{\"id\":\"自動平衡-auto-balancing\",\"children\":[\"$\",\"a\",null,{\"href\":\"#自動平衡-auto-balancing\",\"children\":\"自動平衡 (Auto Balancing)\"}]}]\n4f:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"auto\"}],\" 策略是預設策略，它根據佇列目前的負載調整每個佇列的 Worker Process 數量。例如，如果你的 \",[\"$\",\"code\",null,{\"children\":\"notifications\"}],\" 佇列有 1,000 個待處理 Job，而你的 \",[\"$\",\"code\",null,{\"children\":\"default\"}],\" 佇列是空的，Horizon 將分配更多 Worker 到你的 \",[\"$\",\"code\",null,{\"children\":\"notifications\"}],\" 佇列，直到佇列清空。\"]}]\n50:[\"$\",\"p\",null,{\"children\":[\"當使用 \",[\"$\",\"code\",null,{\"children\":\"auto\"}],\" 策略時，你也可以設定 \",[\"$\",\"code\",null,{\"children\":\"minProcesses\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"maxProcesses\"}],\" 設定選項：\"]}]\n51:[\"$\",\"div\",null,{\"className\":\"content-list\",\"markdown\":\"1\",\"children\":[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"minProcesses\"}],\" 定義每個佇列的最小 Worker Process 數量。此值必須大於或等於 1。\"]}],\"\\n\",[\"$\",\"li\",null,{\"chil"])</script><script>self.__next_f.push([1,"dren\":[[\"$\",\"code\",null,{\"children\":\"maxProcesses\"}],\" 定義 Horizon 可以跨所有佇列擴展的最大總 Worker Process 數量。此值通常應大於佇列數量乘以 \",[\"$\",\"code\",null,{\"children\":\"minProcesses\"}],\" 值。為了防止 supervisor 產生任何 Process，你可以將此值設定為 0。\"]}],\"\\n\"]}]}]\n52:[\"$\",\"p\",null,{\"children\":\"例如，你可以設定 Horizon 為每個佇列維持至少一個 Process，並擴展到總共 10 個 Worker Process：\"}]\n53:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"'environments' =\u003e [\\n    'production' =\u003e [\\n        'supervisor-1' =\u003e [\\n            'connection' =\u003e 'redis',\\n            'queue' =\u003e ['default', 'notifications'],\\n            'balance' =\u003e 'auto',\\n            'autoScalingStrategy' =\u003e 'time',\\n            'minProcesses' =\u003e 1,\\n            'maxProcesses' =\u003e 10,\\n            'balanceMaxShift' =\u003e 1,\\n            'balanceCooldown' =\u003e 3,\\n        ],\\n    ],\\n],\\n\"}]}]\n54:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"autoScalingStrategy\"}],\" 設定選項決定 Horizon 如何將更多 Worker Process 指派給佇列。你可以選擇兩種策略：\"]}]\n55:[\"$\",\"div\",null,{\"className\":\"content-list\",\"markdown\":\"1\",\"children\":[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"time\"}],\" 策略將根據清除佇列所需的總估計時間來指派 Worker。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"size\"}],\" 策略將根據佇列上的總 Job 數量來指派 Worker。\"]}],\"\\n\"]}]}]\n56:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"balanceMaxShift\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"balanceCooldown\"}],\" 設定值決定 Horizon 擴展以滿足 Worker 需求的速度。在上面的範例中，每三秒鐘最多建立或銷毀一個新 Process。你可以根據應用程式的需求自由調整這些值。\"]}]\n57:[\"$\",\"a\",null,{\"name\":\"auto-queue-priorities\"}]\n58:[\"$\",\"h4\",null,{\"id\":\"佇列優先順序和自動平衡-queue-priorities-and-auto-balancing\",\"children\":[\"$\",\"a\",null,{\"href\":\"#佇列優先順序和自動平衡-queue-priorities-and-auto-balancing\",\"children\":\"佇列優先順序和自動平衡 (Queue Priorities and Auto Balancing)\"}]}]\n59:[\"$\",\"p\",null,{\"children\":[\"當使用 \",[\"$\",\"code\",null,{\"children\":\"auto\"}],\" 平衡策略時，Horizon 不會在佇列之間強制執行嚴格的優先順序。Supervisor 設定中佇列的順序不會影響 Worker Process 的指派方式。相反，Horizon 依賴選定的 \",[\"$\",\"code\",null,{\"children\":\"autoScalingStrategy\"}],\" 根據佇列負載動態分配 Worker Process。\"]}]\n5a:[\"$\",\"p\",null,{\"children\":[\"例如，在以下設定中，儘管 \",[\"$\",\"code\",null,{\"children\":\"high\"}],\" 佇列在列表中排在第一位，但它並不比 \",[\"$\",\"code\",null,{\"children\":\"default\"}],\" 佇列優先：\"]}]\n5b:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"'environments' =\u003e [\\n    'production' =\u003e [\\n        'supervisor-1' =\u003e [\\n            // ...\\n            'queue' =\u003e ['high', 'default'],\\n            'minProcesses' =\u003e 1,\\n            'maxProcesses' =\u003e 10,\\n        ],\\n    ],\\n],\\n\"}]}]\n5c:[\"$\",\"p\",null,{\"children\":\"如果你需要在佇列之間強制執行相對優先順序，你可以定義多個 supervisors 並明確分配處理資源：\"}]\n5d:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"'environments' =\u003e [\\n    'production' =\u003e [\\n        'supervisor-1' =\u003e [\\n            // ...\\n            'queue' =\u003e ['default'],\\n            'minProcesses' =\u003e 1,\\n            'maxProcesses' =\u003e 10,\\n        ],\\n        'supervisor-2' =\u003e [\\n            // ...\\n            'queue' =\u003e ['images'],\\n            'minProcesses' =\u003e 1,\\n            'maxProcesses' =\u003e 1,\\n        ],\\n    ],\\n],\\n\"}]}]\n5e:[\"$\",\"p\",null,{\"children\":[\"在此範例中，\",[\"$\",\"code\",null,{\"children\":\"default\"}],\" 佇列可以擴展到 10 個 Process，而 \",[\"$\",\"code\",null,{\"children\":\"images\"}],\" 佇列限制為一個 Process。此設定確保你的佇列可以"])</script><script>self.__next_f.push([1,"獨立擴展。\"]}]\n5f:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!NOTE]\\n當分派資源密集型 Job 時，有時最好將它們指派給具有有限 \",[\"$\",\"code\",null,{\"children\":\"maxProcesses\"}],\" 值的專用佇列。否則，這些 Job 可能會消耗過多的 CPU 資源並使你的系統過載。\"]}],\"\\n\"]}]\n60:[\"$\",\"a\",null,{\"name\":\"simple-balancing\"}]\n61:[\"$\",\"h3\",null,{\"id\":\"簡易平衡-simple-balancing\",\"children\":[\"$\",\"a\",null,{\"href\":\"#簡易平衡-simple-balancing\",\"children\":\"簡易平衡 (Simple Balancing)\"}]}]\n62:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"simple\"}],\" 策略將 Worker Process 平均分配到指定的佇列。使用此策略，Horizon 不會自動擴展 Worker Process 的數量。相反，它使用固定數量的 Process：\"]}]\n63:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"'environments' =\u003e [\\n    'production' =\u003e [\\n        'supervisor-1' =\u003e [\\n            // ...\\n            'queue' =\u003e ['default', 'notifications'],\\n            'balance' =\u003e 'simple',\\n            'processes' =\u003e 10,\\n        ],\\n    ],\\n],\\n\"}]}]\n64:[\"$\",\"p\",null,{\"children\":\"在上面的範例中，Horizon 將為每個佇列指派 5 個 Process，將總共 10 個 Process 平均分配。\"}]\n65:[\"$\",\"p\",null,{\"children\":\"如果你想控制指派給每個佇列的 Worker Process 數量，你可以定義多個 supervisors：\"}]\n66:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"'environments' =\u003e [\\n    'production' =\u003e [\\n        'supervisor-1' =\u003e [\\n            // ...\\n            'queue' =\u003e ['default'],\\n            'balance' =\u003e 'simple',\\n            'processes' =\u003e 10,\\n        ],\\n        'supervisor-notifications' =\u003e [\\n            // ...\\n            'queue' =\u003e ['notifications'],\\n            'balance' =\u003e 'simple',\\n            'processes' =\u003e 2,\\n        ],\\n    ],\\n],\\n\"}]}]\n67:[\"$\",\"p\",null,{\"children\":[\"透過此設定，Horizon 將指派 10 個 Process 給 \",[\"$\",\"code\",null,{\"children\":\"default\"}],\" 佇列，並指派 2 個 Process 給 \",[\"$\",\"code\",null,{\"children\":\"notifications\"}],\" 佇列。\"]}]\n68:[\"$\",\"a\",null,{\"name\":\"no-balancing\"}]\n69:[\"$\",\"h3\",null,{\"id\":\"無平衡-no-balancing\",\"children\":[\"$\",\"a\",null,{\"href\":\"#無平衡-no-balancing\",\"children\":\"無平衡 (No Balancing)\"}]}]\n6a:[\"$\",\"p\",null,{\"children\":[\"當 \",[\"$\",\"code\",null,{\"children\":\"balance\"}],\" 選項設定為 \",[\"$\",\"code\",null,{\"children\":\"false\"}],\" 時，Horizon 嚴格按照列出的順序處理佇列，類似於 Laravel 的預設佇列系統。但是，如果 Job 開始累積，它仍然會擴展 Worker Process 的數量：\"]}]\n6b:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"'environments' =\u003e [\\n    'production' =\u003e [\\n        'supervisor-1' =\u003e [\\n            // ...\\n            'queue' =\u003e ['default', 'notifications'],\\n            'balance' =\u003e false,\\n            'minProcesses' =\u003e 1,\\n            'maxProcesses' =\u003e 10,\\n        ],\\n    ],\\n],\\n\"}]}]\n6c:[\"$\",\"p\",null,{\"children\":[\"在上面的範例中，\",[\"$\",\"code\",null,{\"children\":\"default\"}],\" 佇列中的 Job 總是優先於 \",[\"$\",\"code\",null,{\"children\":\"notifications\"}],\" 佇列中的 Job。例如，如果 \",[\"$\",\"code\",null,{\"children\":\"default\"}],\" 中有 1,000 個 Job，而 \",[\"$\",\"code\",null,{\"children\":\"notifications\"}],\" 中只有 10 個，Horizon 將在處理 \",[\"$\",\"code\",null,{\"children\":\"notifications\"}],\" 中的任何 Job 之前完全處理所有 \",[\"$\",\"code\",null,{\"children\":\"default\"}],\" Job。\"]}]\n6d:[\"$\",\"p\",null,{\"children\":[\"你可以使用 \",[\"$\",\"code\",null,{\"children\":\"minProcesses\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"maxProcesses\"}],\" 選項控制 Horizon 擴展 Worker Process 的能力：\"]}]\n6e:[\"$\",\"div\",null,{\"className\":\"content-list\",\"markdown\":\"1\",\"children\":[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"minProcesses\"}],\" 定義總共的最小 Worker Process 數量。此值必須大於或等於 1。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\","])</script><script>self.__next_f.push([1,"null,{\"children\":\"maxProcesses\"}],\" 定義 Horizon 可以擴展到的最大總 Worker Process 數量。\"]}],\"\\n\"]}]}]\n6f:[\"$\",\"a\",null,{\"name\":\"upgrading-horizon\"}]\n70:[\"$\",\"h2\",null,{\"id\":\"升級-horizon-upgrading-horizon\",\"children\":[\"$\",\"a\",null,{\"href\":\"#升級-horizon-upgrading-horizon\",\"children\":\"升級 Horizon (Upgrading Horizon)\"}]}]\n71:[\"$\",\"p\",null,{\"children\":[\"當升級到 Horizon 的新主要版本時，請務必仔細閱讀 \",[\"$\",\"a\",null,{\"href\":\"https://github.com/laravel/horizon/blob/master/UPGRADE.md\",\"children\":\"升級指南\"}],\"。\"]}]\n72:[\"$\",\"a\",null,{\"name\":\"running-horizon\"}]\n73:[\"$\",\"h2\",null,{\"id\":\"執行-horizon-running-horizon\",\"children\":[\"$\",\"a\",null,{\"href\":\"#執行-horizon-running-horizon\",\"children\":\"執行 Horizon (Running Horizon)\"}]}]\n74:[\"$\",\"p\",null,{\"children\":[\"一旦你在應用程式的 \",[\"$\",\"code\",null,{\"children\":\"config/horizon.php\"}],\" 設定檔中設定了 supervisors 和 workers，你就可以使用 \",[\"$\",\"code\",null,{\"children\":\"horizon\"}],\" Artisan 指令啟動 Horizon。這個單一指令將啟動目前環境的所有已設定 Worker Process：\"]}]\n75:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"php artisan horizon\\n\"}]}]\n76:[\"$\",\"p\",null,{\"children\":[\"你可以使用 \",[\"$\",\"code\",null,{\"children\":\"horizon:pause\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"horizon:continue\"}],\" Artisan 指令暫停 Horizon Process 並指示其繼續處理 Job：\"]}]\n77:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"php artisan horizon:pause\\n\\nphp artisan horizon:continue\\n\"}]}]\n78:[\"$\",\"p\",null,{\"children\":[\"你也可以使用 \",[\"$\",\"code\",null,{\"children\":\"horizon:pause-supervisor\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"horizon:continue-supervisor\"}],\" Artisan 指令暫停和繼續特定的 Horizon \",[\"$\",\"a\",null,{\"href\":\"#supervisors\",\"children\":\"supervisors\"}],\"：\"]}]\n79:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"php artisan horizon:pause-supervisor supervisor-1\\n\\nphp artisan horizon:continue-supervisor supervisor-1\\n\"}]}]\n7a:[\"$\",\"p\",null,{\"children\":[\"你可以使用 \",[\"$\",\"code\",null,{\"children\":\"horizon:status\"}],\" Artisan 指令檢查 Horizon Process 的目前狀態：\"]}]\n7b:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"php artisan horizon:status\\n\"}]}]\n7c:[\"$\",\"p\",null,{\"children\":[\"你可以使用 \",[\"$\",\"code\",null,{\"children\":\"horizon:supervisor-status\"}],\" Artisan 指令檢查特定 Horizon \",[\"$\",\"a\",null,{\"href\":\"#supervisors\",\"children\":\"supervisor\"}],\" 的目前狀態：\"]}]\n7d:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"php artisan horizon:supervisor-status supervisor-1\\n\"}]}]\n7e:[\"$\",\"p\",null,{\"children\":[\"你可以使用 \",[\"$\",\"code\",null,{\"children\":\"horizon:terminate\"}],\" Artisan 指令優雅地終止 Horizon Process。任何目前正在處理的 Job 都將完成，然後 Horizon 將停止執行：\"]}]\n7f:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"php artisan horizon:terminate\\n\"}]}]\n80:[\"$\",\"a\",null,{\"name\":\"deploying-horizon\"}]\n81:[\"$\",\"h3\",null,{\"id\":\"部署-horizon-deploying-horizon\",\"children\":[\"$\",\"a\",null,{\"href\":\"#部署-horizon-deploying-horizon\",\"children\":\"部署 Horizon (Deploying Horizon)\"}]}]\n82:[\"$\",\"p\",null,{\"children\":[\"當你準備好將 Horizon 部署到應用程式的實際伺服器時，你應該設定一個 Process 監視器來監視 \",[\"$\",\"code\",null,{\"children\":\"php artisan horizon\"}],\" 指令，並在其意外退出時重新啟動它。別擔心，我們將在下面討論如何安裝 Process 監視器。\"]}]\n83:[\"$\",\"p\",null,{\"children\":\"在應用程式的部署過程中，你應該指示 Horizon Process 終止，以便 Process 監視器重新啟動它並接收你的程式碼變更：\"}]\n84:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"php artisan horizon:terminate\\n\"}]}]\n85:[\"$\",\"a\",null,{\"name\":\"installing-supervisor\"}]\n86:[\"$\",\"h4\",null,"])</script><script>self.__next_f.push([1,"{\"id\":\"安裝-supervisor-installing-supervisor\",\"children\":[\"$\",\"a\",null,{\"href\":\"#安裝-supervisor-installing-supervisor\",\"children\":\"安裝 Supervisor (Installing Supervisor)\"}]}]\n87:[\"$\",\"p\",null,{\"children\":[\"Supervisor 是 Linux 作業系統的 Process 監視器，如果 \",[\"$\",\"code\",null,{\"children\":\"horizon\"}],\" Process 停止執行，它將自動重新啟動該 Process。要在 Ubuntu 上安裝 Supervisor，你可以使用以下指令。如果你不使用 Ubuntu，你可能可以使用作業系統的套件管理器安裝 Supervisor：\"]}]\n88:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"sudo apt-get install supervisor\\n\"}]}]\n89:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!NOTE]\\n如果自行設定 Supervisor 聽起來很麻煩，請考慮使用 \",[\"$\",\"a\",null,{\"href\":\"https://cloud.laravel.com\",\"children\":\"Laravel Cloud\"}],\"，它可以管理 Laravel 應用程式的背景 Process。\"]}],\"\\n\"]}]\n8a:[\"$\",\"a\",null,{\"name\":\"supervisor-configuration\"}]\n8b:[\"$\",\"h4\",null,{\"id\":\"supervisor-設定-supervisor-configuration\",\"children\":[\"$\",\"a\",null,{\"href\":\"#supervisor-設定-supervisor-configuration\",\"children\":\"Supervisor 設定 (Supervisor Configuration)\"}]}]\n8c:[\"$\",\"p\",null,{\"children\":[\"Supervisor 設定檔通常儲存在伺服器的 \",[\"$\",\"code\",null,{\"children\":\"/etc/supervisor/conf.d\"}],\" 目錄中。在此目錄中，你可以建立任意數量的設定檔，指示 Supervisor 應如何監視你的 Process。例如，讓我們建立一個 \",[\"$\",\"code\",null,{\"children\":\"horizon.conf\"}],\" 檔案，該檔案啟動並監視 \",[\"$\",\"code\",null,{\"children\":\"horizon\"}],\" Process：\"]}]\n8d:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-ini\",\"children\":\"[program:horizon]\\nprocess_name=%(program_name)s\\ncommand=php /home/forge/example.com/artisan horizon\\nautostart=true\\nautorestart=true\\nuser=forge\\nredirect_stderr=true\\nstdout_logfile=/home/forge/example.com/horizon.log\\nstopwaitsecs=3600\\n\"}]}]\n8e:[\"$\",\"p\",null,{\"children\":[\"定義 Supervisor 設定時，你應該確保 \",[\"$\",\"code\",null,{\"children\":\"stopwaitsecs\"}],\" 的值大於最長執行 Job 所消耗的秒數。否則，Supervisor 可能會在 Job 完成處理之前將其殺死。\"]}]\n8f:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"[!WARNING]\\n雖然上面的範例適用於基於 Ubuntu 的伺服器，但 Supervisor 設定檔預期的位置和副檔名可能因其他伺服器作業系統而異。請參閱你的伺服器文件以獲取更多資訊。\"}],\"\\n\"]}]\n90:[\"$\",\"a\",null,{\"name\":\"starting-supervisor\"}]\n91:[\"$\",\"h4\",null,{\"id\":\"啟動-supervisor-starting-supervisor\",\"children\":[\"$\",\"a\",null,{\"href\":\"#啟動-supervisor-starting-supervisor\",\"children\":\"啟動 Supervisor (Starting Supervisor)\"}]}]\n92:[\"$\",\"p\",null,{\"children\":\"建立設定檔後，你可以使用以下指令更新 Supervisor 設定並啟動受監視的 Process：\"}]\n93:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"sudo supervisorctl reread\\n\\nsudo supervisorctl update\\n\\nsudo supervisorctl start horizon\\n\"}]}]\n94:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!NOTE]\\n有關執行 Supervisor 的更多資訊，請參閱 \",[\"$\",\"a\",null,{\"href\":\"http://supervisord.org/index.html\",\"children\":\"Supervisor 文件\"}],\"。\"]}],\"\\n\"]}]\n95:[\"$\",\"a\",null,{\"name\":\"tags\"}]\n96:[\"$\",\"h2\",null,{\"id\":\"標籤-tags\",\"children\":[\"$\",\"a\",null,{\"href\":\"#標籤-tags\",\"children\":\"標籤 (Tags)\"}]}]\n97:[\"$\",\"p\",null,{\"children\":\"Horizon 允許你將 \\\"tags\\\" 指派給 Job，包括 mailables、廣播事件、通知和佇列事件監聽器。事實上，Horizon 會根據附加到 Job 的 Eloquent 模型，智慧地自動標記大多數 Job。例如，看看下面的 Job：\"}]\n98:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"\u003c?php\\n\\nnamespace App\\\\Jobs;\\n\\nuse App\\\\Models\\\\Video;\\nuse Illuminate\\\\Contracts\\\\Queue\\\\ShouldQueue;\\nuse Illuminate\\\\Foundation\\\\Queue\\\\Queueable;\\n\\nclass RenderVideo implements Sh"])</script><script>self.__next_f.push([1,"ouldQueue\\n{\\n    use Queueable;\\n\\n    /**\\n     * Create a new job instance.\\n     */\\n    public function __construct(\\n        public Video $video,\\n    ) {}\\n\\n    /**\\n     * Execute the job.\\n     */\\n    public function handle(): void\\n    {\\n        // ...\\n    }\\n}\\n\"}]}]\n99:[\"$\",\"p\",null,{\"children\":[\"如果此 Job 與具有 \",[\"$\",\"code\",null,{\"children\":\"id\"}],\" 屬性為 \",[\"$\",\"code\",null,{\"children\":\"1\"}],\" 的 \",[\"$\",\"code\",null,{\"children\":\"App\\\\Models\\\\Video\"}],\" 實例一起排入佇列，它將自動接收標籤 \",[\"$\",\"code\",null,{\"children\":\"App\\\\Models\\\\Video:1\"}],\"。這是因為 Horizon 會搜尋 Job 的屬性以尋找任何 Eloquent 模型。如果找到 Eloquent 模型，Horizon 將使用模型的類別名稱和主鍵智慧地標記 Job：\"]}]\n9a:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use App\\\\Jobs\\\\RenderVideo;\\nuse App\\\\Models\\\\Video;\\n\\n$video = Video::find(1);\\n\\nRenderVideo::dispatch($video);\\n\"}]}]\n9b:[\"$\",\"a\",null,{\"name\":\"manually-tagging-jobs\"}]\n9c:[\"$\",\"h4\",null,{\"id\":\"手動標記-job-manually-tagging-jobs\",\"children\":[\"$\",\"a\",null,{\"href\":\"#手動標記-job-manually-tagging-jobs\",\"children\":\"手動標記 Job (Manually Tagging Jobs)\"}]}]\n9d:[\"$\",\"p\",null,{\"children\":[\"如果你想手動定義其中一個可排入佇列物件的標籤，你可以在類別上定義一個 \",[\"$\",\"code\",null,{\"children\":\"tags\"}],\" 方法：\"]}]\n9e:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"class RenderVideo implements ShouldQueue\\n{\\n    /**\\n     * Get the tags that should be assigned to the job.\\n     *\\n     * @return array\u003cint, string\u003e\\n     */\\n    public function tags(): array\\n    {\\n        return ['render', 'video:'.$this-\u003evideo-\u003eid];\\n    }\\n}\\n\"}]}]\n9f:[\"$\",\"a\",null,{\"name\":\"manually-tagging-event-listeners\"}]\na0:[\"$\",\"h4\",null,{\"id\":\"手動標記事件監聽器-manually-tagging-event-listeners\",\"children\":[\"$\",\"a\",null,{\"href\":\"#手動標記事件監聽器-manually-tagging-event-listeners\",\"children\":\"手動標記事件監聽器 (Manually Tagging Event Listeners)\"}]}]\na1:[\"$\",\"p\",null,{\"children\":[\"當檢索佇列事件監聽器的標籤時，Horizon 會自動將事件實例傳遞給 \",[\"$\",\"code\",null,{\"children\":\"tags\"}],\" 方法，讓你將事件資料添加到標籤中：\"]}]\na2:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"class SendRenderNotifications implements ShouldQueue\\n{\\n    /**\\n     * Get the tags that should be assigned to the listener.\\n     *\\n     * @return array\u003cint, string\u003e\\n     */\\n    public function tags(VideoRendered $event): array\\n    {\\n        return ['video:'.$event-\u003evideo-\u003eid];\\n    }\\n}\\n\"}]}]\na3:[\"$\",\"a\",null,{\"name\":\"notifications\"}]\na4:[\"$\",\"h2\",null,{\"id\":\"通知-notifications\",\"children\":[\"$\",\"a\",null,{\"href\":\"#通知-notifications\",\"children\":\"通知 (Notifications)\"}]}]\na5:[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"[!WARNING]\\n當設定 Horizon 發送 Slack 或 SMS 通知時，你應該查看 \",[\"$\",\"a\",null,{\"href\":\"/docs/notifications\",\"children\":\"相關通知頻道的先決條件\"}],\"。\"]}],\"\\n\"]}]\na6:[\"$\",\"p\",null,{\"children\":[\"如果你想在其中一個佇列有很長的等待時間時收到通知，你可以使用 \",[\"$\",\"code\",null,{\"children\":\"Horizon::routeMailNotificationsTo\"}],\"、\",[\"$\",\"code\",null,{\"children\":\"Horizon::routeSlackNotificationsTo\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"Horizon::routeSmsNotificationsTo\"}],\" 方法。你可以從應用程式的 \",[\"$\",\"code\",null,{\"children\":\"App\\\\Providers\\\\HorizonServiceProvider\"}],\" 的 \",[\"$\",\"code\",null,{\"children\":\"boot\"}],\" 方法呼叫這些方法：\"]}]\na7:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"/**\\n * Bootstrap any application services.\\n */\\npublic function boot(): void\\n{\\n    parent::boot();\\n\\n    Horizon::routeSmsNotificationsTo('15556667777');\\n    Horizon::routeMailNotificationsTo('example@example.com');\\n    Horizon::routeSlackNotificationsTo('slack-webhook-url', '#channel');\\n"])</script><script>self.__next_f.push([1,"}\\n\"}]}]\na8:[\"$\",\"a\",null,{\"name\":\"configuring-notification-wait-time-thresholds\"}]\na9:[\"$\",\"h4\",null,{\"id\":\"設定通知等待時間閾值-configuring-notification-wait-time-thresholds\",\"children\":[\"$\",\"a\",null,{\"href\":\"#設定通知等待時間閾值-configuring-notification-wait-time-thresholds\",\"children\":\"設定通知等待時間閾值 (Configuring Notification Wait Time Thresholds)\"}]}]\naa:[\"$\",\"p\",null,{\"children\":[\"你可以在應用程式的 \",[\"$\",\"code\",null,{\"children\":\"config/horizon.php\"}],\" 設定檔中設定多少秒被視為 \\\"長時間等待\\\"。此檔案中的 \",[\"$\",\"code\",null,{\"children\":\"waits\"}],\" 設定選項允許你控制每個連線 / 佇列組合的長時間等待閾值。任何未定義的連線 / 佇列組合將預設為 60 秒的長時間等待閾值：\"]}]\nab:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"'waits' =\u003e [\\n    'redis:critical' =\u003e 30,\\n    'redis:default' =\u003e 60,\\n    'redis:batch' =\u003e 120,\\n],\\n\"}]}]\nac:[\"$\",\"p\",null,{\"children\":[\"將佇列的閾值設定為 \",[\"$\",\"code\",null,{\"children\":\"0\"}],\" 將停用該佇列的長時間等待通知。\"]}]\nad:[\"$\",\"a\",null,{\"name\":\"metrics\"}]\nae:[\"$\",\"h2\",null,{\"id\":\"指標-metrics\",\"children\":[\"$\",\"a\",null,{\"href\":\"#指標-metrics\",\"children\":\"指標 (Metrics)\"}]}]\naf:[\"$\",\"p\",null,{\"children\":[\"Horizon 包含一個指標儀表板，提供有關 Job 和佇列等待時間及吞吐量的資訊。為了填充此儀表板，你應該在應用程式的 \",[\"$\",\"code\",null,{\"children\":\"routes/console.php\"}],\" 檔案中設定 Horizon 的 \",[\"$\",\"code\",null,{\"children\":\"snapshot\"}],\" Artisan 指令每五分鐘執行一次：\"]}]\nb0:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-php\",\"children\":\"use Illuminate\\\\Support\\\\Facades\\\\Schedule;\\n\\nSchedule::command('horizon:snapshot')-\u003eeveryFiveMinutes();\\n\"}]}]\nb1:[\"$\",\"p\",null,{\"children\":[\"如果你想刪除所有指標資料，你可以呼叫 \",[\"$\",\"code\",null,{\"children\":\"horizon:clear-metrics\"}],\" Artisan 指令：\"]}]\nb2:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"php artisan horizon:clear-metrics\\n\"}]}]\nb3:[\"$\",\"a\",null,{\"name\":\"deleting-failed-jobs\"}]\nb4:[\"$\",\"h2\",null,{\"id\":\"刪除失敗的-job-deleting-failed-jobs\",\"children\":[\"$\",\"a\",null,{\"href\":\"#刪除失敗的-job-deleting-failed-jobs\",\"children\":\"刪除失敗的 Job (Deleting Failed Jobs)\"}]}]\nb5:[\"$\",\"p\",null,{\"children\":[\"如果你想刪除失敗的 Job，你可以使用 \",[\"$\",\"code\",null,{\"children\":\"horizon:forget\"}],\" 指令。\",[\"$\",\"code\",null,{\"children\":\"horizon:forget\"}],\" 指令接受失敗 Job 的 ID 或 UUID 作為其唯一參數：\"]}]\nb6:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"php artisan horizon:forget 5\\n\"}]}]\nb7:[\"$\",\"p\",null,{\"children\":[\"如果你想刪除所有失敗的 Job，你可以向 \",[\"$\",\"code\",null,{\"children\":\"horizon:forget\"}],\" 指令提供 \",[\"$\",\"code\",null,{\"children\":\"--all\"}],\" 選項：\"]}]\nb8:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"php artisan horizon:forget --all\\n\"}]}]\nb9:[\"$\",\"a\",null,{\"name\":\"clearing-jobs-from-queues\"}]\nba:[\"$\",\"h2\",null,{\"id\":\"清除佇列中的-job-clearing-jobs-from-queues\",\"children\":[\"$\",\"a\",null,{\"href\":\"#清除佇列中的-job-clearing-jobs-from-queues\",\"children\":\"清除佇列中的 Job (Clearing Jobs From Queues)\"}]}]\nbb:[\"$\",\"p\",null,{\"children\":[\"如果你想刪除應用程式預設佇列中的所有 Job，你可以使用 \",[\"$\",\"code\",null,{\"children\":\"horizon:clear\"}],\" Artisan 指令：\"]}]\nbc:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"php artisan horizon:clear\\n\"}]}]\nbd:[\"$\",\"p\",null,{\"children\":[\"你可以提供 \",[\"$\",\"code\",null,{\"children\":\"queue\"}],\" 選項來刪除特定佇列中的 Job：\"]}]\nbe:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-shell\",\"children\":\"php artisan horizon:clear --queue=emails\\n\"}]}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"bf:I[27201,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"IconMark\"]\nc:[[\"$\",\"title\",\"0\",{\"children\":\"Create Next App\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Generated by create next app\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/favicon.ico?favicon.0b3bf435.ico\",\"sizes\":\"256x256\",\"type\":\"image/x-icon\"}],[\"$\",\"$Lbf\",\"3\",{}]]\n8:null\n"])</script></body></html>