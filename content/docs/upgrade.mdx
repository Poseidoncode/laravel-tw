---
title: Upgrade Guide
description: Laravel 版本升級指南
---

# 升級指南

- [從 11.x 升級到 12.0](#upgrade-12.0)

<a name="high-impact-changes"></a>
## 高影響變更

<div className="content-list" markdown="1">

- [更新依賴套件](#updating-dependencies)
- [更新 Laravel 安裝器](#updating-the-laravel-installer)

</div>

<a name="medium-impact-changes"></a>
## 中等影響變更

<div className="content-list" markdown="1">

- [Models 與 UUIDv7](#models-and-uuidv7)

</div>

<a name="low-impact-changes"></a>
## 低影響變更

<div className="content-list" markdown="1">

- [Carbon 3](#carbon-3)
- [Concurrency 結果索引映射](#concurrency-result-index-mapping)
- [Container 類別依賴解析](#container-class-dependency-resolution)
- [Image 驗證現在排除 SVGs](#image-validation)
- [本地檔案系統磁碟預設根路徑](#local-filesystem-disk-default-root-path)
- [多 Schema 資料庫檢視](#multi-schema-database-inspecting)
- [巢狀陣列請求合併](#nested-array-request-merging)

</div>

<a name="upgrade-12.0"></a>
## 從 11.x 升級到 12.0

#### 預估升級時間：5 分鐘

> [!NOTE]
> 我們嘗試記錄每個可能的破壞性變更。由於這些破壞性變更有些在 framework 的隱蔽部分，只有一部分這些變更可能實際影響你的應用程式。想要節省時間嗎？你可以使用 [Laravel Shift](https://laravelshift.com/) 來協助自動化你的應用程式升級。

<a name="updating-dependencies"></a>
### 更新依賴套件

**影響可能性：高**

你應該在應用程式的 `composer.json` 檔案中更新以下依賴套件：

<div className="content-list" markdown="1">

- `laravel/framework` 更新到 `^12.0`
- `phpunit/phpunit` 更新到 `^11.0`
- `pestphp/pest` 更新到 `^3.0`

</div>

<a name="carbon-3"></a>
#### Carbon 3

**影響可能性：低**

已移除對 [Carbon 2.x](https://carbon.nesbot.com/docs/) 的支援。所有 Laravel 12 應用程式現在需要 [Carbon 3.x](https://carbon.nesbot.com/docs/#api-carbon-3)。

<a name="updating-the-laravel-installer"></a>
### 更新 Laravel 安裝器

如果你使用 Laravel 安裝器 CLI 工具來建立新的 Laravel 應用程式，你應該更新你的安裝器以與 Laravel 12.x 和[新的 Laravel 入門套件](https://laravel.com/starter-kits)相容。如果你透過 `composer global require` 安裝了 Laravel 安裝器，你可以使用 `composer global update` 來更新安裝器：

```shell
composer global update laravel/installer
```

如果你最初是透過 `php.new` 安裝 PHP 和 Laravel，你可以簡單地重新執行適用於你作業系統的 `php.new` 安裝命令，以安裝最新版本的 PHP 和 Laravel 安裝器：

```shell tab=macOS
/bin/bash -c "$(curl -fsSL https://php.new/install/mac/8.4)"
```

```shell tab=Windows PowerShell
# Run as administrator...
Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://php.new/install/windows/8.4'))
```

```shell tab=Linux
/bin/bash -c "$(curl -fsSL https://php.new/install/linux/8.4)"
```

或者，如果你使用 [Laravel Herd](https://herd.laravel.com) 內建的 Laravel 安裝器，你應該將 Herd 安裝更新到最新版本。

<a name="authentication"></a>
### 驗證

<a name="updated-databasetokenrepository-constructor-signature"></a>
#### 更新 `DatabaseTokenRepository` 建構函式簽章

**影響可能性：非常低**

`Illuminate\Auth\Passwords\DatabaseTokenRepository` 類別的建構函式現在期望 `$expires` 參數以秒為單位，而不是分鐘。

<a name="concurrency"></a>
### Concurrency

<a name="concurrency-result-index-mapping"></a>
#### Concurrency 結果索引映射

**影響可能性：低**

當使用關聯陣列呼叫 `Concurrency::run` 方法時，並行操作的結果現在會回傳關聯的鍵：

```php
$result = Concurrency::run([
    'task-1' => fn () => 1 + 1,
    'task-2' => fn () => 2 + 2,
]);

// ['task-1' => 2, 'task-2' => 4]
```

<a name="container"></a>
### Container

<a name="container-class-dependency-resolution"></a>
#### Container 類別依賴解析

**影響可能性：低**

依賴注入容器現在在解析類別實例時會尊重類別屬性的預設值。如果你之前依賴容器在沒有預設值的情況下解析類別實例，你可能需要調整你的應用程式以適應這個新行為：

```php
class Example
{
    public function __construct(public ?Carbon $date = null) {}
}

$example = resolve(Example::class);

// <= 11.x
$example->date instanceof Carbon;

// >= 12.x
$example->date === null;
```

<a name="database"></a>
### 資料庫

<a name="multi-schema-database-inspecting"></a>
#### 多 Schema 資料庫檢視

**影響可能性：低**

`Schema::getTables()`、`Schema::getViews()` 和 `Schema::getTypes()` 方法現在預設會包含所有 schemas 的結果。你可以傳遞 `schema` 參數來僅擷取指定 schema 的結果：

```php
// All tables on all schemas...
$tables = Schema::getTables();

// All tables on the 'main' schema...
$tables = Schema::getTables(schema: 'main');

// All tables on the 'main' and 'blog' schemas...
$tables = Schema::getTables(schema: ['main', 'blog']);
```

`Schema::getTableListing()` 方法現在預設回傳帶有 schema 前綴的資料表名稱。你可以傳遞 `schemaQualified` 參數來依需要變更行為：

```php
$tables = Schema::getTableListing();
// ['main.migrations', 'main.users', 'blog.posts']

$tables = Schema::getTableListing(schema: 'main');
// ['main.migrations', 'main.users']

$tables = Schema::getTableListing(schema: 'main', schemaQualified: false);
// ['migrations', 'users']
```

`db:table` 和 `db:show` 命令現在會在 MySQL、MariaDB 和 SQLite 上輸出所有 schemas 的結果，就像 PostgreSQL 和 SQL Server 一樣。

<a name="updated-blueprint-constructor-signature"></a>
#### 更新 `Blueprint` 建構函式簽章

**影響可能性：非常低**

`Illuminate\Database\Schema\Blueprint` 類別的建構函式現在期望 `Illuminate\Database\Connection` 的實例作為第一個參數。

<a name="eloquent"></a>
### Eloquent

<a name="models-and-uuidv7"></a>
#### Models 與 UUIDv7

**影響可能性：中等**

`HasUuids` trait 現在會回傳與 UUID 規範版本 7（有序 UUIDs）相容的 UUIDs。如果你想繼續為 model 的 IDs 使用有序 UUIDv4 字串，你現在應該使用 `HasVersion4Uuids` trait：

```php
use Illuminate\Database\Eloquent\Concerns\HasUuids; // [tl! remove]
use Illuminate\Database\Eloquent\Concerns\HasVersion4Uuids as HasUuids; // [tl! add]
```

`HasVersion7Uuids` trait 已被移除。如果你之前使用這個 trait，你應該改用 `HasUuids` trait，它現在提供相同的行為。

<a name="requests"></a>
### 請求

<a name="nested-array-request-merging"></a>
#### 巢狀陣列請求合併

**影響可能性：低**

`$request->mergeIfMissing()` 方法現在允許使用「點」標記法來合併巢狀陣列資料。如果你之前依賴此方法來建立包含「點」標記法版本的頂層陣列鍵，你可能需要調整你的應用程式以適應這個新行為：

```php
$request->mergeIfMissing([
    'user.last_name' => 'Otwell',
]);
```

<a name="storage"></a>
### 儲存

<a name="local-filesystem-disk-default-root-path"></a>
#### 本地檔案系統磁碟預設根路徑

**影響可能性：低**

如果你的應用程式沒有在檔案系統設定中明確定義 `local` 磁碟，Laravel 現在會將本地磁碟的根目錄預設為 `storage/app/private`。在之前的版本中，這預設為 `storage/app`。因此，除非另有設定，否則呼叫 `Storage::disk('local')` 將從 `storage/app/private` 讀取和寫入。若要恢復之前的行為，你可以手動定義 `local` 磁碟並設定所需的根路徑。

<a name="validation"></a>
### 驗證

<a name="image-validation"></a>
#### Image 驗證現在排除 SVGs

**影響可能性：低**

`image` 驗證規則現在預設不再允許 SVG 圖片。如果你想在使用 `image` 規則時允許 SVGs，你必須明確允許它們：

```php
use Illuminate\Validation\Rules\File;

'photo' => 'required|image:allow_svg'

// Or...
'photo' => ['required', File::image(allowSvg: true)],
```

<a name="miscellaneous"></a>
### 其他

我們也鼓勵你檢視 `laravel/laravel` [GitHub 儲存庫](https://github.com/laravel/laravel)中的變更。雖然這些變更中有許多不是必需的，但你可能希望將這些檔案與你的應用程式保持同步。這些變更中的一些會在此升級指南中介紹，但其他的，例如設定檔或註解的變更，則不會。你可以使用 [GitHub 比較工具](https://github.com/laravel/laravel/compare/11.x...12.x)輕鬆查看變更，並選擇哪些更新對你來說是重要的。
